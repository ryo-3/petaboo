# Claudeé–‹ç™ºä»•æ§˜æ›¸

## âœ… å¿…èª­äº‹é …

- æ—¥æœ¬èªã§å¯¾å¿œã™ã‚‹ã“ã¨
- ä½œæ¥­é–‹å§‹å‰ã« `.claude/æ§‹é€ ãƒãƒƒãƒ—` ã‚’ç¢ºèªã—ã€æœ€çµ‚æ›´æ–°æ—¥ã‚’å¿…ãšãƒã‚§ãƒƒã‚¯
- å†…å®¹ã‚’æ›´æ–°ã—ãŸå ´åˆã¯ã€æœ€çµ‚æ›´æ–°æ—¥ã‚‚å¿…ãšæ›¸ãæ›ãˆã‚‹ã“ã¨

## ğŸ“‚ é–‹ç™ºãƒ¡ãƒ¢ä¿ç®¡å ´æ‰€

- è¨­è¨ˆãƒ»å®Ÿè£…ã®è©³ç´°ãƒ¡ãƒ¢ã¯ `.claude/é–‹ç™ºãƒ¡ãƒ¢/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä¿å­˜ã€‚

---

# ğŸš¨ ç¦æ­¢äº‹é …ä¸€è¦§

## ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ç¦æ­¢

- âŒ `npm run dev`ï¼ˆWeb/APIä¸¡æ–¹ï¼‰
- âŒ `cd apps/web && npm run dev`
- âŒ `cd apps/api && npm run dev`

## ä½œæ¥­æ–¹æ³•ã®ç¦æ­¢

- âŒ ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¾ãšã«ä¿®æ­£ææ¡ˆ
- âŒ å¤‰æ•°ãƒ»é–¢æ•°ã®å­˜åœ¨ç¢ºèªã‚’æ€ ã‚‹
- âŒ å‹ã‚¨ãƒ©ãƒ¼ãƒ»lintã‚¨ãƒ©ãƒ¼ã‚’æ”¾ç½®
- âŒ `as unknown as` ãªã©å±é™ºãªã‚­ãƒ£ã‚¹ãƒˆ
- âŒ å…±é€šå‹ã‚’ä½¿ã‚ãš `string/number` ç›´æ›¸ã

## Gitæ“ä½œã®åˆ¶é™

- âŒ å‹æ‰‹ã«ã‚³ãƒŸãƒƒãƒˆå®Ÿè¡Œ
  â€» `Run git add . and commit in Japanese .` æŒ‡ç¤ºæ™‚ã®ã¿è¨±å¯

## UI/UXãƒ«ãƒ¼ãƒ«

- âŒ `title` å±æ€§ã®ç›´æ¥ä½¿ç”¨ï¼ˆTooltipã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå¿…é ˆï¼‰

## DBãƒ»ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶é™

### ğŸš« å®Ÿè¡Œå³ç¦

- âŒ `npm run db:reset:local`ï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿æ¶ˆå¤±ï¼‰
- âŒ `npm run db:migration:prod`ï¼ˆæœ¬ç•ªDBå¤‰æ›´ï¼‰

### âš ï¸ è¦ç¢ºèª

- `npm run db:generate`ï¼ˆã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´æ™‚ã®ã¿ï¼‰
- `npm run db:migration:local`ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é™å®šï¼‰
- drizzle-kit å®Ÿè¡Œï¼ˆè¦ææ¡ˆå‰ç¢ºèªï¼‰

### âœ… å®Ÿè¡Œè¨±å¯ï¼ˆæ…é‡ã«ï¼‰

- ã‚¹ã‚­ãƒ¼ãƒç·¨é›†ï¼ˆã‚³ãƒ¼ãƒ‰ä¿®æ­£ï¼‰
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«é–²è¦§ï¼ˆå†…å®¹ç¢ºèªã®ã¿ï¼‰

# ğŸ§  Cloud Codeä½œæ¥­ãƒ«ãƒ¼ãƒ«

> Cloud Code = è¨­è¨ˆæ‹…å½“ï¼ˆå®Ÿè£…ã¯CodexãŒè¡Œã†ï¼‰

## ä½œæ¥­åŸå‰‡

1. **åŸå‰‡ã¨ã—ã¦ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã¯è¡Œã‚ãªã„**
2. æœ€åˆã®å‡ºåŠ›ã¯å¿…ãš **å®Ÿè£…è¨ˆç”»æ›¸ï¼ˆPlanï¼‰**
3. Planä¿å­˜å…ˆï¼š`.claude/plans/`
4. Planã«ã¯ä»¥ä¸‹ã‚’å¿…ãšå«ã‚ã‚‹ã“ã¨ï¼š
   - ç›®çš„ï¼ˆæ„å›³ãƒ»æœŸå¾…æˆæœï¼‰
   - å¤‰æ›´ç¯„å›²ï¼ˆç”»é¢ãƒ»é–¢æ•°ãƒ»APIãƒ»å‹ãªã©ï¼‰
   - å®Ÿè£…æ‰‹é †ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ï¼‰
   - å½±éŸ¿ç¯„å›²ãƒ»æ‡¸å¿µç‚¹
   - Codexç”¨ToDoãƒªã‚¹ãƒˆï¼ˆå®Ÿè£…æŒ‡ç¤ºï¼‰
   - **Codexã«ã‚³ãƒŸãƒƒãƒˆã¯è¡Œã‚ãªã„ã“ã¨**
   - **Codexã«ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã‚’ä¾é ¼ã™ã‚‹éš›ã¯ã€æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¸ã”ã¨å†ç”Ÿæˆã•ã›ãšã€å·®åˆ†ï¼ˆpatchå½¢å¼ï¼‰ã§ä¿®æ­£ã•ã›ã‚‹ã“ã¨**
   - **æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã‚„æ–‡å­—åˆ—ãŒã‚ã‚‹å ´åˆã€UTF-8ã§æ–‡å­—åŒ–ã‘ãŒèµ·ããªã„ã‚ˆã†æ˜ç¤ºã™ã‚‹ã“ã¨**

### ğŸŒŸ ä¾‹å¤–ãƒ«ãƒ¼ãƒ«ï¼ˆCodexãƒˆãƒ©ãƒ–ãƒ«æ™‚ï¼‰

- Codexå´ã§åˆ¶é™ç™ºç”Ÿãƒ»æ–‡å­—åŒ–ã‘ãƒ»èª¤å®Ÿè£…ãŒç¶šãå ´åˆã«é™ã‚Šã€**Cloud CodeãŒç›´æ¥ã‚³ãƒ¼ãƒ‰å®Ÿè£…ã—ã¦ã‚ˆã„ï¼ˆâ€»1ã€œ2ãƒ•ã‚¡ã‚¤ãƒ«ã¾ã§ï¼‰**

## é‹ç”¨ãƒ«ãƒ¼ãƒ«

- Planä½œæˆå¾Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªã¾ã§ã‚³ãƒ¼ãƒ‰ä¿®æ­£ã¯ç¦æ­¢
- Planã¯CodexãŒå®Ÿè£…ã—ã‚„ã™ã„å½¢ã§è¨˜è¿°ã™ã‚‹
- `.claude/` é…ä¸‹ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé¡ï¼‰ã®ã¿ç›´æ¥æ›´æ–°å¯

# ğŸ“˜ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå

**ã€ŒãºãŸã¼ãƒ¼ã€**
å€‹äººãƒ»ãƒãƒ¼ãƒ å‘ã‘ **çµ±åˆãƒ¡ãƒ¢ Ã— ã‚¿ã‚¹ã‚¯ç®¡ç† Ã— ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•´ç†** ã‚·ã‚¹ãƒ†ãƒ ã€‚

## ãƒ¢ãƒãƒ¬ãƒæ§‹æˆï¼ˆTurborepoï¼‰

- `apps/web`ï¼šNext.jsï¼ˆãƒ•ãƒ­ãƒ³ãƒˆï¼‰
- `apps/api`ï¼šHono + SQLiteï¼ˆAPIï¼‰
- `packages/*`ï¼šå…±é€šãƒ­ã‚¸ãƒƒã‚¯ãƒ»å‹å®šç¾©

## ä¸»ãªæ©Ÿèƒ½

- ãƒ¡ãƒ¢ç®¡ç†ï¼šæ€è€ƒæ•´ç†ãƒ»ã‚¢ã‚¤ãƒ‡ã‚¢è“„ç©
- ã‚¿ã‚¹ã‚¯ç®¡ç†ï¼šTODOãƒ»é€²æ—ãƒ»æœŸé™
- ãƒœãƒ¼ãƒ‰ç®¡ç†ï¼šã‚«ãƒ³ãƒãƒ³æ•´ç†
- ãƒãƒ¼ãƒ æ©Ÿèƒ½ï¼ˆæ‹¡å¼µäºˆå®šï¼‰ï¼šå…±æœ‰ãƒ»æ¨©é™ç®¡ç†

## ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆæ€æƒ³

- **ã‚·ãƒ³ãƒ—ãƒ«**ï¼šè¿·ã‚ãšä½¿ãˆã‚‹æ“ä½œæ€§
- **å…±é€šåŒ–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ**ï¼šé‡è¤‡æ’é™¤ãƒ»å†åˆ©ç”¨å„ªå…ˆ
- **å‹å®‰å…¨**ï¼šTypeScriptã§å …ç‰¢è¨­è¨ˆ
- **è‡ªå‹•åŒ–é‡è¦–**ï¼šå“è³ªã¨åŠ¹ç‡ã®ä¸¡ç«‹

è©³ç´°ã¯ `.claude/é–‹ç™ºãƒ¡ãƒ¢/æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯.md` ã‚’å‚ç…§ã€‚

---

# âš™ï¸ é–‹ç™ºåŸå‰‡ãƒ»å‹ã‚·ã‚¹ãƒ†ãƒ 

## è¨­è¨ˆåŸå‰‡

- å…±é€šåŒ–ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆï¼š2å›ä»¥ä¸Šä½¿ã†ãªã‚‰å³å…±é€šåŒ–
- Propsè¨­è¨ˆï¼švariant, size, colorã§æ‹¡å¼µ
- ã‚µã‚¤ã‚ºæŒ‡å®šï¼šè¦ªã‹ã‚‰æ¸¡ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ç¦æ­¢ï¼‰
- å‹å®‰å…¨ï¼šå…±é€šå‹å®šç¾©ã‚’ä½¿ç”¨ã€å±é™ºãªã‚­ãƒ£ã‚¹ãƒˆç¦æ­¢

## å…±é€šå‹å®šç¾©

`apps/web/src/types/common.ts`

```typescript
export type OriginalId = string;
```

### OriginalIdè¨­è¨ˆæ€æƒ³

- ç”Ÿæˆï¼š`id.toString()`
- ä¸€æ„æ€§ï¼šAUTO_INCREMENTã§ä¿è¨¼
- ç”¨é€”ï¼šå‰Šé™¤ãƒ»å¾©å…ƒãƒ»è­˜åˆ¥
- å‹å®‰å…¨ï¼šå…¨ç®‡æ‰€`OriginalId`å‹ã§çµ±ä¸€

### IDç¨®åˆ¥

- `id`: numberï¼ˆDBä¸»ã‚­ãƒ¼ï¼‰
- `originalId`: OriginalIdï¼ˆå¾©å…ƒè­˜åˆ¥ç”¨ï¼‰

---

# ğŸ”‘ APIèªè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// Clerk Bearerèªè¨¼ï¼ˆcredentialsä¸è¦ï¼‰
const response = await fetch(`${API_BASE_URL}/categories`, {
  headers: {
    "Content-Type": "application/json",
    ...(token && { Authorization: `Bearer ${token}` }),
  },
});
```

---

# ğŸ§© é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

```bash
# å“è³ªãƒã‚§ãƒƒã‚¯
npm run check:wsl   # Web
npm run check:api   # API
```

---

# ğŸš€ é–‹ç™ºãƒ•ãƒ­ãƒ¼

## 1ï¸âƒ£ APIé–‹ç™º

```bash
# ã‚¹ã‚­ãƒ¼ãƒãƒ»ãƒ«ãƒ¼ãƒˆä½œæˆ
# DBãƒ‡ãƒ¼ã‚¿ç¢ºèª
npx wrangler d1 execute DB --local --command "SELECT id, title FROM memos LIMIT 3;"

# å‹•ä½œãƒ†ã‚¹ãƒˆ
apitest "/categories"                           # GET
apitest "/memos" "POST" '{"title":"ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¢"}' # POST
```

## 2ï¸âƒ£ ãƒ•ãƒ­ãƒ³ãƒˆå®Ÿè£…

```bash
npm run check:wsl
tail -f petaboo/web.log | grep -i "error\|warn"
```

## 3ï¸âƒ£ ã‚¨ãƒ©ãƒ¼å¯¾å¿œ

```bash
tail -50 petaboo/api.log
tail -50 petaboo/web.log
pkill -f "tsx.*apps/api"
```

---

# ğŸ› ï¸ é–‹ç™ºè£œåŠ©ã‚³ãƒãƒ³ãƒ‰é›†

## APIãƒ†ã‚¹ãƒˆé–¢æ•°

```bash
apitest() {
  local endpoint="$1"
  local method="${2:-GET}"
  local data="$3"
  local base_url="http://localhost:7594"
  echo "ğŸ§ª Testing: $method $base_url$endpoint"
  if [ -n "$data" ]; then
    curl -s -X "$method" "$base_url$endpoint" \
      -H "Authorization: Bearer ${API_TOKEN:-dummy}" \
      -H "Content-Type: application/json" \
      -d "$data" | jq
  else
    curl -s -X "$method" "$base_url$endpoint" \
      -H "Authorization: Bearer ${API_TOKEN:-dummy}" | jq
  fi
}
```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç¢ºèª

```bash
npx wrangler d1 execute DB --local --command "SELECT id, title, LEFT(content, 50) as preview FROM memos ORDER BY createdAt DESC LIMIT 5;"
npx wrangler d1 execute DB --local --command "SELECT id, title, status, priority FROM tasks ORDER BY createdAt DESC LIMIT 5;"
npx wrangler d1 execute DB --local --command "SELECT id, name FROM categories ORDER BY createdAt DESC;"
npx wrangler d1 execute DB --local --command "PRAGMA table_info(memos);"
npx wrangler d1 execute DB --local --command "SELECT name FROM sqlite_master WHERE type='table';"
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```bash
lsof -ti:7594 | xargs -r kill -9  # APIåœæ­¢
lsof -ti:7593 | xargs -r kill -9  # Webåœæ­¢
```

---

# ğŸš¨ APIè¿½åŠ æ™‚ã«å¿…ãšè¡Œã†ã“ã¨

1. ãƒ«ãƒ¼ãƒˆä½œæˆï¼š`apps/api/src/routes/{name}/route.ts`
2. å®Ÿè£…ï¼š`apps/api/src/routes/{name}/api.ts`
3. ç™»éŒ²ï¼š`worker-d1.ts`

   ```typescript
   import newRoute from "./src/routes/{name}/route";
   app.route("/{path}", newRoute);
   ```

### ã‚ˆãã‚ã‚‹å¤±æ•—

- `openapi.ts`ç™»éŒ²ã®ã¿ â†’ 404ç™ºç”Ÿ
- å®Ÿã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã¯`worker-d1.ts`

### ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ãƒ«ãƒ¼ãƒˆä½œæˆ
- [ ] å®Ÿè£…å®Œäº†
- [ ] ã‚¤ãƒ³ãƒãƒ¼ãƒˆè¿½åŠ 
- [ ] `app.route()`è¿½åŠ 
- [ ] ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•ãƒ»å‹•ä½œç¢ºèª

---

# ğŸ§¹ ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ 

## æ¦‚è¦

ä¸è¦ãƒ­ã‚°ã‚’é™¤å»ã—ã€é–‹ç™ºåŠ¹ç‡ã‚’å‘ä¸Šã€‚

## æ§‹æˆ

- `filter-logs.sh`ï¼šå…±é€šãƒ•ã‚£ãƒ«ã‚¿
- èµ·å‹•æ™‚ã«æ—§ãƒ­ã‚°å‰Šé™¤
- ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–‹å§‹ãƒ­ã‚°ã‚’æŠ‘åˆ¶ã€å®Œäº†ãƒ­ã‚°ã®ã¿ä¿æŒ

## é™¤å¤–å¯¾è±¡

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆâœ“ Compiledãªã©ï¼‰
- Next.jsèµ·å‹•æ–‡
- CORSãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆ
- Wrangleræƒ…å ±ãƒ­ã‚°

## ä¿æŒå¯¾è±¡

- ã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Š
- å®Œäº†ãƒ­ã‚°ï¼ˆ`GET ... - 200`å½¢å¼ï¼‰
- é‡è¦åˆæœŸåŒ–ãƒ­ã‚°
- æ¥­å‹™ã‚¢ãƒ—ãƒªãƒ­ã‚°

## ä½¿ç”¨æ–¹æ³•

```bash
cd apps/web && npm run dev
cd apps/api && npm run dev
```

### è¨­å®šå¤‰æ›´

`filter-logs.sh` å†…ã® `FILTER_PATTERNS` ã‚’ç·¨é›†ã€‚

---

# ğŸ§© ãƒ¬ã‚¬ã‚·ãƒ¼å›é¿ç­–

æ—¢å­˜ã‚¿ã‚°APIä¾‹ï¼š

```typescript
app.get("/tags", async (c) => {
  const teamId = c.req.query("teamId");
  if (teamId) {
    // ãƒãƒ¼ãƒ å‡¦ç†
  } else {
    // å€‹äººå‡¦ç†
  }
});
```
