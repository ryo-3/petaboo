# 3ãƒ‘ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆçµ±ä¸€åŒ–è¨ˆç”»

> âš ï¸ Codexã«å®Ÿè£…ä¾é ¼ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã‚’å³å®ˆã™ã‚‹ã“ã¨ï¼š
>
> - **æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¸ã”ã¨å†ç”Ÿæˆã•ã›ãªã„ã“ã¨**
>   â†’ Codexã¸ã®ä¾é ¼ã¯å¿…ãš **å·®åˆ†ï¼ˆpatchå½¢å¼ï¼‰** ã§è¡Œã†
> - **æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆãƒ»æ–‡å­—åˆ—ã‚’æ‰±ã†å ´åˆã¯UTF-8å‰æã§ä¾é ¼ã™ã‚‹ã“ã¨**
>   â†’ æ–‡å­—åŒ–ã‘é˜²æ­¢ã®ãŸã‚æ˜è¨˜ã™ã‚‹
> - **Codexã« git add / git commit ã‚’å®Ÿè¡Œã•ã›ãªã„ã“ã¨**
> - **å®Œäº†ã—ãŸå ´åˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’`.claude/fixed-plans` ã«ç§»å‹•ã™ã‚‹**

---

## ğŸ“‹ ç›®çš„

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ã§äºŒé‡åŒ–ã—ã¦ã„ã‚‹3ãƒ‘ãƒãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå®Ÿè£…ã‚’çµ±ä¸€ã—ã€ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ãƒ»ä¸€è²«æ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

### æœŸå¾…æˆæœ

1. âœ… ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡å‰Šæ¸›ï¼ˆç´„400è¡Œã®ã‚³ãƒ¼ãƒ‰å‰Šæ¸›è¦‹è¾¼ã¿ï¼‰
2. âœ… ãƒ‘ãƒãƒ«å¹…ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®çµ±ä¸€
3. âœ… åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã®èª¤ä¿å­˜å¯¾ç­–ã‚’å…¨ç”»é¢ã«é©ç”¨
4. âœ… ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“ã®çµ±ä¸€åŒ–
5. âœ… å°†æ¥çš„ãªæ©Ÿèƒ½è¿½åŠ æ™‚ã®ä¿®æ­£ç®‡æ‰€ã‚’1ç®‡æ‰€ã«é›†ç´„

---

## ğŸ” ç¾çŠ¶åˆ†æ

### å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

| ãƒ‘ã‚¿ãƒ¼ãƒ³           | ä½¿ç”¨ç®‡æ‰€             | ç‰¹å¾´                                 | èª²é¡Œ                 |
| ------------------ | -------------------- | ------------------------------------ | -------------------- |
| ControlPanelLayout | ãƒ¡ãƒ¢ç”»é¢ã€ã‚¿ã‚¹ã‚¯ç”»é¢ | å…±é€šåŒ–ã€ã‚·ãƒ³ãƒ—ãƒ«                     | åˆå›ãƒã‚¦ãƒ³ãƒˆå¯¾ç­–ãªã— |
| ç‹¬è‡ªå®Ÿè£…           | ãƒœãƒ¼ãƒ‰è©³ç´°ç”»é¢       | é¸æŠçŠ¶æ…‹åˆ¥ä¿å­˜ã€åˆå›ãƒã‚¦ãƒ³ãƒˆå¯¾ç­–ã‚ã‚Š | ã‚³ãƒ¼ãƒ‰é‡è¤‡ã€ä¿å®ˆæ€§ä½ |

### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ä¸€è¦§

```typescript
// ç¾åœ¨ä½¿ç”¨ä¸­
"personal-memo-2panel-sizes-v1";
"team-memo-3panel-sizes-v2";
"personal-task-2panel-sizes-v1";
"team-task-3panel-sizes-v2";
"team-board-panel-sizes-selected";
"team-board-panel-sizes-unselected";
```

---

## ğŸ¯ å¤‰æ›´ç¯„å›²

### 1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- `apps/web/components/layout/control-panel-layout.tsx` - æ©Ÿèƒ½æ‹¡å¼µ
- `apps/web/components/screens/board-detail-screen-3panel.tsx` - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

### 2. å‹å®šç¾©

- `apps/web/src/types/` - å¿…è¦ã«å¿œã˜ã¦è¿½åŠ 

---

## ğŸ“ å®Ÿè£…æ‰‹é †

### Phase 1: ControlPanelLayout ã®æ‹¡å¼µ

#### 1-1. åˆå›ãƒã‚¦ãƒ³ãƒˆå¯¾ç­–ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/components/layout/control-panel-layout.tsx`

**å¤‰æ›´å†…å®¹:**

```typescript
// è¿½åŠ ã™ã‚‹Propsã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹æ‹¡å¼µ
interface ControlPanelLayoutProps {
  // ... æ—¢å­˜ã®props

  // æ–°è¦è¿½åŠ 
  skipInitialSave?: boolean; // åˆå›ãƒã‚¦ãƒ³ãƒˆæ™‚ã®ä¿å­˜ã‚’ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ã‹
  stateKey?: string; // çŠ¶æ…‹å¤‰åŒ–ã®ç›£è¦–ã‚­ãƒ¼ï¼ˆé¸æŠçŠ¶æ…‹ãªã©ã®å¤‰åŒ–ã‚’æ¤œçŸ¥ï¼‰
}

// å®Ÿè£…
const mountCount = useRef(0);

useEffect(() => {
  // stateKeyãŒå¤‰æ›´ã•ã‚ŒãŸã‚‰ã‚«ã‚¦ãƒ³ãƒˆã‚’ãƒªã‚»ãƒƒãƒˆ
  mountCount.current = 0;
}, [stateKey]);

const handleLayout = (sizes: number[]) => {
  // skipInitialSaveãŒæœ‰åŠ¹ãªå ´åˆã€åˆå›ã¯ã‚¹ã‚­ãƒƒãƒ—
  if (skipInitialSave) {
    mountCount.current++;
    if (mountCount.current <= 1) {
      return;
    }
  }

  // æ—¢å­˜ã®ä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯
  // ...
};
```

**ç†ç”±:**

- ãƒœãƒ¼ãƒ‰ç”»é¢ã®é¸æŠçŠ¶æ…‹åˆ‡ã‚Šæ›¿ãˆæ™‚ã«èª¤ä¿å­˜ã•ã‚Œã‚‹ã®ã‚’é˜²ã
- ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ç”»é¢ã§ã‚‚åŒæ§˜ã®å•é¡ŒãŒæ½œåœ¨çš„ã«å­˜åœ¨ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

#### 1-2. ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“ã®è¨­å®šå¯èƒ½åŒ–

**å¤‰æ›´å†…å®¹:**

```typescript
interface ControlPanelLayoutProps {
  // ... æ—¢å­˜ã®props

  debounceMs?: number; // ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 300ï¼‰
}

// å®Ÿè£…
const debounceTime = debounceMs ?? 300;

resizeTimerRef.current = setTimeout(() => {
  localStorage.setItem(storageKey, JSON.stringify(newSizes));
}, debounceTime);
```

**ç†ç”±:**

- ç¾åœ¨300msã¨500msãŒæ··åœ¨ã—ã¦ã„ã‚‹
- ç”»é¢ã®ç‰¹æ€§ã«å¿œã˜ã¦èª¿æ•´å¯èƒ½ã«ã™ã‚‹

#### 1-3. è¤‡æ•°storageKeyå¯¾å¿œï¼ˆçŠ¶æ…‹åˆ¥ä¿å­˜ï¼‰

**å¤‰æ›´å†…å®¹:**

```typescript
interface ControlPanelLayoutProps {
  // ... æ—¢å­˜ã®props

  // storageKeyã‚’å˜ä¸€æ–‡å­—åˆ—ã‹ã‚‰æŸ”è»Ÿãªå½¢å¼ã«å¤‰æ›´
  storageKey:
    | string
    | {
        getKey: () => string; // å‹•çš„ã«ã‚­ãƒ¼ã‚’å–å¾—ã™ã‚‹é–¢æ•°
      };
}

// å®Ÿè£…
const getStorageKey = () => {
  if (typeof storageKey === "string") {
    return storageKey;
  }
  return storageKey.getKey();
};

const getSavedSizes = () => {
  if (typeof window === "undefined") return defaultSizes;
  const key = getStorageKey();
  const saved = localStorage.getItem(key);
  // ... æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯
};
```

**ç†ç”±:**

- ãƒœãƒ¼ãƒ‰ç”»é¢ã§ã¯é¸æŠçŠ¶æ…‹ã«ã‚ˆã£ã¦ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼ãŒå¤‰ã‚ã‚‹
- å‹•çš„ãªã‚­ãƒ¼ç”Ÿæˆã«å¯¾å¿œ

---

### Phase 2: BoardDetailScreen ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

#### 2-1. ControlPanelLayout ã¸ã®ç½®ãæ›ãˆæº–å‚™

**ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/components/screens/board-detail-screen-3panel.tsx`

**å‰Šé™¤å¯¾è±¡ã‚³ãƒ¼ãƒ‰ï¼ˆè¡Œç•ªå·: 681-809ï¼‰:**

- `panelSizesSelected` ã®çŠ¶æ…‹ç®¡ç†
- `panelSizesUnselected` ã®çŠ¶æ…‹ç®¡ç†
- `mountCountSelected` / `mountCountUnselected`
- `handlePanelResizeSelected` / `handlePanelResizeUnselected`
- `saveTimerSelected` / `saveTimerUnselected`

**ç†ç”±:**

- ã“ã‚Œã‚‰ã®æ©Ÿèƒ½ã¯æ‹¡å¼µå¾Œã® ControlPanelLayout ã§æä¾›ã•ã‚Œã‚‹

#### 2-2. ControlPanelLayout ã®é©ç”¨

**å¤‰æ›´ç®‡æ‰€1: é¸æŠæ™‚ã®ãƒ‘ãƒãƒ«ï¼ˆè¡Œç•ªå·: 1308-1812ä»˜è¿‘ï¼‰**

```typescript
// Before: ResizablePanelGroup ã‚’ç›´æ¥ä½¿ç”¨
<ResizablePanelGroup
  key={`selected-${visiblePanels}panel-${listOrder}-${detailOrder}-${commentOrder}`}
  direction="horizontal"
  className="flex-1"
  onLayout={handlePanelResizeSelected}
>
  {/* ãƒ‘ãƒãƒ«å®šç¾© */}
</ResizablePanelGroup>

// After: ControlPanelLayout ã‚’ä½¿ç”¨
<ControlPanelLayout
  leftPanel={showListPanel ? listPanelJSX : null}
  centerPanel={showDetailPanel ? detailPanelJSX : null}
  rightPanel={showCommentPanel ? commentPanelJSX : null}
  storageKey={{
    getKey: () => "team-board-panel-sizes-selected"
  }}
  defaultSizes={{ left: 25, center: 45, right: 30 }}
  skipInitialSave={true}
  stateKey={`${selectedMemo?.originalId || selectedTask?.originalId}`}
  debounceMs={500}
/>
```

**å¤‰æ›´ç®‡æ‰€2: éé¸æŠæ™‚ã®ãƒ‘ãƒãƒ«ï¼ˆè¡Œç•ªå·: 2112-2400ä»˜è¿‘ï¼‰**

```typescript
// After: ControlPanelLayout ã‚’ä½¿ç”¨
<ControlPanelLayout
  leftPanel={showMemo ? memoPanelJSX : null}
  centerPanel={showTask ? taskPanelJSX : null}
  rightPanel={showComment ? commentPanelJSX : null}
  storageKey={{
    getKey: () => "team-board-panel-sizes-unselected"
  }}
  defaultSizes={{ left: 33, center: 34, right: 33 }}
  skipInitialSave={true}
  stateKey="unselected"
  debounceMs={500}
/>
```

**æ³¨æ„ç‚¹:**

- æ—¢å­˜ã®ãƒ‘ãƒãƒ«å†…å®¹ï¼ˆJSXï¼‰ã¯ä¿æŒã—ã€ControlPanelLayoutã®propsã¨ã—ã¦æ¸¡ã™
- ãƒ‘ãƒãƒ«ã®è¡¨ç¤º/éè¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã¯ `leftPanel={showXXX ? content : null}` ã§åˆ¶å¾¡
- æ—¢å­˜ã®ResizablePanelå®šç¾©ã‚’ã€ç´”ç²‹ãªJSXã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«å¤‰æ›ã™ã‚‹

---

### Phase 3: ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ç”»é¢ã®æ”¹å–„

#### 3-1. åˆå›ãƒã‚¦ãƒ³ãƒˆå¯¾ç­–ã®è¿½åŠ 

**ãƒ•ã‚¡ã‚¤ãƒ«:**

- `apps/web/components/screens/memo-screen.tsx`
- `apps/web/components/screens/task-screen.tsx`

**å¤‰æ›´å†…å®¹:**

```typescript
// ç¾åœ¨
<ControlPanelLayout
  leftPanel={leftPanelContent}
  centerPanel={centerPanelContent}
  rightPanel={rightPanelContent}
  storageKey="team-memo-3panel-sizes-v2"
  defaultSizes={{ left: 25, center: 50, right: 25 }}
/>

// æ”¹å–„å¾Œ
<ControlPanelLayout
  leftPanel={leftPanelContent}
  centerPanel={centerPanelContent}
  rightPanel={rightPanelContent}
  storageKey="team-memo-3panel-sizes-v2"
  defaultSizes={{ left: 25, center: 50, right: 25 }}
  skipInitialSave={true}
  stateKey={selectedMemo?.originalId || "none"}
/>
```

**ç†ç”±:**

- é¸æŠçŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸæ™‚ã®èª¤ä¿å­˜ã‚’é˜²ã
- ãƒœãƒ¼ãƒ‰ç”»é¢ã¨åŒã˜å“è³ªãƒ¬ãƒ™ãƒ«ã«æƒãˆã‚‹

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### æ‰‹å‹•ãƒ†ã‚¹ãƒˆé …ç›®

#### 1. ãƒ¡ãƒ¢ç”»é¢

- [ ] ãƒ‘ãƒãƒ«å¹…ã‚’å¤‰æ›´ã—ã¦ä¿å­˜ã•ã‚Œã‚‹
- [ ] ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã«å¹…ãŒå¾©å…ƒã•ã‚Œã‚‹
- [ ] ç•°ãªã‚‹ãƒ¡ãƒ¢ã‚’é¸æŠã—ã¦ã‚‚ãƒ‘ãƒãƒ«å¹…ãŒç¶­æŒã•ã‚Œã‚‹
- [ ] ãƒãƒ¼ãƒ /å€‹äººãƒ¢ãƒ¼ãƒ‰ã§åˆ¥ã€…ã«ä¿å­˜ã•ã‚Œã‚‹

#### 2. ã‚¿ã‚¹ã‚¯ç”»é¢

- [ ] ãƒ‘ãƒãƒ«å¹…ã‚’å¤‰æ›´ã—ã¦ä¿å­˜ã•ã‚Œã‚‹
- [ ] ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã«å¹…ãŒå¾©å…ƒã•ã‚Œã‚‹
- [ ] ç•°ãªã‚‹ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã—ã¦ã‚‚ãƒ‘ãƒãƒ«å¹…ãŒç¶­æŒã•ã‚Œã‚‹
- [ ] ãƒãƒ¼ãƒ /å€‹äººãƒ¢ãƒ¼ãƒ‰ã§åˆ¥ã€…ã«ä¿å­˜ã•ã‚Œã‚‹

#### 3. ãƒœãƒ¼ãƒ‰è©³ç´°ç”»é¢

- [ ] é¸æŠæ™‚ã®ãƒ‘ãƒãƒ«å¹…ãŒä¿å­˜ã•ã‚Œã‚‹
- [ ] éé¸æŠæ™‚ã®ãƒ‘ãƒãƒ«å¹…ãŒä¿å­˜ã•ã‚Œã‚‹
- [ ] é¸æŠâ‡”éé¸æŠã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‚ã€ãã‚Œãã‚Œã®å¹…ãŒä¿æŒã•ã‚Œã‚‹
- [ ] ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã«ä¸¡æ–¹ã®çŠ¶æ…‹ã®å¹…ãŒæ­£ã—ãå¾©å…ƒã•ã‚Œã‚‹
- [ ] ãƒ‘ãƒãƒ«ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹

#### 4. åˆå›ãƒã‚¦ãƒ³ãƒˆå¯¾ç­–

- [ ] ãƒ¡ãƒ¢ã‚’é¸æŠâ†’åˆ¥ã®ãƒ¡ãƒ¢ã‚’é¸æŠâ†’ãƒ‘ãƒãƒ«å¹…ãŒæ„å›³ã›ãšå¤‰æ›´ã•ã‚Œãªã„
- [ ] ã‚¿ã‚¹ã‚¯ã‚’é¸æŠâ†’åˆ¥ã®ã‚¿ã‚¹ã‚¯ã‚’é¸æŠâ†’ãƒ‘ãƒãƒ«å¹…ãŒæ„å›³ã›ãšå¤‰æ›´ã•ã‚Œãªã„
- [ ] ãƒœãƒ¼ãƒ‰ã§ã‚¢ã‚¤ãƒ†ãƒ é¸æŠâ†’åˆ¥ã‚¢ã‚¤ãƒ†ãƒ é¸æŠâ†’ãƒ‘ãƒãƒ«å¹…ãŒæ„å›³ã›ãšå¤‰æ›´ã•ã‚Œãªã„

#### 5. localStorageç¢ºèª

```javascript
// ãƒ–ãƒ©ã‚¦ã‚¶ã®DevToolsã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å®Ÿè¡Œ
Object.keys(localStorage)
  .filter((key) => key.includes("panel"))
  .forEach((key) => {
    console.log(key, localStorage.getItem(key));
  });
```

---

## ğŸš¨ å½±éŸ¿ç¯„å›²ãƒ»æ‡¸å¿µç‚¹

### å½±éŸ¿ç¯„å›²

1. **ControlPanelLayout ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**
   - Propsæ‹¡å¼µï¼ˆå¾Œæ–¹äº’æ›æ€§ç¶­æŒï¼‰
   - å†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´

2. **BoardDetailScreen**
   - å¤§å¹…ãªãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
   - ç´„400è¡Œã®ã‚³ãƒ¼ãƒ‰å‰Šæ¸›

3. **MemoScreen / TaskScreen**
   - Propsè¿½åŠ ã®ã¿ï¼ˆè»½å¾®ãªå¤‰æ›´ï¼‰

### æ‡¸å¿µç‚¹

#### 1. ãƒœãƒ¼ãƒ‰ç”»é¢ã®è¤‡é›‘æ€§

- ãƒœãƒ¼ãƒ‰ç”»é¢ã¯å‹•çš„ãªãƒ‘ãƒãƒ«æ§‹æˆãŒå¤šã„
- ãƒ‘ãƒãƒ«ã®é †åºå¤‰æ›´ï¼ˆorderå±æ€§ï¼‰ã¨ã®ç›¸æ€§ç¢ºèªãŒå¿…è¦
- minSize/maxSize ã®è¨­å®šãŒ ControlPanelLayout ã§å¯¾å¿œã§ãã‚‹ã‹

**å¯¾ç­–:**

- ControlPanelLayout ã« minSize/maxSize ã®propsè¿½åŠ ã‚’æ¤œè¨
- ã¾ãŸã¯ã€ãƒœãƒ¼ãƒ‰ç”»é¢ã®ã¿æ®µéšçš„ã«ç§»è¡Œ

#### 2. æ—¢å­˜ã®ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¨ã®äº’æ›æ€§

- storageKeyã¯å¤‰æ›´ã—ãªã„ãŸã‚ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¯ç¶­æŒã•ã‚Œã‚‹
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å½±éŸ¿ãªã—

#### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- ãƒ‡ãƒã‚¦ãƒ³ã‚¹å‡¦ç†ãŒã‚ã‚‹ãŸã‚å•é¡Œãªã—
- useState ã®å‰Šæ¸›ã§ã‚€ã—ã‚æ”¹å–„ã®å¯èƒ½æ€§

---

## ğŸ“… å®Ÿè£…å„ªå…ˆé †ä½

### ğŸ¥‡ å„ªå…ˆåº¦: é«˜ï¼ˆPhase 1ï¼‰

ControlPanelLayout ã®æ‹¡å¼µã‚’å…ˆã«å®Ÿæ–½ã—ã€æ—¢å­˜ç”»é¢ã¸ã®å½±éŸ¿ã‚’æœ€å°åŒ–

### ğŸ¥ˆ å„ªå…ˆåº¦: ä¸­ï¼ˆPhase 3ï¼‰

ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ç”»é¢ã®æ”¹å–„ï¼ˆå°è¦æ¨¡ãªå¤‰æ›´ã§åŠ¹æœå¤§ï¼‰

### ğŸ¥‰ å„ªå…ˆåº¦: ä½ï¼ˆPhase 2ï¼‰

ãƒœãƒ¼ãƒ‰ç”»é¢ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆå¤§è¦æ¨¡ã ãŒã€æ©Ÿèƒ½çš„ã«ã¯æ—¢ã«å‹•ä½œã—ã¦ã„ã‚‹ï¼‰

---

## ğŸ“ Codexç”¨ToDoãƒªã‚¹ãƒˆ

### Step 1: ControlPanelLayout æ‹¡å¼µ

- [ ] `apps/web/components/layout/control-panel-layout.tsx` ã‚’é–‹ã
- [ ] Propså‹å®šç¾©ã«ä»¥ä¸‹ã‚’è¿½åŠ :
  - `skipInitialSave?: boolean`
  - `stateKey?: string`
  - `debounceMs?: number`
  - `storageKey` ã®å‹ã‚’ `string | { getKey: () => string }` ã«å¤‰æ›´
- [ ] `mountCount` ã®useRefã‚’è¿½åŠ 
- [ ] `stateKey` å¤‰åŒ–æ™‚ã«mountCountã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹useEffectã‚’è¿½åŠ 
- [ ] `getStorageKey()` ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’å®Ÿè£…
- [ ] `handleLayout` å†…ã«åˆå›ãƒã‚¦ãƒ³ãƒˆåˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
- [ ] ãƒ‡ãƒã‚¦ãƒ³ã‚¹æ™‚é–“ã‚’ `debounceMs ?? 300` ã§å¯å¤‰ã«ã™ã‚‹
- [ ] æ—¢å­˜ã®ä½¿ç”¨ç®‡æ‰€ï¼ˆmemo-screen, task-screenï¼‰ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºãªã„ã‹ç¢ºèª

### Step 2: ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ç”»é¢ã®æ”¹å–„

- [ ] `apps/web/components/screens/memo-screen.tsx` ã‚’é–‹ã
- [ ] ControlPanelLayout ã®å‘¼ã³å‡ºã—ã«ä»¥ä¸‹ã‚’è¿½åŠ :
  - `skipInitialSave={true}`
  - `stateKey={selectedMemo?.originalId || "none"}`
- [ ] `apps/web/components/screens/task-screen.tsx` ã‚’é–‹ã
- [ ] ControlPanelLayout ã®å‘¼ã³å‡ºã—ã«ä»¥ä¸‹ã‚’è¿½åŠ :
  - `skipInitialSave={true}`
  - `stateKey={selectedTask?.originalId || "none"}`

### Step 3: ãƒœãƒ¼ãƒ‰ç”»é¢ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ï¼ˆå¤§è¦æ¨¡å¤‰æ›´ï¼‰

âš ï¸ **ã“ã®æ‰‹é †ã¯æ…é‡ã«å®Ÿæ–½ã™ã‚‹ã“ã¨**

- [ ] `apps/web/components/screens/board-detail-screen-3panel.tsx` ã‚’é–‹ã
- [ ] 681-809è¡Œç›®ã®ä»¥ä¸‹ã‚’å‰Šé™¤:
  - `panelSizesSelected` ã®çŠ¶æ…‹å®šç¾©
  - `panelSizesUnselected` ã®çŠ¶æ…‹å®šç¾©
  - `mountCountSelected` / `mountCountUnselected`
  - `handlePanelResizeSelected` / `handlePanelResizeUnselected`
  - `saveTimerSelected` / `saveTimerUnselected`
- [ ] é¸æŠæ™‚ã®ResizablePanelGroupï¼ˆ1308è¡Œç›®ä»˜è¿‘ï¼‰ã‚’ControlPanelLayoutã«ç½®ãæ›ãˆ
  - å„ãƒ‘ãƒãƒ«ã®JSXã‚’leftPanel/centerPanel/rightPanelã«åˆ†é›¢
  - storageKey: `{ getKey: () => "team-board-panel-sizes-selected" }`
  - defaultSizes: `{ left: 25, center: 45, right: 30 }`
  - skipInitialSave: `true`
  - stateKey: é¸æŠä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ã®originalId
  - debounceMs: `500`
- [ ] éé¸æŠæ™‚ã®ResizablePanelGroupï¼ˆ2112è¡Œç›®ä»˜è¿‘ï¼‰ã‚’ControlPanelLayoutã«ç½®ãæ›ãˆ
  - åŒæ§˜ã«ãƒ‘ãƒãƒ«ã‚’åˆ†é›¢
  - storageKey: `{ getKey: () => "team-board-panel-sizes-unselected" }`
  - defaultSizes: `{ left: 33, center: 34, right: 33 }`
  - skipInitialSave: `true`
  - stateKey: `"unselected"`
  - debounceMs: `500`

### Step 4: å‹•ä½œç¢ºèª

- [ ] `npm run check:wsl` ã§ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‹ç¢ºèª
- [ ] å„ç”»é¢ã§ãƒ‘ãƒãƒ«ã®ãƒªã‚µã‚¤ã‚ºå‹•ä½œã‚’ç¢ºèª
- [ ] localStorage ã«æ­£ã—ãä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- [ ] ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã«å¾©å…ƒã•ã‚Œã‚‹ã‹ç¢ºèª

---

## ğŸ“Œ è£œè¶³äº‹é …

### ControlPanelLayout ã® minSize/maxSize å¯¾å¿œã«ã¤ã„ã¦

ç¾åœ¨ã® ControlPanelLayout ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸåˆ¶ç´„ãŒã‚ã‚Šã¾ã™:

```typescript
<ResizablePanel
  defaultSize={panelSizes.left}
  minSize={20}  // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
  maxSize={50}  // ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰
  ...
/>
```

ãƒœãƒ¼ãƒ‰ç”»é¢ã§ã¯ç•°ãªã‚‹å€¤ãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚‰ã‚‚propsã§è¨­å®šå¯èƒ½ã«ã™ã‚‹ã“ã¨ã‚’æ¤œè¨:

```typescript
interface ControlPanelLayoutProps {
  // ... æ—¢å­˜ã®props

  minSizes?: {
    left?: number;
    center?: number;
    right?: number;
  };
  maxSizes?: {
    left?: number;
    center?: number;
    right?: number;
  };
}
```

ãŸã ã—ã€ã“ã‚Œã¯å¿…é ˆã§ã¯ãªãã€Phase 2ã®å®Ÿè£…æ™‚ã«å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã™ã‚‹ã€‚

---

## âœ… å®Œäº†æ¡ä»¶

- [ ] ã™ã¹ã¦ã®PhaseãŒå®Ÿè£…å®Œäº†
- [ ] å‹ã‚¨ãƒ©ãƒ¼ãƒ»Lintã‚¨ãƒ©ãƒ¼ãªã—
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆé …ç›®ã™ã¹ã¦ãƒ‘ã‚¹
- [ ] æ—¢å­˜ã®localStorageãƒ‡ãƒ¼ã‚¿ãŒæ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹
- [ ] ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- [ ] ã“ã®è¨ˆç”»æ›¸ã‚’ `.claude/fixed-plans/` ã«ç§»å‹•

---

**æœ€çµ‚æ›´æ–°æ—¥:** 2025-11-11
