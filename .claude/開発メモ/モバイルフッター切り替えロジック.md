# ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒƒã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆãƒ­ã‚¸ãƒƒã‚¯å®Œå…¨ã‚¬ã‚¤ãƒ‰

## ğŸ¯ 1. ãƒ•ãƒƒã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã®æ ¸å¿ƒãƒ­ã‚¸ãƒƒã‚¯ï¼ˆæœ€é‡è¦ï¼‰

### ã©ã“ã‚’è¦‹ã‚Œã°ã„ã„ï¼Ÿ

**[sidebar.tsx:170-174](apps/web/components/layout/sidebar.tsx#L170-L174)**

```typescript
// ãƒ¢ãƒã‚¤ãƒ«ã§ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯å°‚ç”¨ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¡¨ç¤º
// æ–°è¦ä½œæˆæ™‚ï¼ˆselectedMemoId === null ã‹ã¤ isCreatingMemo === trueï¼‰ã‚‚å«ã‚€
const isShowingMemoEditor = selectedMemoId !== undefined || isCreatingMemo;

// ãƒ¢ãƒã‚¤ãƒ«ã§ã‚¿ã‚¹ã‚¯ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãŒé–‹ã„ã¦ã„ã‚‹å ´åˆã¯å°‚ç”¨ãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¡¨ç¤º
// æ–°è¦ä½œæˆæ™‚ã‚‚å«ã‚€
const isShowingTaskEditor = selectedTaskId !== undefined || isCreatingTask;
```

**ğŸ‘‰ ã“ã®2ã¤ã®å¤‰æ•°ãŒ `true` ã«ãªã‚‹ã¨ãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒƒã‚¿ãƒ¼ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼**

---

## ğŸ”„ 2. ãƒ•ãƒƒã‚¿ãƒ¼è¡¨ç¤ºã®å„ªå…ˆé †ä½

**[sidebar.tsx:177-262](apps/web/components/layout/sidebar.tsx#L177-L262)**

```
å„ªå…ˆé †ä½: ã‚¿ã‚¹ã‚¯ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãƒ•ãƒƒã‚¿ãƒ¼ > ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãƒ•ãƒƒã‚¿ãƒ¼ > é€šå¸¸ãƒ•ãƒƒã‚¿ãƒ¼ (null)
```

```typescript
const mobileFooter = isShowingTaskEditor ? (
  // ã‚¿ã‚¹ã‚¯ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ç”¨ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆItemEditorFooter type="task"ï¼‰
  <ItemEditorFooter type="task" ... />
) : isShowingMemoEditor ? (
  // ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ç”¨ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆItemEditorFooter type="memo"ï¼‰
  <ItemEditorFooter type="memo" ... />
) : null;
  // é€šå¸¸æ™‚ã¯ãƒ•ãƒƒã‚¿ãƒ¼ãªã—ï¼ˆé€šå¸¸ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹ï¼‰
```

---

## ğŸ“ 3. é‡è¦ãªå¤‰æ•°ã®è¿½è·¡å ´æ‰€

### å€‹äººãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ«ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ï¼‰

#### `isCreatingMemo` ã¨ `isCreatingTask` ã®ç”Ÿæˆ

**[main-client-mobile.tsx:59-60](apps/web/components/client/main-client-mobile.tsx#L59-L60)**

```typescript
const isCreatingMemo = screenMode === "create" && currentMode === "memo";
const isCreatingTask = screenMode === "create" && currentMode === "task";
```

ğŸ‘‰ `screenMode` ãŒ `"create"` ã‹ã¤ `currentMode` ãŒ `"memo"` or `"task"` ã§åˆ¤å®š

#### `selectedMemoId` ã¨ `selectedTaskId`

- è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ`page.tsx` ãªã©ï¼‰ã‹ã‚‰ Props ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹
- ãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯ã‚’é¸æŠã™ã‚‹ã¨ `undefined` ä»¥å¤–ã®å€¤ã«ãªã‚‹

---

### ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ï¼ˆ`/team/[customUrl]` ãƒšãƒ¼ã‚¸ï¼‰

#### `isCreatingMemo` ã¨ `isCreatingTask` ã®ç®¡ç†

**[team-detail-context.tsx:46-47](apps/web/src/contexts/team-detail-context.tsx#L46-L47)**

```typescript
const [isCreatingMemo, setIsCreatingMemo] = useState(false);
const [isCreatingTask, setIsCreatingTask] = useState(false);
```

ğŸ‘‰ TeamDetailContext ã§çŠ¶æ…‹ç®¡ç†ï¼ˆuseStateï¼‰

#### çŠ¶æ…‹ã®æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°ä¾‹

**[memo-screen.tsx:347](apps/web/components/screens/memo-screen.tsx#L347)**

```typescript
useEffect(() => {
  if (teamDetailContext) {
    teamDetailContext.setIsCreatingMemo(memoScreenMode === "create");
  }
}, [memoScreenMode, teamDetailContext]);
```

ğŸ‘‰ MemoScreenã®`memoScreenMode`ãŒ"create"ã«ãªã‚‹ã¨è‡ªå‹•çš„ã«Contextã‚’æ›´æ–°

---

### Sidebar ã§ã® Props ã¨ Context ã®çµ±åˆ

**[sidebar.tsx:89-100](apps/web/components/layout/sidebar.tsx#L89-L100)**

```typescript
let isCreatingMemo = isCreatingMemoProp ?? false;
let isCreatingTask = isCreatingTaskProp ?? false;

// ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯TeamDetailContextã‹ã‚‰ã‚‚å–å¾—
if (isTeamMode) {
  try {
    const teamDetail = useTeamDetail();
    isCreatingMemo = teamDetail.isCreatingMemo;
    isCreatingTask = teamDetail.isCreatingTask ?? false;
  } catch {
    // ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰å¤–ã§ã¯ç„¡è¦–
  }
}
```

ğŸ‘‰ ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã§ã¯ Context ã‚’å„ªå…ˆã€å€‹äººãƒ¢ãƒ¼ãƒ‰ã§ã¯ Props ã‚’ä½¿ç”¨

---

## ğŸª 4. ã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ å…¨ä½“å›³

### ã‚¤ãƒ™ãƒ³ãƒˆãƒ•ãƒ­ãƒ¼

```
ã€ç™ºç«å…ƒã€‘
Sidebar (ItemEditorFooter ã® onBack)
  â†“
ã€ç™ºç«ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã€‘
  å€‹äººãƒ¢ãƒ¼ãƒ‰:
    - memo-editor-mobile-back-requested    (ãƒ¡ãƒ¢ä¸€è¦§ã¸æˆ»ã‚‹)
    - task-editor-mobile-back-requested    (ã‚¿ã‚¹ã‚¯ä¸€è¦§ã¸æˆ»ã‚‹)

  ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰:
    - team-back-to-memo-list              (ãƒ¡ãƒ¢ä¸€è¦§ã¸æˆ»ã‚‹)
    - team-back-to-task-list              (ã‚¿ã‚¹ã‚¯ä¸€è¦§ã¸æˆ»ã‚‹)
  â†“
ã€å—ä¿¡ãƒ»å‡¦ç†ã€‘
  å€‹äººãƒ¢ãƒ¼ãƒ‰:
    - memo-editor.tsx (ãƒ¡ãƒ¢ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼æœ¬ä½“)
    - task-screen.tsx (ã‚¿ã‚¹ã‚¯ç”»é¢)
    - create-screen.tsx (æ–°è¦ä½œæˆç”»é¢)
    - memo-screen.tsx (ãƒ¡ãƒ¢ä¸€è¦§ç”»é¢)

  ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰:
    - memo-screen.tsx (team-back-to-memo-list ã‚’å—ä¿¡)
    - task-screen.tsx (team-back-to-task-list ã‚’å—ä¿¡)
    - team-detail.tsx (ä¸¡ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ã—ã¦çŠ¶æ…‹æ›´æ–°)
```

### ã‚¤ãƒ™ãƒ³ãƒˆåã®ä½¿ã„åˆ†ã‘

**ãƒ¡ãƒ¢ã®æˆ»ã‚‹ãƒœã‚¿ãƒ³ - [sidebar.tsx:228-234](apps/web/components/layout/sidebar.tsx#L228-L234)**

```typescript
const backEventName = isTeamMode
  ? "team-back-to-memo-list"
  : "memo-editor-mobile-back-requested";
window.dispatchEvent(new CustomEvent(backEventName));
```

**ã‚¿ã‚¹ã‚¯ã®æˆ»ã‚‹ãƒœã‚¿ãƒ³ - [sidebar.tsx:182-185](apps/web/components/layout/sidebar.tsx#L182-L185)**

```typescript
const backEventName = isTeamMode
  ? "team-back-to-task-list"
  : "task-editor-mobile-back-requested";
window.dispatchEvent(new CustomEvent(backEventName));
```

ğŸ‘‰ ãƒãƒ¼ãƒ /å€‹äººã§ã‚¤ãƒ™ãƒ³ãƒˆåã‚’åˆ‡ã‚Šæ›¿ãˆ

---

## ğŸ“‚ 5. å„ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ã¨é‡è¦ãªè¡Œç•ªå·

ã™ã¹ã¦ `apps/web/components/` é…ä¸‹

| ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹                             | å½¹å‰²                           | é‡è¦ãªè¡Œç•ªå·             | èª¬æ˜                                              |
| ---------------------------------------- | ------------------------------ | ------------------------ | ------------------------------------------------- |
| **layout/sidebar.tsx**                   | **ãƒ•ãƒƒã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆæœ¬ä½“**       | **89-100, 170-262, 272** | Props/Contextçµ±åˆã€åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ•ãƒƒã‚¿ãƒ¼è¡¨ç¤ºåˆ¶å¾¡ |
| **mobile/item-editor-footer.tsx**        | ãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯/ãƒœãƒ¼ãƒ‰çµ±åˆãƒ•ãƒƒã‚¿ãƒ¼ | å…¨ä½“                     | type prop ã§ãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯/ãƒœãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆ          |
| **mobile/mobile-fab-button.tsx**         | æ–°è¦ä½œæˆFABãƒœã‚¿ãƒ³              | å…¨ä½“                     | ãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯ã®FABãƒœã‚¿ãƒ³ã‚’çµ±ä¸€åŒ–                    |
| **client/main-client-mobile.tsx**        | å€‹äººãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç”Ÿæˆ             | 59-60, 91-92             | screenMode ã‹ã‚‰ isCreating åˆ¤å®š                   |
| **src/contexts/team-detail-context.tsx** | ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç®¡ç†           | 46-47, 65-67             | Context ã§çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†                          |
| **features/team/team-detail.tsx**        | ãƒãƒ¼ãƒ ãƒšãƒ¼ã‚¸æœ¬ä½“               | 450-462, 980-996         | ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€Contextæ›´æ–°                   |
| **screens/memo-screen.tsx**              | ãƒ¡ãƒ¢ä¸€è¦§ç”»é¢                   | 347, 653-688             | Context æ›´æ–° + ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡                       |
| **screens/task-screen.tsx**              | ã‚¿ã‚¹ã‚¯ç”»é¢                     | 389-414                  | ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡å‡¦ç†                                  |

---

## ğŸ” 6. ãƒ‡ãƒãƒƒã‚°æ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆ

### ãƒ•ãƒƒã‚¿ãƒ¼ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‰ãªã„å ´åˆ

1. **åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’ç¢ºèª**
   - `sidebar.tsx:170-174` ã® `isShowingMemoEditor` / `isShowingTaskEditor` ã®å€¤ã‚’ãƒ­ã‚°å‡ºåŠ›
   - `selectedMemoId !== undefined` ã¾ãŸã¯ `isCreatingMemo` ãŒ `true` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ

2. **Props/Context ã®å€¤ã‚’ç¢ºèª**
   - å€‹äººãƒ¢ãƒ¼ãƒ‰: `main-client-mobile.tsx:59-60` ã® `screenMode` ã¨ `currentMode` ã‚’ãƒ­ã‚°å‡ºåŠ›
   - ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰: `team-detail-context.tsx:46-47` ã®çŠ¶æ…‹ã‚’ãƒ­ã‚°å‡ºåŠ›

3. **Sidebar ã¸ã®ä¼æ’­ã‚’ç¢ºèª**
   - `sidebar.tsx:89-100` ã§ Props/Context ãŒæ­£ã—ãçµ±åˆã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
   - `isTeamMode` ã®åˆ¤å®šãŒæ­£ã—ã„ã‹ï¼Ÿ

4. **è¡¨ç¤ºæ¡ä»¶ã‚’ç¢ºèª**
   - `sidebar.tsx:272` ã® `className` ã« `hidden md:flex` ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
   - ãƒ¢ãƒã‚¤ãƒ«æ™‚ã«é€šå¸¸ãƒ•ãƒƒã‚¿ãƒ¼ãŒéè¡¨ç¤ºã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ

### ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ãªã„å ´åˆ

1. **ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ç¢ºèª**
   - ãƒãƒ¼ãƒ /å€‹äººã§æ­£ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆåãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
   - `sidebar.tsx:182-185, 228-234` ã®ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ç¢ºèª

2. **ãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²ã‚’ç¢ºèª**
   - è©²å½“ç”»é¢ï¼ˆmemo-screen, task-screen ãªã©ï¼‰ã§ãƒªã‚¹ãƒŠãƒ¼ãŒç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ
   - `useEffect` ã®ä¾å­˜é…åˆ—ãŒæ­£ã—ã„ã‹ï¼Ÿ

3. **ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã‚’ç¢ºèª**
   - `console.log` ã§ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ã‚’ç¢ºèª
   - ãƒ­ã‚°ã«å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿ

---

## ğŸ’¡ 7. ã‚ˆãã‚ã‚‹å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: æ–°è¦ä½œæˆæ™‚ã«ãƒ•ãƒƒã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› :** `isCreatingMemo` / `isCreatingTask` ãŒ `false` ã®ã¾ã¾

**ç¢ºèªç®‡æ‰€:**

- å€‹äººãƒ¢ãƒ¼ãƒ‰: `screenMode` ãŒ `"create"` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ
- ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰: Context ã® `isCreatingMemo` ãŒ `true` ã«ãªã£ã¦ã„ã‚‹ã‹ï¼Ÿ

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: é€šå¸¸ãƒ•ãƒƒã‚¿ãƒ¼ã¨ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ãƒ•ãƒƒã‚¿ãƒ¼ãŒä¸¡æ–¹è¡¨ç¤ºã•ã‚Œã‚‹

**åŸå› :** `sidebar.tsx:272` ã®æ¡ä»¶åˆ†å²ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ãªã„

**ç¢ºèªç®‡æ‰€:**

```typescript
className={`... ${isShowingMemoEditor ? "hidden md:flex" : "flex"}`}
```

ğŸ‘‰ `isShowingMemoEditor` ãŒ `true` ã®æ™‚ã«ãƒ¢ãƒã‚¤ãƒ«ã§ `hidden` ã«ãªã‚‹ã‹ï¼Ÿ

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ãƒãƒ¼ãƒ /å€‹äººã§ãƒ•ãƒƒã‚¿ãƒ¼ã®å‹•ä½œãŒç•°ãªã‚‹

**åŸå› :** ã‚¤ãƒ™ãƒ³ãƒˆåã®ä¸ä¸€è‡´ã€ã¾ãŸã¯ Context ã®ä½¿ã„åˆ†ã‘ãƒŸã‚¹

**ç¢ºèªç®‡æ‰€:**

- `sidebar.tsx:89-100` ã® `isTeamMode` åˆ¤å®š
- `sidebar.tsx:182-185, 228-234` ã®ã‚¤ãƒ™ãƒ³ãƒˆååˆ‡ã‚Šæ›¿ãˆ
- ãƒªã‚¹ãƒŠãƒ¼å´ã®ã‚¤ãƒ™ãƒ³ãƒˆåï¼ˆ`team-` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã®æœ‰ç„¡ï¼‰

---

## â• 8. ãƒ¢ãƒã‚¤ãƒ«å³ä¸‹ã®æ–°è¦è¿½åŠ ãƒœã‚¿ãƒ³ï¼ˆFABï¼‰

### å…±é€šåŒ–ã•ã‚ŒãŸFABãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

**[mobile-fab-button.tsx](apps/web/components/ui/buttons/mobile-fab-button.tsx)**

```typescript
export default function MobileFabButton({
  type,
  teamMode,
  show = true,
}: MobileFabButtonProps) {
  const config = {
    memo: {
      color: "bg-Green hover:bg-Green/90",
      eventName: teamMode ? "team-memo-create" : "personal-memo-create",
    },
    task: {
      color: "bg-DeepBlue hover:bg-DeepBlue/90",
      eventName: teamMode ? "team-task-create" : "personal-task-create",
    },
  };
  // ...
}
```

### ä½¿ç”¨ä¾‹

**ãƒ¡ãƒ¢ä¸€è¦§ç”»é¢ - [memo-screen.tsx:1023-1027](apps/web/components/screens/memo-screen.tsx#L1023-L1027)**

```typescript
<MobileFabButton
  type="memo"
  teamMode={teamMode}
  show={activeTab !== "deleted"}
/>
```

**ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢ - [task-screen.tsx](apps/web/components/screens/task-screen.tsx)**

```typescript
<MobileFabButton
  type="task"
  teamMode={teamMode}
  show={activeTab !== "deleted"}
/>
```

### ãƒ‡ã‚¶ã‚¤ãƒ³ä»•æ§˜

**é…ç½®:**

- `fixed bottom-16 right-2`: ä¸‹éƒ¨ãƒ•ãƒƒã‚¿ãƒ¼ï¼ˆh-14ï¼‰ã®ä¸Šã€å³ç«¯ã‹ã‚‰8px
- `size-9`: 36px Ã— 36pxï¼ˆæ­£å††ï¼‰
- `z-20`: ãƒ•ãƒƒã‚¿ãƒ¼ã‚ˆã‚Šå‰é¢ã«è¡¨ç¤º

**ã‚«ãƒ©ãƒ¼:**

- ãƒ¡ãƒ¢: `bg-Green` (ç·‘è‰²)
- ã‚¿ã‚¹ã‚¯: `bg-DeepBlue` (é’è‰²)

**è¡¨ç¤ºæ¡ä»¶:**

- `md:hidden`: ãƒ¢ãƒã‚¤ãƒ«ã®ã¿è¡¨ç¤ºï¼ˆPC ã§ã¯éè¡¨ç¤ºï¼‰
- ãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯ä¸€è¦§ç”»é¢ã§ã®ã¿è¡¨ç¤º
- ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ç”»é¢ã§ã¯éè¡¨ç¤ºï¼ˆãƒ•ãƒƒã‚¿ãƒ¼ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼‰
- å‰Šé™¤æ¸ˆã¿ã‚¿ãƒ–ã§ã¯éè¡¨ç¤º

### å‹•ä½œ

1. **ã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†:**
   - ãƒãƒ¼ãƒ /å€‹äººãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ãŸã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
   - `team-memo-create` / `personal-memo-create`
   - `team-task-create` / `personal-task-create`

2. **ãƒ•ãƒƒã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã¨ã®é€£æº:**
   ```
   FABãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
     â†“
   ã‚¤ãƒ™ãƒ³ãƒˆç™ºç«ï¼ˆteam-memo-create ãªã©ï¼‰
     â†“
   MemoScreen/TaskScreen ãŒã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
     â†“
   handleCreateNew() å®Ÿè¡Œ â†’ screenMode ãŒ "create" ã«
     â†“
   isCreatingMemo / isCreatingTask ãŒ true ã«
     â†“
   sidebar.tsx:170-174 ã®åˆ¤å®šã§ isShowingMemoEditor / isShowingTaskEditor ãŒ true ã«
     â†“
   ãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒƒã‚¿ãƒ¼ãŒã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ç”¨ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹
     â†“
   FABãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºã«ãªã‚‹ï¼ˆã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ç”»é¢ã®ãŸã‚ï¼‰
   ```

---

## ğŸ”§ 9. ãƒãƒ¼ãƒ å´ã®æ–°è¦ä½œæˆãƒ»æˆ»ã‚‹å‡¦ç†ï¼ˆé‡è¦ï¼‰

### ãƒãƒ¼ãƒ å´ã®æ–°è¦ä½œæˆã‹ã‚‰ä¸€è¦§ã«æˆ»ã‚‹ãƒ•ãƒ­ãƒ¼

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒFABãƒœã‚¿ãƒ³ï¼ˆå³ä¸‹ã®+ãƒœã‚¿ãƒ³ï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. MobileFabButton ãŒ team-memo-create / team-task-create ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
   â†“
3. MemoScreen / TaskScreen ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡
   â†“
4. handleCreateNew() ãŒå®Ÿè¡Œã•ã‚Œã€memoScreenMode / taskScreenMode ãŒ "create" ã«
   â†“
5. MemoScreen ã® useEffect ã§ teamDetailContext.setIsCreatingMemo(true) ã‚’å®Ÿè¡Œ
   â†“
6. Sidebar ã® isCreatingMemo ãŒ true ã«ãªã‚Šã€ItemEditorFooter ãŒè¡¨ç¤ºã•ã‚Œã‚‹
   â†“
ã€æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã€‘
   â†“
7. Sidebar ãŒ team-back-to-memo-list / team-back-to-task-list ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
   â†“
8. MemoScreen / TaskScreen ãŒã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ä¿¡ï¼ˆhandleBackRequestï¼‰
   â†“
9. setMemoScreenMode("list") ã§æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ã‚’è§£é™¤ â† ã“ã‚ŒãŒé‡è¦ï¼
   â†“
10. onDeselectAndStayOnMemoList() ã‚’å‘¼ã³å‡ºã—
   â†“
11. team-detail.tsx ã® handleBackToMemoList ãŒå®Ÿè¡Œ
   â†“
12. setIsCreatingMemo(false) ã§çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
   â†“
13. Sidebar ã® isCreatingMemo ãŒ false ã«ãªã‚Šã€é€šå¸¸ãƒ•ãƒƒã‚¿ãƒ¼ã«æˆ»ã‚‹
   â†“
14. ãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
```

### é‡è¦ãªå®Ÿè£…ãƒã‚¤ãƒ³ãƒˆ

**[memo-screen.tsx:653-688](apps/web/components/screens/memo-screen.tsx#L653-L688)**

```typescript
const handleBackRequest = () => {
  // æ–°è¦ä½œæˆãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰æŠœã‘ã‚‹ï¼ˆã“ã‚ŒãŒãªã„ã¨ä¸€è¦§ã«æˆ»ã‚Œãªã„ï¼ï¼‰
  if (screenMode === "create") {
    console.log("â†’ setMemoScreenMode('list') ã‚’å‘¼ã³å‡ºã—");
    setMemoScreenMode("list");
  }

  if (onDeselectAndStayOnMemoList) {
    console.log("â†’ onDeselectAndStayOnMemoList() ã‚’å‘¼ã³å‡ºã—");
    onDeselectAndStayOnMemoList();
  } else {
    console.log("â†’ onSelectMemo(null) ã‚’å‘¼ã³å‡ºã—");
    onSelectMemo(null);
  }
};

// ãƒãƒ¼ãƒ /å€‹äººã§ç•°ãªã‚‹ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ãƒªãƒƒã‚¹ãƒ³
const backEventName = teamMode
  ? "team-back-to-memo-list"
  : "memo-editor-mobile-back-requested";
window.addEventListener(backEventName, handleBackRequest);
```

**[task-screen.tsx:389-414](apps/web/components/screens/task-screen.tsx#L389-L414)**

```typescript
const handleBackRequest = () => {
  const backEventName = teamMode
    ? "team-back-to-task-list"
    : "task-editor-mobile-back-requested";
  console.log(`ğŸ“± TaskScreen: ${backEventName} ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡`);
  // ã‚¿ã‚¹ã‚¯ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã‚’é–‰ã˜ã¦ãƒªã‚¹ãƒˆã«æˆ»ã‚‹
  console.log("â†’ onSelectTask(null) å‘¼ã³å‡ºã—");
  onSelectTaskRef.current(null);
};

// ãƒãƒ¼ãƒ /å€‹äººã§ç•°ãªã‚‹ã‚¤ãƒ™ãƒ³ãƒˆåã‚’ãƒªãƒƒã‚¹ãƒ³
const backEventName = teamMode
  ? "team-back-to-task-list"
  : "task-editor-mobile-back-requested";
window.addEventListener(backEventName, handleBackRequest);
```

**[team-detail.tsx:450-462, 980-996](apps/web/components/features/team/team-detail.tsx)**

```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
const handleBackToMemoList = (_event: CustomEvent) => {
  console.log("ğŸ“± team-back-to-memo-list ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡");
  setSelectedMemo(null);
  setSelectedDeletedMemo(null);
  setIsCreatingMemo(false); // â† Context ã®çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
  console.log("â†’ setIsCreatingMemo(false) å‘¼ã³å‡ºã—");
  // URLæ›´æ–° + router.replace
};

// MemoScreen ã«æ¸¡ã™ props
onDeselectAndStayOnMemoList={() => {
  console.log("ğŸ“± onDeselectAndStayOnMemoList å‘¼ã³å‡ºã—");
  // URLæ›´æ–° + çŠ¶æ…‹ã‚¯ãƒªã‚¢
  setSelectedMemo(null);
  setSelectedDeletedMemo(null);
  setIsCreatingMemo(false); // â† ã“ã‚Œã‚‚å¿…è¦ï¼
  console.log("â†’ setIsCreatingMemo(false) å®Œäº†");
}}
```

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºç­–

#### ã‚¨ãƒ©ãƒ¼1: æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚ä¸€è¦§ã«æˆ»ã‚‰ãªã„

**åŸå› :** `MemoScreen` / `TaskScreen` ã§ `setScreenMode("list")` ã‚’å‘¼ã‚“ã§ã„ãªã„

**è§£æ±º:** `handleBackRequest` å†…ã§ `screenMode === "create"` ã®æ™‚ã« `setScreenMode("list")` ã‚’å‘¼ã¶

#### ã‚¨ãƒ©ãƒ¼2: ã‚¤ãƒ™ãƒ³ãƒˆãŒå—ä¿¡ã•ã‚Œãªã„

**åŸå› :** ã‚¤ãƒ™ãƒ³ãƒˆåã®ä¸ä¸€è‡´ï¼ˆ`team-task-editor-mobile-back-requested` vs `team-back-to-task-list`ï¼‰

**è§£æ±º:** Sidebar ã¨ãƒªã‚¹ãƒŠãƒ¼å´ã®ã‚¤ãƒ™ãƒ³ãƒˆåã‚’çµ±ä¸€ã™ã‚‹

#### ã‚¨ãƒ©ãƒ¼3: ç„¡é™ãƒ«ãƒ¼ãƒ—ãŒç™ºç”Ÿã™ã‚‹

**åŸå› :** `team-detail.tsx` ãŒåŒã˜ã‚¤ãƒ™ãƒ³ãƒˆã‚’å†ç™ºç«ã—ã¦ã„ã‚‹

**è§£æ±º:** `team-detail.tsx` ã§ã¯ `team-memo-create` / `team-task-create` ã‚’ãƒªãƒƒã‚¹ãƒ³ã—ãªã„ï¼ˆMemoScreen/TaskScreen ã«ä»»ã›ã‚‹ï¼‰

---

## ğŸ—ï¸ 10. ãƒœãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸ã®ãƒ•ãƒƒã‚¿ãƒ¼

### ãƒãƒ¼ãƒ å´ã®ãƒœãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸å°‚ç”¨ãƒ•ãƒƒã‚¿ãƒ¼

**[team/[customUrl]/layout.tsx:350-377](apps/web/app/team/[customUrl]/layout.tsx#L350-L377)**

```typescript
{isTeamBoardDetailPage ? (
  // ãƒœãƒ¼ãƒ‰è©³ç´°å°‚ç”¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼šItemEditorFooterã‚’ä½¿ç”¨
  <ItemEditorFooter
    type="board"
    onBack={handleBackToBoardList}
    onMemoClick={() =>
      window.dispatchEvent(
        new CustomEvent("board-section-change", {
          detail: { section: "memos" },
        }),
      )
    }
    onTaskClick={() =>
      window.dispatchEvent(
        new CustomEvent("board-section-change", {
          detail: { section: "tasks" },
        }),
      )
    }
    onCommentClick={() =>
      window.dispatchEvent(
        new CustomEvent("board-section-change", {
          detail: { section: "comments" },
        }),
      )
    }
    activeSection={activeBoardSection}
  />
) : (
  // é€šå¸¸ã®ã‚µã‚¤ãƒ‰ãƒãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
  <Sidebar ... />
)}
```

### ItemEditorFooter ã® type="board" å¯¾å¿œ

**[item-editor-footer.tsx](apps/web/components/mobile/item-editor-footer.tsx)**

```typescript
interface BoardFooterProps {
  type: "board";
  onBack: () => void;
  onMemoClick: () => void;
  onTaskClick: () => void;
  onCommentClick: () => void;
  activeSection: "memos" | "tasks" | "comments";
  commentCount?: number;
}

type ItemEditorFooterProps = EditorFooterProps | BoardFooterProps;
```

### ãƒœãƒ¼ãƒ‰è©³ç´°ãƒ•ãƒƒã‚¿ãƒ¼ã®ãƒœã‚¿ãƒ³æ§‹æˆ

```
æˆ»ã‚‹ | ãƒ¡ãƒ¢ | ã‚¿ã‚¹ã‚¯ | ã‚³ãƒ¡ãƒ³ãƒˆ
```

- **æˆ»ã‚‹**: ãƒœãƒ¼ãƒ‰ä¸€è¦§ã«æˆ»ã‚‹
- **ãƒ¡ãƒ¢**: ãƒœãƒ¼ãƒ‰å†…ã®ãƒ¡ãƒ¢ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
- **ã‚¿ã‚¹ã‚¯**: ãƒœãƒ¼ãƒ‰å†…ã®ã‚¿ã‚¹ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
- **ã‚³ãƒ¡ãƒ³ãƒˆ**: ãƒœãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º

---

## ğŸ“Œ 11. ã¾ã¨ã‚

### ãƒ•ãƒƒã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆã®æµã‚Œ

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ¡ãƒ¢/ã‚¿ã‚¹ã‚¯ã‚’é¸æŠ or æ–°è¦ä½œæˆãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
   â†“
2. selectedMemoId / selectedTaskId ãŒè¨­å®šã•ã‚Œã‚‹
   ã¾ãŸã¯ isCreatingMemo / isCreatingTask ãŒ true ã«ãªã‚‹
   â†“
3. Sidebar ã® Props/Context ã«å€¤ãŒä¼æ’­
   â†“
4. sidebar.tsx:170-174 ã§ isShowingMemoEditor / isShowingTaskEditor ãŒ true ã«
   â†“
5. sidebar.tsx:177-262 ã®ä¸‰é …æ¼”ç®—å­ã§é©åˆ‡ãªãƒ•ãƒƒã‚¿ãƒ¼ã‚’è¿”ã™
   â†“
6. ãƒ¢ãƒã‚¤ãƒ«æ™‚ã®ã¿ãƒ•ãƒƒã‚¿ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€é€šå¸¸ã‚µã‚¤ãƒ‰ãƒãƒ¼ã¯ hidden ã«ãªã‚‹
```

### æœ€é‡è¦ãƒ•ã‚¡ã‚¤ãƒ«

1. **[sidebar.tsx](apps/web/components/layout/sidebar.tsx)** - ãƒ•ãƒƒã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆæœ¬ä½“
2. **[item-editor-footer.tsx](apps/web/components/mobile/item-editor-footer.tsx)** - çµ±åˆãƒ•ãƒƒã‚¿ãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆmemo/task/boardå¯¾å¿œï¼‰
3. **[team-detail-context.tsx](apps/web/src/contexts/team-detail-context.tsx)** - ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰çŠ¶æ…‹ç®¡ç†
4. **[memo-screen.tsx](apps/web/components/screens/memo-screen.tsx)** - ãƒ¡ãƒ¢ç”»é¢ï¼ˆæˆ»ã‚‹å‡¦ç†å®Ÿè£…ï¼‰
5. **[task-screen.tsx](apps/web/components/screens/task-screen.tsx)** - ã‚¿ã‚¹ã‚¯ç”»é¢ï¼ˆæˆ»ã‚‹å‡¦ç†å®Ÿè£…ï¼‰

---

**æœ€çµ‚æ›´æ–°æ—¥:** 2025-10-31
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** Next.js 15.3.0 / React 19.0.0
**ä¸»ãªä¿®æ­£:** ãƒãƒ¼ãƒ å´æ–°è¦ä½œæˆæ™‚ã®æˆ»ã‚‹ãƒœã‚¿ãƒ³å®Ÿè£…ã€FABçµ±ä¸€åŒ–ã€ãƒœãƒ¼ãƒ‰è©³ç´°ãƒ•ãƒƒã‚¿ãƒ¼å¯¾å¿œ
