# è«–ç†å‰Šé™¤æ–¹å¼ã¸ã®ç§»è¡Œè¨ˆç”»ï¼ˆé€²è¡Œä¸­ï¼‰

> âš ï¸ Codexã«å®Ÿè£…ä¾é ¼ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã‚’å³å®ˆã™ã‚‹ã“ã¨ï¼š
>
> - **æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¸ã”ã¨å†ç”Ÿæˆã•ã›ãªã„ã“ã¨**
>   â†’ Codexã¸ã®ä¾é ¼ã¯å¿…ãš **å·®åˆ†ï¼ˆpatchå½¢å¼ï¼‰** ã§è¡Œã†
> - **æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆãƒ»æ–‡å­—åˆ—ã‚’æ‰±ã†å ´åˆã¯UTF-8å‰æã§ä¾é ¼ã™ã‚‹ã“ã¨**
>   â†’ æ–‡å­—åŒ–ã‘é˜²æ­¢ã®ãŸã‚æ˜è¨˜ã™ã‚‹
> - **Codexã« git add / git commit ã‚’å®Ÿè¡Œã•ã›ãªã„ã“ã¨**
> - **å®Œäº†ã—ãŸå ´åˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’`.claude/fixed-plans` ã«ç§»å‹•ã™ã‚‹**

---

## ğŸ“ ç¾åœ¨ã®é€²æ—çŠ¶æ³

### âœ… å®Œäº†æ¸ˆã¿

- **Phase 1**: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´å®Œäº†ï¼ˆ`deleted_at`ã‚«ãƒ©ãƒ è¿½åŠ ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œï¼‰
- **ãƒ­ãƒ¼ã‚«ãƒ«DB**: å…¨æ¶ˆã—å®Œäº†
- **Phase 2**: å€‹äººç”¨ãƒ¡ãƒ¢APIå®Œå…¨ç§»è¡Œ
  - âœ… DELETE: è«–ç†å‰Šé™¤
  - âœ… GET /deleted: å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—
  - âœ… DELETE /deleted/:displayId: ç‰©ç†å‰Šé™¤
  - âœ… POST /deleted/:displayId/restore: `deleted_at = NULL`
  - âœ… é€šå¸¸å–å¾—ã‚¯ã‚¨ãƒªã«`isNull(deleted_at)`è¿½åŠ 
- **Phase 3**: å€‹äººç”¨ã‚¿ã‚¹ã‚¯APIå®Œå…¨ç§»è¡Œ
  - âœ… Phase 2ã¨åŒæ§˜ã®å¤‰æ›´ã‚’å…¨ã¦é©ç”¨

### âœ… å®Œäº†æ¸ˆã¿ï¼ˆè¿½åŠ ï¼‰

- **Phase 4**: ãƒãƒ¼ãƒ ç”¨ãƒ¡ãƒ¢APIå®Œå…¨ç§»è¡Œ
  - âœ… importæ–‡ä¿®æ­£
  - âœ… DELETE: è«–ç†å‰Šé™¤ã«å¤‰æ›´
  - âœ… GET /deleted: å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—
  - âœ… DELETE /deleted/:displayId: ç‰©ç†å‰Šé™¤
  - âœ… POST /deleted/:displayId/restore: `deleted_at = NULL`
  - âœ… é€šå¸¸å–å¾—ã‚¯ã‚¨ãƒªã«`isNull(deleted_at)`è¿½åŠ 
- **Phase 5**: ãƒãƒ¼ãƒ ç”¨ã‚¿ã‚¹ã‚¯APIå®Œå…¨ç§»è¡Œ
  - âœ… importæ–‡ä¿®æ­£ï¼ˆ`isNull`, `isNotNull`è¿½åŠ ï¼‰
  - âœ… DELETE: è«–ç†å‰Šé™¤ã«å¤‰æ›´
  - âœ… GET /deleted: å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—
  - âœ… DELETE /deleted/:displayId: ç‰©ç†å‰Šé™¤
  - âœ… POST /deleted/:displayId/restore: `deleted_at = NULL`
  - âœ… é€šå¸¸å–å¾—ã‚¯ã‚¨ãƒªã«`isNull(deleted_at)`è¿½åŠ 

### âœ… å®Œäº†æ¸ˆã¿ï¼ˆè¿½åŠ Phase 6ï¼‰

- **Phase 6**: æ¤œç´¢ãƒ»ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†ã®ä¿®æ­£
  - âœ… ãƒœãƒ¼ãƒ‰APIå†…ã®ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯å‚ç…§ã«`isNull(deletedAt)`è¿½åŠ ï¼ˆ8ç®‡æ‰€ï¼‰
  - âœ… displayIdæ¤œç´¢å‡¦ç†ã«è«–ç†å‰Šé™¤æ¡ä»¶è¿½åŠ 
  - âœ… ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†ã®ç¢ºèªå®Œäº†

### â¸ï¸ æœªç€æ‰‹

- **Phase 7**: ã‚¹ã‚­ãƒ¼ãƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆå‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤ï¼‰
- **Phase 8**: æœ€çµ‚ãƒ†ã‚¹ãƒˆ

### ğŸ“ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… ~~ãƒãƒ¼ãƒ ç”¨ãƒ¡ãƒ¢APIã®æ®‹ã‚Šï¼ˆå®Œå…¨å‰Šé™¤ãƒ»å¾©å…ƒãƒ»é€šå¸¸å–å¾—ï¼‰~~ â†’ å®Œäº†
2. âœ… ~~ãƒãƒ¼ãƒ ç”¨ã‚¿ã‚¹ã‚¯APIã®å®Œå…¨ç§»è¡Œ~~ â†’ å®Œäº†
3. âœ… ~~æ¤œç´¢ãƒ»ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†ã®ç¢ºèªã¨ä¿®æ­£ï¼ˆPhase 6ï¼‰~~ â†’ å®Œäº†
4. å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆPhase 7ï¼‰
5. æœ€çµ‚ãƒ†ã‚¹ãƒˆï¼ˆPhase 8ï¼‰

### ğŸ“– å®Ÿè£…æ¸ˆã¿ã‚³ãƒ¼ãƒ‰ã®å‚ç…§ï¼ˆå®Œæˆä¾‹ï¼‰

Phase 4-5ã‚’é€²ã‚ã‚‹éš›ã¯ã€ä»¥ä¸‹ã®å®Œæˆæ¸ˆã¿ã‚³ãƒ¼ãƒ‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼š

#### å€‹äººç”¨ãƒ¡ãƒ¢APIï¼ˆå®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/memos/route.ts`

- **å‰Šé™¤å‡¦ç†ï¼ˆè«–ç†å‰Šé™¤ï¼‰**: 387-420è¡Œ

  ```typescript
  await db
    .update(memos)
    .set({ deletedAt: Math.floor(Date.now() / 1000) })
    .where(eq(memos.id, id));
  ```

- **å‰Šé™¤æ¸ˆã¿ä¸€è¦§å–å¾—**: 474-492è¡Œ

  ```typescript
  .from(memos)
  .where(and(eq(memos.userId, userId), isNotNull(memos.deletedAt)))
  ```

- **å®Œå…¨å‰Šé™¤ï¼ˆç‰©ç†å‰Šé™¤ï¼‰**: 600-622è¡Œ

  ```typescript
  .delete(memos)
  .where(and(eq(memos.displayId, displayId), isNotNull(memos.deletedAt)))
  ```

- **å¾©å…ƒå‡¦ç†**: 697-719è¡Œ
  ```typescript
  await db.update(memos).set({ deletedAt: null }).where(eq(memos.id, memo.id));
  ```

#### å€‹äººç”¨ã‚¿ã‚¹ã‚¯APIï¼ˆå®Œå…¨å®Ÿè£…æ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/tasks/route.ts`

- ãƒ¡ãƒ¢APIã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³
- ã‚¿ã‚¹ã‚¯å›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆstatus, priorityç­‰ï¼‰ã‚‚é©åˆ‡ã«å‡¦ç†æ¸ˆã¿

#### ãƒãƒ¼ãƒ ç”¨ãƒ¡ãƒ¢APIï¼ˆä¸€éƒ¨å®Ÿè£…æ¸ˆã¿ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/teams/memos.ts`

- âœ… å‰Šé™¤å‡¦ç†: 473-480è¡Œï¼ˆè«–ç†å‰Šé™¤ã«å¤‰æ›´æ¸ˆã¿ï¼‰
- âœ… å‰Šé™¤æ¸ˆã¿ä¸€è¦§: 568-581è¡Œï¼ˆå…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ã«å¤‰æ›´æ¸ˆã¿ï¼‰
- â³ å®Œå…¨å‰Šé™¤: æœªå®Œäº†ï¼ˆå€‹äººç”¨ãƒ¡ãƒ¢ã®600-622è¡Œã‚’å‚è€ƒã«å®Ÿè£…ï¼‰
- â³ å¾©å…ƒ: æœªå®Œäº†ï¼ˆå€‹äººç”¨ãƒ¡ãƒ¢ã®697-719è¡Œã‚’å‚è€ƒã«å®Ÿè£…ï¼‰

**å®Ÿè£…ã®é•ã„**:

- ãƒãƒ¼ãƒ ç”¨ã¯ `teamId` æ¡ä»¶ãŒå¿…é ˆ
- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç¢ºèªå‡¦ç†ã‚’ç¶­æŒ
- ãã‚Œä»¥å¤–ã¯å€‹äººç”¨ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³

---

## ğŸ¯ ç›®çš„ãƒ»èƒŒæ™¯

### ç¾çŠ¶ã®èª²é¡Œ

- ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤æ™‚ã«å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`deleted_memos`, `deleted_tasks`, `team_deleted_memos`, `team_deleted_tasks`ï¼‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç§»å‹•
- ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒ‡ãƒ¼ã‚¿ç§»å‹•ã«ã‚ˆã‚Šã€`id`ãŒå¤‰æ›´ã•ã‚Œã‚‹ï¼ˆAUTO_INCREMENTï¼‰
- å¾©å…ƒæ™‚ã«æ–°ã—ã„`id`ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹ãŸã‚ã€URLå®‰å®šæ€§ã«èª²é¡Œ
- å‰Šé™¤ãƒ»å¾©å…ƒãƒ­ã‚¸ãƒƒã‚¯ãŒè¤‡é›‘ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«é–“ã‚³ãƒ”ãƒ¼ + å‰Šé™¤ï¼‰

### ç›®æŒ‡ã™å§¿

- **è«–ç†å‰Šé™¤æ–¹å¼**: å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã«`deleted_at`ã‚«ãƒ©ãƒ ã‚’è¿½åŠ ã—ã€å‰Šé™¤ãƒ•ãƒ©ã‚°ã§ç®¡ç†
- **URLä¸å¤‰**: `display_id`ã‚‚`id`ã‚‚å¤‰ã‚ã‚‰ãªã„
- **ã‚·ãƒ³ãƒ—ãƒ«åŒ–**: å‰Šé™¤ã¯`UPDATE deleted_at = NOW()`ã€å¾©å…ƒã¯`UPDATE deleted_at = NULL`
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: `deleted_at`ã«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ ã—ã€æ¤œç´¢é€Ÿåº¦ã‚’ç¶­æŒ

---

## ğŸ“Š ç¾çŠ¶åˆ†æ

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆï¼ˆç§»è¡Œå‰ï¼‰

```
ã€å€‹äººç”¨ã€‘
memos (é€šå¸¸ãƒ¡ãƒ¢) â†â†’ deleted_memos (å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢)
tasks (é€šå¸¸ã‚¿ã‚¹ã‚¯) â†â†’ deleted_tasks (å‰Šé™¤æ¸ˆã¿ã‚¿ã‚¹ã‚¯)

ã€ãƒãƒ¼ãƒ ç”¨ã€‘
team_memos (é€šå¸¸ãƒ¡ãƒ¢) â†â†’ team_deleted_memos (å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢)
team_tasks (é€šå¸¸ã‚¿ã‚¹ã‚¯) â†â†’ team_deleted_tasks (å‰Šé™¤æ¸ˆã¿ã‚¿ã‚¹ã‚¯)
```

### å‰Šé™¤ãƒ•ãƒ­ãƒ¼ï¼ˆç§»è¡Œå‰ï¼‰

1. å‰Šé™¤å¯¾è±¡ã‚’å–å¾—
2. å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚³ãƒ”ãƒ¼ï¼ˆ`display_id`ä¿æŒï¼‰
3. é–¢é€£ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆ`board_items.deletedAt`è¨­å®šã€é€šçŸ¥å‰Šé™¤ï¼‰
4. å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å‰Šé™¤

### å¾©å…ƒãƒ•ãƒ­ãƒ¼ï¼ˆç§»è¡Œå‰ï¼‰

1. å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—
2. å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã«å¾©å…ƒï¼ˆæ–°ã—ã„`id`ãŒæ¡ç•ªã•ã‚Œã‚‹ï¼‰
3. é–¢é€£ãƒ‡ãƒ¼ã‚¿å¾©å…ƒï¼ˆ`board_items.deletedAt = NULL`ï¼‰
4. å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å‰Šé™¤

---

## ğŸ¯ ç§»è¡Œå¾Œã®è¨­è¨ˆ

### ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹æˆï¼ˆç§»è¡Œå¾Œï¼‰

```
ã€å€‹äººç”¨ã€‘
memos (é€šå¸¸ + å‰Šé™¤æ¸ˆã¿çµ±åˆ)
  - deleted_at: NULL (é€šå¸¸) / ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— (å‰Šé™¤æ¸ˆã¿)

tasks (é€šå¸¸ + å‰Šé™¤æ¸ˆã¿çµ±åˆ)
  - deleted_at: NULL (é€šå¸¸) / ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— (å‰Šé™¤æ¸ˆã¿)

ã€ãƒãƒ¼ãƒ ç”¨ã€‘
team_memos (é€šå¸¸ + å‰Šé™¤æ¸ˆã¿çµ±åˆ)
  - deleted_at: NULL (é€šå¸¸) / ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— (å‰Šé™¤æ¸ˆã¿)

team_tasks (é€šå¸¸ + å‰Šé™¤æ¸ˆã¿çµ±åˆ)
  - deleted_at: NULL (é€šå¸¸) / ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ— (å‰Šé™¤æ¸ˆã¿)

ã€å‰Šé™¤äºˆå®šã€‘
deleted_memos âŒ
deleted_tasks âŒ
team_deleted_memos âŒ
team_deleted_tasks âŒ
```

### å‰Šé™¤ãƒ•ãƒ­ãƒ¼ï¼ˆç§»è¡Œå¾Œï¼‰

1. å‰Šé™¤å¯¾è±¡ã‚’å–å¾—
2. **`UPDATE deleted_at = CURRENT_TIMESTAMP`**
3. é–¢é€£ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆ`board_items.deletedAt`è¨­å®šã€é€šçŸ¥å‰Šé™¤ï¼‰

### å¾©å…ƒãƒ•ãƒ­ãƒ¼ï¼ˆç§»è¡Œå¾Œï¼‰

1. å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆ`WHERE deleted_at IS NOT NULL`ï¼‰
2. **`UPDATE deleted_at = NULL`**
3. é–¢é€£ãƒ‡ãƒ¼ã‚¿å¾©å…ƒï¼ˆ`board_items.deletedAt = NULL`ï¼‰

### å®Œå…¨å‰Šé™¤ãƒ•ãƒ­ãƒ¼ï¼ˆç§»è¡Œå¾Œï¼‰

1. å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆ`WHERE deleted_at IS NOT NULL`ï¼‰
2. é–¢é€£ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆtaggings, attachments, R2ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
3. **ç‰©ç†å‰Šé™¤ï¼ˆ`DELETE FROM ãƒ†ãƒ¼ãƒ–ãƒ«`ï¼‰**

---

## ğŸ“‹ å¤‰æ›´ç¯„å›²

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

#### è¿½åŠ ã™ã‚‹ã‚«ãƒ©ãƒ 

```typescript
// apps/api/src/db/schema/memos.ts
export const memos = sqliteTable("memos", {
  // ... æ—¢å­˜ã‚«ãƒ©ãƒ 
  deletedAt: integer("deleted_at"), // è¿½åŠ 
});

// apps/api/src/db/schema/tasks.ts
export const tasks = sqliteTable("tasks", {
  // ... æ—¢å­˜ã‚«ãƒ©ãƒ 
  deletedAt: integer("deleted_at"), // è¿½åŠ 
});

// apps/api/src/db/schema/team/memos.ts
export const teamMemos = sqliteTable("team_memos", {
  // ... æ—¢å­˜ã‚«ãƒ©ãƒ 
  deletedAt: integer("deleted_at"), // è¿½åŠ 
});

// apps/api/src/db/schema/team/tasks.ts
export const teamTasks = sqliteTable("team_tasks", {
  // ... æ—¢å­˜ã‚«ãƒ©ãƒ 
  deletedAt: integer("deleted_at"), // è¿½åŠ 
});
```

#### å‰Šé™¤ã™ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©

```typescript
// ä»¥ä¸‹ã®exportã‚’å‰Šé™¤
export const deletedMemos = ... // å‰Šé™¤
export const deletedTasks = ... // å‰Šé™¤
export const teamDeletedMemos = ... // å‰Šé™¤
export const teamDeletedTasks = ... // å‰Šé™¤
```

#### è¿½åŠ ã™ã‚‹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

```sql
-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ç”¨ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_memos_deleted_at ON memos(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_tasks_deleted_at ON tasks(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_team_memos_deleted_at ON team_memos(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_team_tasks_deleted_at ON team_tasks(deleted_at) WHERE deleted_at IS NOT NULL;
```

### 2. APIå®Ÿè£…å¤‰æ›´

#### å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

1. `apps/api/src/routes/memos/route.ts` (912è¡Œ)
2. `apps/api/src/routes/tasks/route.ts` (1026è¡Œ)
3. `apps/api/src/routes/teams/memos.ts` (1049è¡Œ)
4. `apps/api/src/routes/teams/tasks.ts` (1036è¡Œ)

#### å¤‰æ›´ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

##### å€‹äººç”¨ãƒ¡ãƒ¢API (`apps/api/src/routes/memos/route.ts`)

**â‘  DELETE /memos/:id (320-454è¡Œ)**

```typescript
// å¤‰æ›´å‰: deleted_memosãƒ†ãƒ¼ãƒ–ãƒ«ã«ã‚³ãƒ”ãƒ¼
await db.insert(deletedMemos).values({ ... }).run();
await db.delete(memos).where(...).run();

// å¤‰æ›´å¾Œ: deleted_atè¨­å®š
await db.update(memos)
  .set({ deletedAt: Date.now() })
  .where(eq(memos.id, memoId))
  .run();
```

**â‘¡ GET /memos/deleted (456-525è¡Œ)**

```typescript
// å¤‰æ›´å‰: deleted_memosã‹ã‚‰å–å¾—
const deleted = await db.select().from(deletedMemos).where(...);

// å¤‰æ›´å¾Œ: memosã‹ã‚‰å‰Šé™¤æ¸ˆã¿ã‚’å–å¾—
const deleted = await db.select().from(memos)
  .where(and(
    eq(memos.userId, userId),
    isNotNull(memos.deletedAt)
  ));
```

**â‘¢ DELETE /memos/deleted/:displayId (527-654è¡Œ)**

```typescript
// å¤‰æ›´å‰: deleted_memosã‹ã‚‰å‰Šé™¤
await db.delete(deletedMemos).where(...).run();

// å¤‰æ›´å¾Œ: memosã‹ã‚‰ç‰©ç†å‰Šé™¤
await db.delete(memos).where(and(
  eq(memos.displayId, displayId),
  isNotNull(memos.deletedAt)
)).run();
```

**â‘£ POST /memos/deleted/:displayId/restore (656-768è¡Œ)**

```typescript
// å¤‰æ›´å‰: deleted_memos â†’ memosã«å¾©å…ƒ
const restored = await db.insert(memos).values({ ... }).returning();
await db.delete(deletedMemos).where(...).run();

// å¤‰æ›´å¾Œ: deleted_atã‚’NULLã«
await db.update(memos)
  .set({ deletedAt: null })
  .where(and(
    eq(memos.displayId, displayId),
    eq(memos.userId, userId),
    isNotNull(memos.deletedAt)
  ))
  .run();
```

**â‘¤ é€šå¸¸å–å¾—ã‚¯ã‚¨ãƒªã¸ã®å½±éŸ¿**

```typescript
// GET /memos, GET /memos/:id ãªã©å…¨ã¦ã®å–å¾—ç³»ã«è¿½åŠ 
.where(and(
  eq(memos.userId, userId),
  isNull(memos.deletedAt) // è¿½åŠ 
))
```

##### å€‹äººç”¨ã‚¿ã‚¹ã‚¯API (`apps/api/src/routes/tasks/route.ts`)

ãƒ¡ãƒ¢APIã¨åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨

##### ãƒãƒ¼ãƒ ç”¨ãƒ¡ãƒ¢API (`apps/api/src/routes/teams/memos.ts`)

ãƒ¡ãƒ¢APIã¨åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨ï¼ˆ`team_id`æ¡ä»¶è¿½åŠ ï¼‰

##### ãƒãƒ¼ãƒ ç”¨ã‚¿ã‚¹ã‚¯API (`apps/api/src/routes/teams/tasks.ts`)

ãƒ¡ãƒ¢APIã¨åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨ï¼ˆ`team_id`æ¡ä»¶è¿½åŠ ï¼‰

### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å½±éŸ¿

#### å‹å®šç¾©ï¼ˆå¤‰æ›´ä¸è¦ï¼‰

- `apps/web/src/types/common.ts`: `DeletedItemFields`ã«æ—¢ã«`deletedAt`ã‚ã‚Š
- `apps/web/src/types/memo.ts`: `DeletedMemo`ã¯å¤‰æ›´ä¸è¦
- `apps/web/src/types/task.ts`: `DeletedTask`ã¯å¤‰æ›´ä¸è¦

#### APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆå¤‰æ›´ä¸è¦ï¼‰

- `apps/web/src/lib/api-client.ts`: ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸å¤‰ã®ãŸã‚å¤‰æ›´ä¸è¦

#### Hooksï¼ˆå¤‰æ›´ä¸è¦ï¼‰

- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ãŒå¤‰ã‚ã‚‰ãªã„ãŸã‚ã€åŸºæœ¬çš„ã«å¤‰æ›´ä¸è¦
- å†…éƒ¨çš„ãªãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ã®ã¿

---

## ğŸš€ å®Ÿè£…æ‰‹é †

### Phase 1: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´

**ç›®çš„**: å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«`deleted_at`ã‚«ãƒ©ãƒ ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿½åŠ 

#### 1.1 Drizzleã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´

ä»¥ä¸‹ã®4ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†:

- `apps/api/src/db/schema/memos.ts`
- `apps/api/src/db/schema/tasks.ts`
- `apps/api/src/db/schema/team/memos.ts`
- `apps/api/src/db/schema/team/tasks.ts`

```typescript
// å„ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
deletedAt: integer("deleted_at"),
```

#### 1.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ

```bash
cd apps/api
npm run db:generate
```

#### 1.3 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹ç¢ºèª

ç”Ÿæˆã•ã‚ŒãŸSQLãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ãŒå«ã¾ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª:

```sql
ALTER TABLE memos ADD COLUMN deleted_at INTEGER;
ALTER TABLE tasks ADD COLUMN deleted_at INTEGER;
ALTER TABLE team_memos ADD COLUMN deleted_at INTEGER;
ALTER TABLE team_tasks ADD COLUMN deleted_at INTEGER;
```

#### 1.4 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«æ‰‹å‹•ã§è¿½åŠ :

```sql
CREATE INDEX idx_memos_deleted_at ON memos(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_tasks_deleted_at ON tasks(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_team_memos_deleted_at ON team_memos(deleted_at) WHERE deleted_at IS NOT NULL;
CREATE INDEX idx_team_tasks_deleted_at ON team_tasks(deleted_at) WHERE deleted_at IS NOT NULL;
```

#### 1.5 ãƒ­ãƒ¼ã‚«ãƒ«DBå…¨æ¶ˆã—

```bash
cd apps/api
npm run db:reset:local
```

#### 1.6 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
npm run db:migration:local
```

---

### Phase 2: å€‹äººç”¨ãƒ¡ãƒ¢APIå®Ÿè£…å¤‰æ›´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/memos/route.ts`

#### 2.1 å‰Šé™¤å‡¦ç†ï¼ˆDELETE /memos/:idï¼‰

**å ´æ‰€**: 320-454è¡Œ

**å¤‰æ›´å†…å®¹**:

```typescript
// ã€å¤‰æ›´å‰ã€‘deleted_memosã«ã‚³ãƒ”ãƒ¼
await db
  .insert(deletedMemos)
  .values({
    userId: memo.userId,
    displayId: memo.displayId,
    // ... å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚³ãƒ”ãƒ¼
  })
  .run();
await db.delete(memos).where(eq(memos.id, memoId)).run();

// ã€å¤‰æ›´å¾Œã€‘deleted_atè¨­å®š
await db
  .update(memos)
  .set({
    deletedAt: Date.now(),
    updatedAt: Date.now(),
  })
  .where(eq(memos.id, memoId))
  .run();
```

**æ³¨æ„ç‚¹**:

- é–¢é€£å‡¦ç†ï¼ˆ`board_items`, é€šçŸ¥å‰Šé™¤ï¼‰ã¯ç¶­æŒ
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¸è¦ã«ãªã‚‹ãŸã‚ã€ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã¯å‰Šé™¤å¯èƒ½

#### 2.2 å‰Šé™¤æ¸ˆã¿ä¸€è¦§å–å¾—ï¼ˆGET /memos/deletedï¼‰

**å ´æ‰€**: 456-525è¡Œ

**å¤‰æ›´å†…å®¹**:

```typescript
// ã€å¤‰æ›´å‰ã€‘
const deleted = await db
  .select()
  .from(deletedMemos)
  .where(eq(deletedMemos.userId, userId))
  .orderBy(desc(deletedMemos.deletedAt))
  .all();

// ã€å¤‰æ›´å¾Œã€‘
const deleted = await db
  .select()
  .from(memos)
  .where(and(eq(memos.userId, userId), isNotNull(memos.deletedAt)))
  .orderBy(desc(memos.deletedAt))
  .all();
```

#### 2.3 å®Œå…¨å‰Šé™¤ï¼ˆDELETE /memos/deleted/:displayIdï¼‰

**å ´æ‰€**: 527-654è¡Œ

**å¤‰æ›´å†…å®¹**:

```typescript
// ã€å¤‰æ›´å‰ã€‘
const memo = await db
  .select()
  .from(deletedMemos)
  .where(
    and(eq(deletedMemos.displayId, displayId), eq(deletedMemos.userId, userId)),
  )
  .get();

await db
  .delete(deletedMemos)
  .where(eq(deletedMemos.displayId, displayId))
  .run();

// ã€å¤‰æ›´å¾Œã€‘
const memo = await db
  .select()
  .from(memos)
  .where(
    and(
      eq(memos.displayId, displayId),
      eq(memos.userId, userId),
      isNotNull(memos.deletedAt), // å‰Šé™¤æ¸ˆã¿ç¢ºèª
    ),
  )
  .get();

await db
  .delete(memos)
  .where(and(eq(memos.displayId, displayId), isNotNull(memos.deletedAt)))
  .run();
```

**æ³¨æ„ç‚¹**:

- R2ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ã€ã‚¿ã‚°å‰Šé™¤ã€æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤å‡¦ç†ã¯ç¶­æŒ
- `board_items`ã¯ä¿æŒï¼ˆå‰Šé™¤æ¸ˆã¿ã‚¿ãƒ–è¡¨ç¤ºç”¨ï¼‰

#### 2.4 å¾©å…ƒå‡¦ç†ï¼ˆPOST /memos/deleted/:displayId/restoreï¼‰

**å ´æ‰€**: 656-768è¡Œ

**å¤‰æ›´å†…å®¹**:

```typescript
// ã€å¤‰æ›´å‰ã€‘
const memo = await db
  .select()
  .from(deletedMemos)
  .where(
    and(eq(deletedMemos.displayId, displayId), eq(deletedMemos.userId, userId)),
  )
  .get();

const restored = await db
  .insert(memos)
  .values({
    userId: memo.userId,
    displayId: memo.displayId,
    // ... å…¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
  })
  .returning()
  .get();

await db
  .delete(deletedMemos)
  .where(eq(deletedMemos.displayId, displayId))
  .run();

// ã€å¤‰æ›´å¾Œã€‘
const memo = await db
  .select()
  .from(memos)
  .where(
    and(
      eq(memos.displayId, displayId),
      eq(memos.userId, userId),
      isNotNull(memos.deletedAt),
    ),
  )
  .get();

await db
  .update(memos)
  .set({
    deletedAt: null,
    updatedAt: Date.now(),
  })
  .where(eq(memos.id, memo.id))
  .run();

// å¾©å…ƒå¾Œã®ãƒ‡ãƒ¼ã‚¿å–å¾—
const restored = await db
  .select()
  .from(memos)
  .where(eq(memos.id, memo.id))
  .get();
```

**æ³¨æ„ç‚¹**:

- `board_items.deletedAt`ã‚’`NULL`ã«æˆ»ã™å‡¦ç†ã¯ç¶­æŒ
- `id`ãŒå¤‰ã‚ã‚‰ãªã„ãŸã‚ã€URLã‚‚ä¸å¤‰

#### 2.5 é€šå¸¸å–å¾—ã‚¯ã‚¨ãƒªã®ä¿®æ­£

**å¯¾è±¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**:

- `GET /memos` (ä¸€è¦§å–å¾—)
- `GET /memos/:id` (å˜ä½“å–å¾—)
- `GET /memos/by-category/:categoryId` (ã‚«ãƒ†ã‚´ãƒªåˆ¥å–å¾—)
- ãã®ä»–å…¨ã¦ã®å–å¾—ç³»

**å¤‰æ›´å†…å®¹**:

```typescript
// å…¨ã¦ã®WHEREå¥ã«è¿½åŠ 
.where(and(
  eq(memos.userId, userId),
  isNull(memos.deletedAt) // è¿½åŠ 
))
```

---

### Phase 3: å€‹äººç”¨ã‚¿ã‚¹ã‚¯APIå®Ÿè£…å¤‰æ›´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/tasks/route.ts`

Phase 2ã¨åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨:

1. å‰Šé™¤å‡¦ç†ã‚’è«–ç†å‰Šé™¤ã«
2. å‰Šé™¤æ¸ˆã¿å–å¾—ã‚’å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰
3. å®Œå…¨å‰Šé™¤ã‚’ç‰©ç†å‰Šé™¤ã«
4. å¾©å…ƒã‚’`UPDATE deleted_at = NULL`ã«
5. é€šå¸¸å–å¾—ã«`isNull(tasks.deletedAt)`è¿½åŠ 

**ç‰¹æœ‰ã®å‡¦ç†**:

- ã‚¿ã‚¹ã‚¯å›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆ`status`, `priority`, `assigneeId`ç­‰ï¼‰ã‚‚é©åˆ‡ã«å‡¦ç†

---

### Phase 4: ãƒãƒ¼ãƒ ç”¨ãƒ¡ãƒ¢APIå®Ÿè£…å¤‰æ›´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/teams/memos.ts`

Phase 2ã¨åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨:

1. å‰Šé™¤å‡¦ç†ã‚’è«–ç†å‰Šé™¤ã«
2. å‰Šé™¤æ¸ˆã¿å–å¾—ã‚’å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰
3. å®Œå…¨å‰Šé™¤ã‚’ç‰©ç†å‰Šé™¤ã«
4. å¾©å…ƒã‚’`UPDATE deleted_at = NULL`ã«
5. é€šå¸¸å–å¾—ã«`isNull(team_memos.deletedAt)`è¿½åŠ 

**ç‰¹æœ‰ã®å‡¦ç†**:

- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç¢ºèªå‡¦ç†ã¯ç¶­æŒ
- `team_id`æ¡ä»¶ã‚’å…¨ã¦ã®ã‚¯ã‚¨ãƒªã«è¿½åŠ 

---

### Phase 5: ãƒãƒ¼ãƒ ç”¨ã‚¿ã‚¹ã‚¯APIå®Ÿè£…å¤‰æ›´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/teams/tasks.ts`

Phase 2ã¨åŒæ§˜ã®å¤‰æ›´ã‚’é©ç”¨:

1. å‰Šé™¤å‡¦ç†ã‚’è«–ç†å‰Šé™¤ã«
2. å‰Šé™¤æ¸ˆã¿å–å¾—ã‚’å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰
3. å®Œå…¨å‰Šé™¤ã‚’ç‰©ç†å‰Šé™¤ã«
4. å¾©å…ƒã‚’`UPDATE deleted_at = NULL`ã«
5. é€šå¸¸å–å¾—ã«`isNull(team_tasks.deletedAt)`è¿½åŠ 

**ç‰¹æœ‰ã®å‡¦ç†**:

- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ç¢ºèªå‡¦ç†ã¯ç¶­æŒ
- `team_id`æ¡ä»¶ã‚’å…¨ã¦ã®ã‚¯ã‚¨ãƒªã«è¿½åŠ 
- ã‚¿ã‚¹ã‚¯å›ºæœ‰ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚é©åˆ‡ã«å‡¦ç†

---

### Phase 6: æ¤œç´¢ãƒ»ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†ã®ä¿®æ­£

#### 6.1 ãƒœãƒ¼ãƒ‰API

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/api/src/routes/boards/api.ts`

**å¤‰æ›´ç®‡æ‰€**:

- ãƒœãƒ¼ãƒ‰ã‚¢ã‚¤ãƒ†ãƒ å–å¾—æ™‚ã«ã€ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ã®`deleted_at IS NULL`ã‚’ç¢ºèª
- æ—¢ã«`boardItems.deletedAt`ã§å‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–ã—ã¦ã„ã‚‹ãŸã‚ã€è¿½åŠ ã§å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ç¢ºèª

```typescript
// ãƒ¡ãƒ¢å–å¾—JOIN
.leftJoin(memos, eq(boardItems.memoId, memos.id))
.where(and(
  isNull(boardItems.deletedAt),
  or(
    isNull(memos.id), // ãƒ¡ãƒ¢ãŒãªã„å ´åˆ
    isNull(memos.deletedAt) // ãƒ¡ãƒ¢ãŒå‰Šé™¤ã•ã‚Œã¦ã„ãªã„å ´åˆ
  )
))
```

#### 6.2 ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¤œç´¢

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/hooks/use-global-search.ts`

APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒæ—¢ã«å‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–ã—ã¦ã„ã‚Œã°å¤‰æ›´ä¸è¦ã€‚
å¿µã®ãŸã‚APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèªã€‚

#### 6.3 ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†

**å½±éŸ¿ç®‡æ‰€**:

- ãƒãƒ¼ãƒ ãƒ¡ãƒ¢ã®ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã‚«ã‚¦ãƒ³ãƒˆ (`apps/api/src/routes/teams/memos.ts` 122-128è¡Œ)
- ãã®ä»–ã®ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†

**å¤‰æ›´å†…å®¹**:

```typescript
// ã‚«ã‚¦ãƒ³ãƒˆæ™‚ã«å‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–
.where(and(
  eq(memos.categoryId, categoryId),
  isNull(memos.deletedAt) // è¿½åŠ 
))
```

---

### Phase 7: ã‚¹ã‚­ãƒ¼ãƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

#### 7.1 å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã®å‰Šé™¤

**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«**:

- `apps/api/src/db/schema/memos.ts`
- `apps/api/src/db/schema/tasks.ts`
- `apps/api/src/db/schema/team/memos.ts`
- `apps/api/src/db/schema/team/tasks.ts`

**å‰Šé™¤å†…å®¹**:

```typescript
// ä»¥ä¸‹ã®ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©ã¨exportã‚’å‰Šé™¤
export const deletedMemos = sqliteTable("deleted_memos", { ... });
export const deletedTasks = sqliteTable("deleted_tasks", { ... });
export const teamDeletedMemos = sqliteTable("team_deleted_memos", { ... });
export const teamDeletedTasks = sqliteTable("team_deleted_tasks", { ... });
```

#### 7.2 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ

```bash
cd apps/api
npm run db:generate
```

#### 7.3 DROP TABLE SQLè¿½åŠ 

ç”Ÿæˆã•ã‚ŒãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’æ‰‹å‹•è¿½åŠ :

```sql
DROP TABLE IF EXISTS deleted_memos;
DROP TABLE IF EXISTS deleted_tasks;
DROP TABLE IF EXISTS team_deleted_memos;
DROP TABLE IF EXISTS team_deleted_tasks;
```

#### 7.4 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

```bash
npm run db:migration:local
```

---

### Phase 8: å‹ãƒã‚§ãƒƒã‚¯ãƒ»ãƒ†ã‚¹ãƒˆ

#### 8.1 å‹ãƒã‚§ãƒƒã‚¯ï¼ˆAPIï¼‰

```bash
cd apps/api
npm run check:api
```

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:

- `deletedMemos`, `deletedTasks`ç­‰ã®å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«å‚ç…§ãŒãªã„ã“ã¨
- å…¨ã¦ã®ã‚¯ã‚¨ãƒªã«`deleted_at`æ¡ä»¶ãŒé©åˆ‡ã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨

#### 8.2 å‹ãƒã‚§ãƒƒã‚¯ï¼ˆWebï¼‰

```bash
cd apps/web
npm run check:wsl
```

**ç¢ºèªãƒã‚¤ãƒ³ãƒˆ**:

- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨
- APIãƒ¬ã‚¹ãƒãƒ³ã‚¹å‹ãŒä¸€è‡´ã—ã¦ã„ã‚‹ã“ã¨

#### 8.3 æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª**:

1. **å‰Šé™¤æ©Ÿèƒ½**
   - [ ] å€‹äººãƒ¡ãƒ¢ã‚’å‰Šé™¤ â†’ `deleted_at`ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨
   - [ ] å€‹äººã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ â†’ `deleted_at`ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨
   - [ ] ãƒãƒ¼ãƒ ãƒ¡ãƒ¢ã‚’å‰Šé™¤ â†’ `deleted_at`ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨
   - [ ] ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ â†’ `deleted_at`ãŒè¨­å®šã•ã‚Œã‚‹ã“ã¨
   - [ ] å‰Šé™¤å¾Œã€é€šå¸¸ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œãªã„ã“ã¨

2. **å‰Šé™¤æ¸ˆã¿ä¸€è¦§è¡¨ç¤º**
   - [ ] å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
   - [ ] å‰Šé™¤æ¸ˆã¿ã‚¿ã‚¹ã‚¯ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
   - [ ] `display_id`ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã“ã¨
   - [ ] `deleted_at`ãŒæ­£ã—ãè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨

3. **å¾©å…ƒæ©Ÿèƒ½**
   - [ ] å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢ã‚’å¾©å…ƒ â†’ `deleted_at`ãŒ`NULL`ã«ãªã‚‹ã“ã¨
   - [ ] å¾©å…ƒå¾Œã€é€šå¸¸ä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨
   - [ ] `id`ãŒå¤‰ã‚ã£ã¦ã„ãªã„ã“ã¨ï¼ˆURLãŒåŒã˜ï¼‰
   - [ ] `display_id`ãŒå¤‰ã‚ã£ã¦ã„ãªã„ã“ã¨

4. **å®Œå…¨å‰Šé™¤æ©Ÿèƒ½**
   - [ ] å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢ã‚’å®Œå…¨å‰Šé™¤ â†’ ç‰©ç†å‰Šé™¤ã•ã‚Œã‚‹ã“ã¨
   - [ ] R2ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‰Šé™¤ã•ã‚Œã‚‹ã“ã¨
   - [ ] ã‚¿ã‚°ãƒ»æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‰Šé™¤ã•ã‚Œã‚‹ã“ã¨
   - [ ] `board_items`ã¯ä¿æŒã•ã‚Œã‚‹ã“ã¨ï¼ˆå‰Šé™¤æ¸ˆã¿ã‚¿ãƒ–è¡¨ç¤ºç”¨ï¼‰

5. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**
   - [ ] é€šå¸¸ä¸€è¦§å–å¾—ãŒé…ããªã„ã“ã¨
   - [ ] å‰Šé™¤æ¸ˆã¿ä¸€è¦§å–å¾—ãŒé…ããªã„ã“ã¨
   - [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒæœ‰åŠ¹ã«æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨

#### 8.4 APIãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

```bash
# ãƒ¡ãƒ¢ä½œæˆ
apitest "/memos" "POST" '{"title":"ãƒ†ã‚¹ãƒˆãƒ¡ãƒ¢","content":"å†…å®¹"}'

# ãƒ¡ãƒ¢å‰Šé™¤ï¼ˆè«–ç†å‰Šé™¤ï¼‰
apitest "/memos/1" "DELETE"

# å‰Šé™¤æ¸ˆã¿ä¸€è¦§
apitest "/memos/deleted"

# å¾©å…ƒ
apitest "/memos/deleted/1/restore" "POST"

# å®Œå…¨å‰Šé™¤
apitest "/memos/deleted/1" "DELETE"
```

---

## âš ï¸ æ³¨æ„äº‹é …ãƒ»æ‡¸å¿µç‚¹

### 1. ãƒ‡ãƒ¼ã‚¿ç§»è¡Œ

- **ãƒ­ãƒ¼ã‚«ãƒ«**: å…¨æ¶ˆã—ã®ãŸã‚ãƒ‡ãƒ¼ã‚¿ç§»è¡Œä¸è¦
- **æœ¬ç•ª**: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å–å¾—å¾Œã€ãƒ‡ãƒ¼ã‚¿ç§»è¡ŒãŒå¿…è¦ãªå ´åˆã¯ä»¥ä¸‹ã®æ‰‹é †
  ```sql
  -- deleted_memosã®ãƒ‡ãƒ¼ã‚¿ã‚’memosã«æˆ»ã™
  INSERT INTO memos (user_id, display_id, uuid, title, content, category_id, created_at, updated_at, deleted_at)
  SELECT user_id, display_id, uuid, title, content, category_id, created_at, updated_at, deleted_at
  FROM deleted_memos;
  ```

### 2. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†

- è«–ç†å‰Šé™¤ã¯å˜ç´”ãª`UPDATE`ã®ãŸã‚ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ä¸è¦
- ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã‚‚å‰Šé™¤å¯èƒ½
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã‚‹ã¨ãƒ†ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ã‚ºãŒè‚¥å¤§åŒ–
- ãƒ‘ãƒ¼ã‚·ãƒ£ãƒ«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ`WHERE deleted_at IS NOT NULL`ï¼‰ã§æ¤œç´¢é€Ÿåº¦ã‚’ç¶­æŒ
- å®šæœŸçš„ãªã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãŒå¿…è¦ã«ãªã‚‹å¯èƒ½æ€§ï¼ˆå°†æ¥ã®èª²é¡Œï¼‰

### 4. æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã®å½±éŸ¿

- å…¨ã¦ã®å–å¾—ã‚¯ã‚¨ãƒªã«`isNull(deleted_at)`ã‚’è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- æ¼ã‚ŒãŒã‚ã‚‹ã¨å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹å¯èƒ½æ€§
- å‹ãƒã‚§ãƒƒã‚¯ã¨ãƒ†ã‚¹ãƒˆã§å¾¹åº•çš„ã«ç¢ºèª

### 5. APIäº’æ›æ€§

- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯å¤‰æ›´ãªã—
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ§‹é€ ã‚‚å¤‰æ›´ãªã—
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯åŸºæœ¬çš„ã«å¤‰æ›´ä¸è¦ï¼ˆå†…éƒ¨å®Ÿè£…ã®ã¿å¤‰æ›´ï¼‰

---

## ğŸ“¦ æˆæœç‰©

### å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

#### ã‚¹ã‚­ãƒ¼ãƒãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

- `apps/api/src/db/schema/memos.ts`
- `apps/api/src/db/schema/tasks.ts`
- `apps/api/src/db/schema/team/memos.ts`
- `apps/api/src/db/schema/team/tasks.ts`

#### APIãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ4ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

- `apps/api/src/routes/memos/route.ts`
- `apps/api/src/routes/tasks/route.ts`
- `apps/api/src/routes/teams/memos.ts`
- `apps/api/src/routes/teams/tasks.ts`

#### ãã®ä»–å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«

- `apps/api/src/routes/boards/api.ts` (ãƒœãƒ¼ãƒ‰å–å¾—ã‚¯ã‚¨ãƒª)
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ–°è¦ç”Ÿæˆï¼‰

### æ–°è¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«

1. `XXXX_add_deleted_at_columns.sql` - ã‚«ãƒ©ãƒ ãƒ»ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¿½åŠ 
2. `YYYY_drop_deleted_tables.sql` - å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤

---

## âœ… å®Œäº†æ¡ä»¶

### Phase 1: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´

- [ ] `deleted_at`ã‚«ãƒ©ãƒ ã‚’Drizzleã‚¹ã‚­ãƒ¼ãƒã«è¿½åŠ 
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
- [ ] ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹SQLæ‰‹å‹•è¿½åŠ 
- [ ] ãƒ­ãƒ¼ã‚«ãƒ«DBå…¨æ¶ˆã—æˆåŠŸ
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡ŒæˆåŠŸ

### Phase 2-5: APIå®Ÿè£…å¤‰æ›´

- [ ] å‰Šé™¤å‡¦ç†ã‚’è«–ç†å‰Šé™¤ã«å¤‰æ›´
- [ ] å‰Šé™¤æ¸ˆã¿å–å¾—ã‚’å…ƒãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—ã«å¤‰æ›´
- [ ] å®Œå…¨å‰Šé™¤ã‚’ç‰©ç†å‰Šé™¤ã«å¤‰æ›´
- [ ] å¾©å…ƒã‚’`UPDATE deleted_at = NULL`ã«å¤‰æ›´
- [ ] é€šå¸¸å–å¾—ã‚¯ã‚¨ãƒªã«`isNull(deleted_at)`è¿½åŠ 

### Phase 6: æ¤œç´¢ãƒ»ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†

- [ ] ãƒœãƒ¼ãƒ‰APIä¿®æ­£
- [ ] ã‚«ã‚¦ãƒ³ãƒˆå‡¦ç†ä¿®æ­£
- [ ] æ¤œç´¢æ©Ÿèƒ½ç¢ºèª

### Phase 7: ã‚¹ã‚­ãƒ¼ãƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

- [ ] å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«å®šç¾©å‰Šé™¤
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
- [ ] DROP TABLE SQLè¿½åŠ 
- [ ] ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡ŒæˆåŠŸ

### Phase 8: ãƒ†ã‚¹ãƒˆ

- [ ] å‹ãƒã‚§ãƒƒã‚¯é€šéï¼ˆ`npm run check:api`ï¼‰
- [ ] å‹ãƒã‚§ãƒƒã‚¯é€šéï¼ˆ`npm run check:wsl`ï¼‰
- [ ] å‰Šé™¤æ©Ÿèƒ½å‹•ä½œç¢ºèªï¼ˆè«–ç†å‰Šé™¤ï¼‰
- [ ] å¾©å…ƒæ©Ÿèƒ½å‹•ä½œç¢ºèªï¼ˆ`deleted_at = NULL`ï¼‰
- [ ] å®Œå…¨å‰Šé™¤æ©Ÿèƒ½å‹•ä½œç¢ºèªï¼ˆç‰©ç†å‰Šé™¤ï¼‰
- [ ] å‰Šé™¤æ¸ˆã¿ä¸€è¦§è¡¨ç¤ºç¢ºèª
- [ ] é€šå¸¸ä¸€è¦§ã«å‰Šé™¤æ¸ˆã¿ãŒè¡¨ç¤ºã•ã‚Œãªã„ã“ã¨ç¢ºèª
- [ ] URLä¸å¤‰ã®ç¢ºèªï¼ˆ`id`, `display_id`ä¿æŒï¼‰
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç¢ºèªï¼ˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœ‰åŠ¹æ€§ï¼‰

---

## ğŸ‰ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### 1. URLå®‰å®šæ€§ã®å‘ä¸Š

- `id`ãŒå¤‰ã‚ã‚‰ãªã„ãŸã‚ã€URLï¼ˆä¾‹: `/memos/123`ï¼‰ãŒå‰Šé™¤ãƒ»å¾©å…ƒå¾Œã‚‚ä¸å¤‰
- ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã€å…±æœ‰ãƒªãƒ³ã‚¯ãŒæœ‰åŠ¹ã«ä¿ãŸã‚Œã‚‹

### 2. ã‚³ãƒ¼ãƒ‰ã®ã‚·ãƒ³ãƒ—ãƒ«åŒ–

- ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ”ãƒ¼å‡¦ç†ãŒä¸è¦
- å‰Šé™¤ã¯`UPDATE deleted_at = NOW()`ã®ã¿
- å¾©å…ƒã¯`UPDATE deleted_at = NULL`ã®ã¿
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ãŒä¸è¦

### 3. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š

- ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã®ãƒ‡ãƒ¼ã‚¿ç§»å‹•ãŒä¸è¦ã®ãŸã‚ã€å‰Šé™¤ãƒ»å¾©å…ƒãŒé«˜é€ŸåŒ–
- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚Šæ¤œç´¢é€Ÿåº¦ã‚’ç¶­æŒ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚Šã€å‡¦ç†ãŒå®‰å®š

### 4. ä¿å®ˆæ€§ã®å‘ä¸Š

- å‰Šé™¤æ¸ˆã¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç®¡ç†ãŒä¸è¦
- ã‚¹ã‚­ãƒ¼ãƒãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹
- ãƒã‚°ã®æ··å…¥ãƒªã‚¹ã‚¯ãŒä½æ¸›

---

## ğŸ“ ãƒ¡ãƒ¢ãƒ»å‚™è€ƒ

### å°†æ¥ã®æ‹¡å¼µæ€§

- è‡ªå‹•ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ©Ÿèƒ½ï¼ˆå‰Šé™¤å¾Œ30æ—¥ã§ç‰©ç†å‰Šé™¤ï¼‰
- å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®ä¸€æ‹¬ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- å‰Šé™¤å±¥æ­´ã®ç›£æŸ»ãƒ­ã‚°

### ãã®ä»–ã®æ”¹å–„æ¡ˆ

- `deleted_by`ã‚«ãƒ©ãƒ ã®è¿½åŠ ï¼ˆèª°ãŒå‰Šé™¤ã—ãŸã‹ï¼‰
- `deleted_reason`ã‚«ãƒ©ãƒ ã®è¿½åŠ ï¼ˆå‰Šé™¤ç†ç”±ï¼‰
- å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®æ¤œç´¢æ©Ÿèƒ½

---

ä»¥ä¸ŠãŒè«–ç†å‰Šé™¤æ–¹å¼ã¸ã®ç§»è¡Œè¨ˆç”»ã§ã™ã€‚
