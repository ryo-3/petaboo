# ãºãŸã¼ãƒ¼ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ãƒãƒƒãƒ—

**æœ€çµ‚æ›´æ–°æ—¥**: 2025-12-03

> ğŸ“– é–‹ç™ºãƒ«ãƒ¼ãƒ«ãƒ»ã‚³ãƒãƒ³ãƒ‰è©³ç´°ã¯ [CLAUDE.md](CLAUDE.md) ã‚’å‚ç…§

---

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“æ§‹é€ 

```
petaboo/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Next.js ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Port: 7593)
â”‚   â”œâ”€â”€ api/              # Hono API ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Port: 7594)
â”‚   â””â”€â”€ admin/            # ç®¡ç†ç”»é¢ï¼ˆå°†æ¥çš„ã«ä½¿ç”¨ï¼‰
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/               # å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ typescript-config/ # å…±é€šTypeScriptè¨­å®š
â”‚   â””â”€â”€ eslint-config/    # å…±é€šESLintè¨­å®š
â”œâ”€â”€ .claude/              # Claudeé–‹ç™ºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ CLAUDE.md         # é–‹ç™ºä»•æ§˜æ›¸ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
â”‚   â”œâ”€â”€ æ§‹é€ ãƒãƒƒãƒ—.md      # æœ¬ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ é–‹ç™ºãƒ¡ãƒ¢/         # æŠ€è¡“ãƒ¡ãƒ¢ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨˜éŒ²
â”‚   â”œâ”€â”€ è¨ˆç”»æ›¸/           # å®Ÿè£…è¨ˆç”»æ›¸ï¼ˆé€²è¡Œä¸­ï¼‰
â”‚   â””â”€â”€ å®Œäº†æ¸ˆè¨ˆç”»æ›¸/     # å®Œäº†ã—ãŸè¨ˆç”»æ›¸ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
â”œâ”€â”€ turbo.json            # Turborepoè¨­å®š
â”œâ”€â”€ filter-logs.sh        # ãƒ­ã‚°ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ web.log / api.log     # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ­ã‚°
```

---

## ğŸ—„ï¸ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€  (`apps/api/src/db/schema/`)

```
schema/
â”œâ”€â”€ users.ts              # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
â”œâ”€â”€ memos.ts              # ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ tasks.ts              # ã‚¿ã‚¹ã‚¯ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ boards.ts             # ãƒœãƒ¼ãƒ‰ï¼ˆã‚«ãƒ³ãƒãƒ³ï¼‰
â”œâ”€â”€ categories.ts         # ã‚«ãƒ†ã‚´ãƒª
â”œâ”€â”€ board-categories.ts   # ãƒœãƒ¼ãƒ‰ã‚«ãƒ†ã‚´ãƒª
â”œâ”€â”€ tags.ts               # ã‚¿ã‚°
â”œâ”€â”€ attachments.ts        # æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ user-preferences.ts   # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
â””â”€â”€ team/                 # ãƒãƒ¼ãƒ é–¢é€£ãƒ†ãƒ¼ãƒ–ãƒ«ç¾¤
    â”œâ”€â”€ teams.ts
    â”œâ”€â”€ team-members.ts
    â”œâ”€â”€ team-invitations.ts
    â”œâ”€â”€ team-activities.ts
    â”œâ”€â”€ team-notifications.ts
    â”œâ”€â”€ slack-configs.ts
    â””â”€â”€ comments.ts
```

---

## ğŸ›£ï¸ APIæ§‹é€  (`apps/api/src/routes/`)

**ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ**: `worker-d1.ts` â† å…¨ãƒ«ãƒ¼ãƒˆã‚’ã“ã“ã§ç™»éŒ²

```
routes/
â”œâ”€â”€ users/                # /users/* - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
â”œâ”€â”€ memos/                # /memos/* - ãƒ¡ãƒ¢CRUD
â”œâ”€â”€ tasks/                # /tasks/* - ã‚¿ã‚¹ã‚¯CRUD
â”œâ”€â”€ boards/               # /boards/* - ãƒœãƒ¼ãƒ‰CRUD
â”‚   â””â”€â”€ slack-config/     # Slacké€£æºè¨­å®š
â”œâ”€â”€ categories/           # /categories/* - ã‚«ãƒ†ã‚´ãƒªç®¡ç†
â”œâ”€â”€ board-categories/     # /board-categories/* - ãƒœãƒ¼ãƒ‰ã‚«ãƒ†ã‚´ãƒª
â”œâ”€â”€ tags/                 # /tags/* - ã‚¿ã‚°ç®¡ç†
â”œâ”€â”€ taggings/             # /taggings/* - ã‚¿ã‚°ä»˜ã‘
â”œâ”€â”€ attachments/          # /attachments/* - æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ user-preferences/     # /user-preferences/* - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
â”œâ”€â”€ teams/                # /teams/* - ãƒãƒ¼ãƒ ç®¡ç†
â”‚   â””â”€â”€ slack-config/     # Slacké€£æºè¨­å®š
â”œâ”€â”€ team-activities/      # /team-activities/* - ãƒãƒ¼ãƒ æ´»å‹•å±¥æ­´
â”œâ”€â”€ notifications/        # /notifications/* - é€šçŸ¥
â”œâ”€â”€ comments/             # /comments/* - ã‚³ãƒ¡ãƒ³ãƒˆ
â””â”€â”€ webhooks/             # /webhooks/* - Webhook

å„ãƒ«ãƒ¼ãƒˆã®æ§‹æˆ:
â”œâ”€â”€ route.ts              # ãƒ«ãƒ¼ãƒˆå®šç¾©ï¼ˆOpenAPIï¼‰
â””â”€â”€ api.ts                # å®Ÿè£…ãƒ­ã‚¸ãƒƒã‚¯
```

---

## ğŸ¨ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ§‹é€  (`apps/web/src/`)

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ (auth)/            # èªè¨¼é–¢é€£ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ (dashboard)/       # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ admin/             # ç®¡ç†ç”»é¢
â”‚   â”œâ”€â”€ api/               # APIãƒ«ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ boards/            # ãƒœãƒ¼ãƒ‰é–¢é€£
â”‚   â”œâ”€â”€ join/              # ãƒãƒ¼ãƒ æ‹›å¾…
â”‚   â”œâ”€â”€ share/             # å…±æœ‰æ©Ÿèƒ½
â”‚   â”œâ”€â”€ team/              # ãƒãƒ¼ãƒ æ©Ÿèƒ½
â”‚   â”œâ”€â”€ layout.tsx         # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ main.tsx           # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â””â”€â”€ globals.css        # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚
â”œâ”€â”€ components/shared/     # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ9ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”‚   â”œâ”€â”€ base-viewer.tsx    # ãƒ™ãƒ¼ã‚¹ãƒ“ãƒ¥ãƒ¼ãƒ¯ãƒ¼
â”‚   â”œâ”€â”€ board-tag-display.tsx # ãƒœãƒ¼ãƒ‰ã‚¿ã‚°è¡¨ç¤º
â”‚   â”œâ”€â”€ creator-avatar.tsx # ä½œæˆè€…ã‚¢ãƒã‚¿ãƒ¼
â”‚   â”œâ”€â”€ csv-import-modal.tsx # CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«
â”‚   â”œâ”€â”€ date-info.tsx      # æ—¥ä»˜æƒ…å ±
â”‚   â”œâ”€â”€ item-filter-wrapper.tsx # ã‚¢ã‚¤ãƒ†ãƒ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ©ãƒƒãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ search-results.tsx # æ¤œç´¢çµæœ
â”‚   â”œâ”€â”€ sidebar-item.tsx   # ã‚µã‚¤ãƒ‰ãƒãƒ¼ã‚¢ã‚¤ãƒ†ãƒ 
â”‚   â””â”€â”€ user-member-card.tsx # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ‰
â”‚
â”œâ”€â”€ hooks/                 # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆ80ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ contexts/              # React Contextï¼ˆ8ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ types/                 # å‹å®šç¾©
â”‚   â”œâ”€â”€ api.ts            # APIå‹ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
â”‚   â””â”€â”€ common.ts         # å…±é€šå‹ï¼ˆOriginalIdç­‰ï¼‰
â”œâ”€â”€ utils/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼ˆ22ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
â”œâ”€â”€ lib/                   # å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®š
â”œâ”€â”€ constants/             # å®šæ•°å®šç¾©
â””â”€â”€ styles/                # ã‚¹ã‚¿ã‚¤ãƒ«é–¢é€£
```

### ğŸ“– é‡è¦ãªç”¨èªå®šç¾©

#### ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**: `HeaderControlPanel` (`apps/web/components/ui/controls/header-control-panel.tsx`)

**èª¬æ˜**:

- ãƒ˜ãƒƒãƒ€ãƒ¼ä½ç½®ã« `position: fixed` ã§æµ®ã‹ã‚“ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«
- `floatControls={true}` ã§ä½¿ç”¨ã•ã‚Œã‚‹
- ç”»é¢ä¸Šéƒ¨ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã®é«˜ã•å†…ï¼‰ã«é…ç½®ã•ã‚Œã€å·¦ãƒ»ä¸­å¤®ãƒ»å³ã®3ã¤ã®ä½ç½®ã«ç§»å‹•å¯èƒ½

**å«ã¾ã‚Œã‚‹æ©Ÿèƒ½**:

- ã‚«ãƒ©ãƒ æ•°å¤‰æ›´ (`ColumnCountSelector`)
- é¸æŠãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ (`SelectionModeToggle` - ãƒã‚§ãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰)
- ãƒœãƒ¼ãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡ã‚Šæ›¿ãˆ (`BoardLayoutToggle`)
- **ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ** (`ContentFilter` - 3ãƒ‘ãƒãƒ«ã®è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ)
- ã‚½ãƒ¼ãƒˆ (`SortToggle`)
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ (`UnifiedFilterButton`)
- CSV ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

**ä½¿ç”¨ç®‡æ‰€**:

- `DesktopUpper` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ä½¿ç”¨
- ãƒ¡ãƒ¢ç”»é¢ã€ã‚¿ã‚¹ã‚¯ç”»é¢ã€ãƒœãƒ¼ãƒ‰ç”»é¢ã®å…¨ã¦ã§å…±é€šä½¿ç”¨

**è¦–è¦šçš„ç‰¹å¾´**:

- åŠé€æ˜èƒŒæ™¯ (`bg-white/95 backdrop-blur-sm`)
- è§’ä¸¸ (`rounded-lg`)
- é«˜ã•å›ºå®š (`h-7`)
- z-index: 20

---

### ğŸ£ hooks/ï¼ˆæ©Ÿèƒ½åˆ¥åˆ†é¡ï¼‰

#### ğŸ”§ ã‚³ã‚¢ãƒ‡ãƒ¼ã‚¿æ“ä½œï¼ˆæœ€é‡è¦ï¼‰

- **use-unified-item-operations.ts** - ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ãƒ»ãƒœãƒ¼ãƒ‰ã®çµ±ä¸€CRUDæ“ä½œ
- **use-all-data.ts** - å…¨ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬å–å¾—
- **use-board-operations.ts** - ãƒœãƒ¼ãƒ‰å°‚ç”¨æ“ä½œ
- **use-deleted-item-operations.ts** - å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ æ“ä½œ

#### ğŸ“¦ å€‹åˆ¥ãƒªã‚½ãƒ¼ã‚¹å–å¾—

- **use-memos.ts** / **use-tasks.ts** / **use-boards.ts** - å€‹äººãƒ‡ãƒ¼ã‚¿
- **use-team-memos.ts** / **use-team-tasks.ts** / **use-team-boards.ts** - ãƒãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿
- **use-tags.ts** / **use-categories.ts** / **use-board-categories.ts**
- **use-attachments.ts** / **use-notifications.ts**

#### ğŸ‘¥ ãƒãƒ¼ãƒ æ©Ÿèƒ½

- **use-teams.ts** / **use-team-detail.ts** / **use-create-team.ts**
- **use-invite-to-team.ts** / **use-join-by-code.ts** / **use-join-requests.ts**
- **use-team-comments.ts** / **use-team-activities.ts** / **use-team-stats.ts**
- **use-kick-member.ts** / **use-manage-join-request.ts**

#### ğŸ—‘ï¸ å‰Šé™¤ãƒ»å¾©å…ƒç³»

- **use-bulk-delete-unified.tsx** - ä¸€æ‹¬å‰Šé™¤ï¼ˆçµ±ä¸€ç‰ˆï¼‰
- **use-bulk-delete-operations.tsx** / **use-bulk-delete-button.ts**
- **use-bulk-animation.tsx** - å‰Šé™¤ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
- **use-board-bulk-restore.tsx** - ãƒœãƒ¼ãƒ‰ä¸€æ‹¬å¾©å…ƒ
- **use-unified-restoration.ts** - çµ±ä¸€å¾©å…ƒå‡¦ç†
- **use-memo-delete-with-next-selection.ts** - å‰Šé™¤å¾Œã®æ¬¡é¸æŠ
- **use-next-deleted-item-selection.ts** - å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ é¸æŠ

#### ğŸ¯ é¸æŠãƒ»UIçŠ¶æ…‹ç®¡ç†

- **use-multi-selection.ts** - é¸æŠçŠ¶æ…‹ç®¡ç†ï¼ˆmemo/task/boardå…¨ç”»é¢ã§ä½¿ç”¨ãƒ»Phase 1å®Œäº†ï¼‰
- **use-select-all.ts** / **use-board-select-all.ts** - å…¨é¸æŠæ©Ÿèƒ½
- **use-selection-handlers.ts** / **use-item-deselect.ts** - é¸æŠãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- **use-board-state.ts** / **use-screen-state.ts** - ç”»é¢çŠ¶æ…‹ç®¡ç†ï¼ˆPhase 2å®Œäº†ï¼‰
- **use-set-state.ts** - æ±ç”¨stateç®¡ç†
- **use-view-mode-storage.ts** - ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ä¿å­˜

#### ğŸ“ ãƒ•ã‚©ãƒ¼ãƒ ãƒ»ä¿å­˜

- **use-memo-form.ts** - ãƒ¡ãƒ¢ãƒ•ã‚©ãƒ¼ãƒ 
- **use-simple-memo-save.ts** / **use-simple-item-save.ts** - ç°¡æ˜“ä¿å­˜

#### ğŸ”” é€šçŸ¥ãƒ»Slack

- **use-personal-notifier.ts** / **use-simple-team-notifier.ts**
- **use-bulk-process-notifications.tsx** - ä¸€æ‹¬é€šçŸ¥å‡¦ç†
- **use-board-slack-config.ts** / **use-team-slack-config.ts**

#### ğŸ› ï¸ ãã®ä»–ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

- **use-global-search.ts** - ã‚°ãƒ­ãƒ¼ãƒãƒ«æ¤œç´¢
- **use-export.ts** - ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **use-api-sync.ts** / **use-local-storage-sync.ts**
- **use-user-preferences.ts** / **use-user-info.ts** / **use-user.ts**
- **use-ensure-user.ts** - ãƒ¦ãƒ¼ã‚¶ãƒ¼å­˜åœ¨ç¢ºèª
- **useAnimatedCounter.ts** - ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
- **ãã®ä»–30+ãƒ•ã‚¡ã‚¤ãƒ«** - ã‚¿ã‚°ä»˜ã‘ã€ãƒœãƒ¼ãƒ‰ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€å‰Šé™¤LIDãªã©

### ğŸŒ contexts/

#### âœ… Contexté…ç½®ã®çµ±ä¸€å®Œäº†ï¼ˆ2025-12-03æ›´æ–°ï¼‰

**å…¨ã¦ã®Contextãƒ•ã‚¡ã‚¤ãƒ« `apps/web/src/contexts/`ï¼ˆ8ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰**:

- PageVisibilityContext.tsx
- header-control-panel-context.tsxï¼ˆæ–°è¦è¿½åŠ ï¼‰
- navigation-context.tsx
- team-context.tsx
- team-detail-context.tsx
- toast-context.tsx
- user-preferences-context.tsx
- view-settings-context.tsx

**å‰Šé™¤æ¸ˆã¿**:

- âŒ `multi-selection-context.tsx`ï¼ˆæœªä½¿ç”¨ã®Contextç‰ˆãƒ»ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ï¼‰
- âŒ `selector-context.tsx`ï¼ˆNavigationContextã«çµ±åˆæ¸ˆã¿ï¼‰

#### Provideréšå±¤æ§‹é€ ï¼ˆapp/layout.tsxï¼‰

```tsx
<QueryProvider>
  <PageVisibilityProvider>
    <UserPreferencesProvider>
      <ViewSettingsProvider userId={1}>
        <ToastProvider>
          <HeaderControlPanelProvider>
            {children}
          </HeaderControlPanelProvider>
        </ToastProvider>
      </ViewSettingsProvider>
    </UserPreferencesProvider>
  </PageVisibilityProvider>
</QueryProvider>

// ãƒãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã®ã¿ï¼ˆteam/[customUrl]/layout.tsxï¼‰
<TeamProvider>
  <NavigationProvider>
    <TeamDetailProvider>
      {children}
```

**é‡è¦**: ViewSettingsProviderã¯TeamProviderã®**å¤–å´**ã«ã‚ã‚‹ãŸã‚ã€TeamContextã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„

#### Contextè©³ç´°ï¼ˆå…¨8ç¨®é¡ + é¸æŠçŠ¶æ…‹ç®¡ç†Hook 1ç¨®é¡ï¼‰

##### 1. **ViewSettingsContext** - è¡¨ç¤ºè¨­å®šãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç®¡ç†ï¼ˆçµ±ä¸€Contextï¼‰

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/view-settings-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useViewSettings()`
- **Provideré…ç½®**: app/layout.tsxï¼ˆUserPreferencesProviderã®å†…å´ã€ToastProviderã®å¤–å´ï¼‰

**localStorageæ°¸ç¶šåŒ–è¨­å®šï¼ˆViewSettingså‹ï¼‰**:

- `memoColumnCount` / `taskColumnCount` / `boardColumnCount` - ã‚«ãƒ©ãƒ æ•°
- `memoHideControls` / `taskHideControls` - ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«è¡¨ç¤º/éè¡¨ç¤º
- `hideHeader` - ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤º/éè¡¨ç¤º
- `showTagDisplay` - ã‚¿ã‚°è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼ˆãƒœãƒ¼ãƒ‰è©³ç´°ç”¨ï¼‰

**ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹ï¼ˆä¸€æ™‚çš„ã€SessionStateå‹ï¼‰**:

- `selectedTagIds` / `selectedBoardIds` - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é¸æŠ
- `tagFilterMode` / `boardFilterMode` - "include" | "exclude"
- `sortOptions` - ã‚½ãƒ¼ãƒˆè¨­å®šé…åˆ—
- `filterModalOpen` / `activeFilterTab` - çµ±åˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«çŠ¶æ…‹

**ãƒãƒ¼ãƒ æƒ…å ±**:

- `teamMode` - ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ï¼ˆTeamContextã‹ã‚‰å–å¾—ï¼‰
- `teamId` - ãƒãƒ¼ãƒ IDï¼ˆTeamContextã‹ã‚‰å–å¾—ï¼‰

**ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°**:

- `updateSettings(updates)` - è¨­å®šæ›´æ–°ï¼ˆlocalStorageã«è‡ªå‹•ä¿å­˜ï¼‰
- `updateSessionState(updates)` - ã‚»ãƒƒã‚·ãƒ§ãƒ³çŠ¶æ…‹æ›´æ–°
- `openFilterModal(tab?)` / `closeFilterModal()` - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹é–‰
- `clearCurrentFilter()` - ç¾åœ¨ã®ã‚¿ãƒ–ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚¯ãƒªã‚¢
- `getActiveFilterCount()` - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç·ä»¶æ•°å–å¾—
- `resetFilters()` - å…¨ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒªã‚»ãƒƒãƒˆ
- `resetAllSettings()` - å…¨è¨­å®šãƒªã‚»ãƒƒãƒˆï¼ˆlocalStorageå‰Šé™¤ï¼‰

**ä½¿ç”¨ä¾‹**:

```tsx
const {
  settings,
  updateSettings,
  sessionState,
  updateSessionState,
  teamMode,
  teamId,
  openFilterModal,
  getActiveFilterCount,
} = useViewSettings();

// ã‚«ãƒ©ãƒ æ•°å¤‰æ›´
updateSettings({ memoColumnCount: 3 });

// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é¸æŠ
updateSessionState({ selectedTagIds: [1, 2, 3] });

// ãƒ¢ãƒ¼ãƒ€ãƒ«é–‹ã
openFilterModal("tag");
```

##### 2. **NavigationContext** - ç”»é¢ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»çŠ¶æ…‹ç®¡ç†

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/contexts/navigation-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useNavigation()`
- **Provideré…ç½®**: team/[customUrl]/layout.tsxï¼ˆTeamProviderã®å†…å´ï¼‰ã€å€‹äººç”»é¢ã§ã‚‚ä½¿ç”¨

**ç”»é¢ãƒ¢ãƒ¼ãƒ‰ç®¡ç†**:

- `screenMode` - "home" | "memo" | "task" | "create" | "search" | "settings" | "board" | "welcome" | "team" | "loading"
- `currentMode` - "memo" | "task" | "board"ï¼ˆå€‹äººç”»é¢ã®ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ï¼‰
- `setScreenMode(mode)` / `setCurrentMode(mode)` - ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ

**ã‚¢ã‚¤ã‚³ãƒ³çŠ¶æ…‹ï¼ˆIconStateså‹ï¼‰**:

- `iconStates` - å„ã‚¢ã‚¤ã‚³ãƒ³ã®æœ‰åŠ¹åŒ–çŠ¶æ…‹ï¼ˆhome, memo, task, board, boardDetail, search, settings, teamï¼‰

**æ¥½è¦³çš„æ›´æ–°**:

- `setOptimisticMode(mode)` - URLå¤‰æ›´å‰ã«å³åº§ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹

**UIçŠ¶æ…‹ç®¡ç†**:

- `showTeamList` / `setShowTeamList` - ãƒãƒ¼ãƒ ä¸€è¦§è¡¨ç¤º
- `showTeamCreate` / `setShowTeamCreate` - ãƒãƒ¼ãƒ ä½œæˆè¡¨ç¤º
- `showingBoardDetail` / `setShowingBoardDetail` - ãƒœãƒ¼ãƒ‰è©³ç´°è¡¨ç¤ºä¸­
- `isFromBoardDetail` / `setIsFromBoardDetail` - ãƒœãƒ¼ãƒ‰è©³ç´°ã‹ã‚‰é·ç§»ã—ãŸã‹

**æ–°è¦ä½œæˆçŠ¶æ…‹ï¼ˆãƒ¢ãƒã‚¤ãƒ«ãƒ•ãƒƒã‚¿ãƒ¼ç”¨ï¼‰**:

- `isCreatingMemo` / `setIsCreatingMemo`
- `isCreatingTask` / `setIsCreatingTask`

**é¸æŠãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç™»éŒ²**:

- `handleMainSelectMemo` / `setHandleMainSelectMemo` - ãƒ¡ãƒ¢é¸æŠæ™‚ã®å‡¦ç†
- `handleMainSelectTask` / `setHandleMainSelectTask` - ã‚¿ã‚¹ã‚¯é¸æŠæ™‚ã®å‡¦ç†

**ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åˆ¶å¾¡ï¼ˆSelectorContextã‹ã‚‰çµ±åˆãƒ»2025-11-08ï¼‰**:

- `activeSelector` - ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼å
- `setActiveSelector(name)` - ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆï¼ˆè¤‡æ•°ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼é–‹é–‰æ™‚ã®æ’ä»–åˆ¶å¾¡ï¼‰

##### 3. **TeamContext** - ãƒãƒ¼ãƒ æƒ…å ±ç®¡ç†

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/team-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useTeamContext()`
- **Provideré…ç½®**: team/[customUrl]/layout.tsxï¼ˆURLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰è‡ªå‹•å–å¾—ï¼‰

**æä¾›æƒ…å ±**:

- `isTeamMode` - ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ï¼ˆå¸¸ã«trueï¼‰
- `teamId` - ç¾åœ¨ã®ãƒãƒ¼ãƒ ID
- `customUrl` - ãƒãƒ¼ãƒ ã®ã‚«ã‚¹ã‚¿ãƒ URL
- `teamData` - ãƒãƒ¼ãƒ è©³ç´°ãƒ‡ãƒ¼ã‚¿ï¼ˆuseTeamDetailã®çµæœï¼‰

**ä½¿ç”¨ä¾‹**:

```tsx
const { isTeamMode, teamId, customUrl } = useTeamContext();
if (isTeamMode) {
  // ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã®å‡¦ç†
}
```

##### 4. **TeamDetailContext** - ãƒãƒ¼ãƒ è©³ç´°ç”»é¢çŠ¶æ…‹

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/team-detail-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useTeamDetailContext()`
- **Provideré…ç½®**: team/[customUrl]/layout.tsxï¼ˆTeamProviderã®å†…å´ï¼‰

**æä¾›æƒ…å ±**:

- `teamId` - ãƒãƒ¼ãƒ ID
- `customUrl` - ã‚«ã‚¹ã‚¿ãƒ URL
- `activeTab` - ç¾åœ¨ã®ã‚¿ãƒ–ï¼ˆ"overview" | "memos" | "tasks" | "boards" | "team-settings" ãªã©ï¼‰
- `setActiveTab(tab)` - ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
- `isTabActive(tab)` - ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‹ã©ã†ã‹

##### 5. **UserPreferencesContext** - ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šç®¡ç†ï¼ˆAPIé€£æºï¼‰

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/user-preferences-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useUserPreferencesContext()`
- **Provideré…ç½®**: app/layout.tsxï¼ˆPageVisibilityProviderã®å†…å´ï¼‰

**æä¾›æƒ…å ±**:

- `preferences` - UserPreferenceså‹ã®ãƒ‡ãƒ¼ã‚¿
  - `userId` / `memoColumnCount` / `taskColumnCount`
  - `memoHideControls` / `taskHideControls` / `hideHeader`
  - `createdAt` / `updatedAt`
- `loading` - èª­ã¿è¾¼ã¿ä¸­ãƒ•ãƒ©ã‚°
- `error` - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- `updatePreferences(updates)` - è¨­å®šæ›´æ–°ï¼ˆAPIçµŒç”±ï¼‰
- `refreshPreferences()` - è¨­å®šå†å–å¾—

**æ³¨æ„**: ç®¡ç†ç”»é¢ã§ã¯å¸¸ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ï¼ˆAPIã‚³ãƒ¼ãƒ«ãªã—ï¼‰

##### 6. **~~MultiSelectionContext~~** ï¼ˆContextç‰ˆã¯å‰Šé™¤æ¸ˆã¿ï¼‰

- **ãƒ•ã‚¡ã‚¤ãƒ«**: ~~`apps/web/src/contexts/multi-selection-context.tsx`~~ âŒ å‰Šé™¤æ¸ˆã¿ï¼ˆ2025-11-08ï¼‰
- **çŠ¶æ…‹**: ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ã®ãŸã‚å‰Šé™¤ï¼ˆHookç‰ˆã«çµ±ä¸€ï¼‰

##### 6-2. **useMultiSelection** - è¤‡æ•°é¸æŠçŠ¶æ…‹ç®¡ç†ï¼ˆHookç‰ˆãƒ»å…¨ç”»é¢ã§ä½¿ç”¨ä¸­ï¼‰

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/hooks/use-multi-selection.ts`
- **ãƒ•ãƒƒã‚¯å**: `useMultiSelection({ activeMemoTab, activeTaskTab })`
- **ä½¿ç”¨ç®‡æ‰€**: âœ… **å…¨ç”»é¢ã§çµ±ä¸€ä½¿ç”¨ä¸­**ï¼ˆPhase 1å®Œäº†ãƒ»2025-11-08ï¼‰
  - memo-screen.tsx
  - task-screen.tsx
  - board-detail-screen.tsx
  - board-detail-screen-3panel.tsx

**æä¾›æƒ…å ±**:

- `selectionMode` / `setSelectionMode` - é¸æŠãƒ¢ãƒ¼ãƒ‰ ("select" | "check")
- `handleSelectionModeChange(mode)` - ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆï¼ˆselectæ™‚ã«å…¨é¸æŠã‚¯ãƒªã‚¢ï¼‰

**ãƒ¡ãƒ¢é¸æŠçŠ¶æ…‹**:

- `checkedNormalMemos` / `setCheckedNormalMemos` - é€šå¸¸ãƒ¡ãƒ¢
- `checkedDeletedMemos` / `setCheckedDeletedMemos` - å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢
- `handleMemoSelectionToggle(id)` - ãƒ¡ãƒ¢é¸æŠãƒˆã‚°ãƒ«

**ã‚¿ã‚¹ã‚¯é¸æŠçŠ¶æ…‹**:

- `checkedTodoTasks` / `checkedInProgressTasks` / `checkedCompletedTasks` / `checkedDeletedTasks`
- å„ç¨®setteré–¢æ•°
- `handleTaskSelectionToggle(id)` - ã‚¿ã‚¹ã‚¯é¸æŠãƒˆã‚°ãƒ«

**ä½¿ç”¨ä¾‹**:

```tsx
// memo-screen.tsx
const {
  selectionMode,
  handleSelectionModeChange,
  checkedNormalMemos,
  checkedDeletedMemos,
} = useMultiSelection({ activeMemoTab: activeTab, activeTaskTab: "" });

// task-screen.tsx
const {
  selectionMode,
  handleSelectionModeChange,
  checkedTodoTasks,
  checkedInProgressTasks,
  checkedCompletedTasks,
  checkedDeletedTasks,
} = useMultiSelection({ activeMemoTab: "", activeTaskTab: activeTab });

// board-detail-screen.tsx
const { ... } = useMultiSelection({ activeMemoTab, activeTaskTab });
```

**æ”¹å–„çµæœ**ï¼ˆPhase 1å®Œäº†ï¼‰:

- âœ… é¸æŠçŠ¶æ…‹ç®¡ç†ãŒå…¨ç”»é¢ã§çµ±ä¸€
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«stateç®¡ç†å‰Šé™¤ï¼ˆç´„40è¡Œå‰Šæ¸›ï¼‰
- âœ… ãƒã‚°ä¿®æ­£æ™‚ã«1ç®‡æ‰€ä¿®æ­£ã™ã‚Œã°å…¨ç”»é¢ã«åæ˜ 

**ğŸš¨ é‡è¦ãªè¨­è¨ˆæ±ºå®šï¼ˆ2025-11-08ï¼‰: ContextåŒ–ã¯è¡Œã‚ãªã„**

**çµŒç·¯**:

- è¨­è¨ˆã®ä¸€è²«æ€§ã‚’ä¿ã¤ãŸã‚ã€useMultiSelectionã‚’ContextåŒ–ã™ã‚‹ã“ã¨ã‚’æ¤œè¨
- MultiSelectionProviderã‚’ä½œæˆã—ã€å…¨ç”»é¢ã§è©¦é¨“çš„ã«å®Ÿè£…
- **çµæœ**: ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤æ¸ˆã‚¿ãƒ–ã§é¸æŠãŒã™ãã«å¤–ã‚Œã‚‹å•é¡ŒãŒå†ç™ºã—å¤±æ•—
- `git restore`ã§å…¨ã¦ã®ContextåŒ–å¤‰æ›´ã‚’å–ã‚Šæ¶ˆã—ã€Hookç‰ˆã«æˆ»ã—ãŸ

**ContextåŒ–ãŒå¤±æ•—ã—ãŸç†ç”±**:

- useMultiSelectionã¯**å„ç”»é¢ã”ã¨ã«ç‹¬ç«‹ã—ãŸã‚¿ãƒ–çŠ¶æ…‹**ã‚’æŒã¤
- memo-screenã€task-screenã€board-detail-screenãã‚Œãã‚ŒãŒç‹¬è‡ªã®activeTabã‚’ç®¡ç†
- ã‚°ãƒ­ãƒ¼ãƒãƒ«Contextã«æ˜‡æ ¼ã•ã›ã‚‹ã¨ã€ç”»é¢é–“ã§ã‚¿ãƒ–çŠ¶æ…‹ãŒç«¶åˆãƒ»æ··ä¹±ã™ã‚‹
- **å„ç”»é¢ç‹¬ç«‹ã®çŠ¶æ…‹ã¯Hookãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ–¹ãŒé©ã—ã¦ã„ã‚‹**

**æœ€çµ‚æ±ºå®š**: Hookç‰ˆã‚’ç¶­æŒã—ã€å‰Šé™¤æ¸ˆã‚¿ãƒ–ã¯ãƒ­ãƒ¼ã‚«ãƒ«stateç®¡ç†

task-screen.tsxï¼ˆ438-442è¡Œç›®ï¼‰ã§ä»¥ä¸‹ã®å¯¾å¿œã‚’å®Ÿæ–½:

```tsx
// ğŸš¨ å‰Šé™¤æ¸ˆã‚¿ãƒ–ã®é¸æŠçŠ¶æ…‹ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ç®¡ç†ï¼ˆuseMultiSelectionã‹ã‚‰ç‹¬ç«‹ï¼‰
const [checkedDeletedTasksLocal, setCheckedDeletedTasksLocal] = useState<
  Set<number>
>(new Set());

const checkedDeletedTasks = checkedDeletedTasksLocal;
const setCheckedDeletedTasks = setCheckedDeletedTasksLocal;
```

**è¨­è¨ˆæ€æƒ³ã®é•ã„**:

| Context                | ç”¨é€”                | ä¾‹                                 |
| ---------------------- | ------------------- | ---------------------------------- |
| ViewSettingsContext    | âœ… å…¨ç”»é¢å…±é€šè¨­å®š   | ã‚«ãƒ©ãƒ æ•°ã€ã‚½ãƒ¼ãƒˆé †ã€ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶   |
| UserPreferencesContext | âœ… ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¨ä½“è¨­å®š | ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€è¨€èªè¨­å®š             |
| useMultiSelection      | âŒ å„ç”»é¢ç‹¬ç«‹çŠ¶æ…‹   | ç”»é¢ã”ã¨ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é¸æŠçŠ¶æ…‹ |

**çµè«–**: ç„¡ç†ã«ContextåŒ–ã›ãšã€é©æé©æ‰€ã§Hookã¨Contextã‚’ä½¿ã„åˆ†ã‘ã‚‹

##### 7. **HeaderControlPanelContext** - ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ«è¨­å®šï¼ˆæ–°è¦è¿½åŠ ï¼‰

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/header-control-panel-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useHeaderControlPanel()`
- **Provideré…ç½®**: app/layout.tsxï¼ˆToastProviderã®å†…å´ï¼‰

**æä¾›æƒ…å ±ï¼ˆHeaderControlPanelConfigå‹ï¼‰**:

- `currentMode` - "memo" | "task" | "board"
- `rightPanelMode` - "hidden" | "view" | "create"
- `selectionMode` / `onSelectionModeChange` - é¸æŠãƒ¢ãƒ¼ãƒ‰ç®¡ç†
- `boardId` / `onBoardSettings` - ãƒœãƒ¼ãƒ‰é–¢é€£
- `showMemo` / `showTask` / `showComment` - 3ãƒ‘ãƒãƒ«è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
- `teamMode` / `teamId` - ãƒãƒ¼ãƒ é–¢é€£
- `activeTab` / å„ç¨®ã‚«ã‚¦ãƒ³ãƒˆ - ã‚¿ãƒ–ãƒ»ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±
- ãã®ä»–CSV/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€ã‚¿ã‚¤ãƒˆãƒ«è¨­å®šãªã©

**ä½¿ç”¨ä¾‹**:

```tsx
const { config, setConfig } = useHeaderControlPanel();
setConfig({
  currentMode: "memo",
  rightPanelMode: "view",
});
```

##### 8. **~~SelectorContext~~** - âŒ å‰Šé™¤æ¸ˆã¿ï¼ˆNavigationContextã«çµ±åˆãƒ»2025-11-08ï¼‰

- **æ—§ãƒ•ã‚¡ã‚¤ãƒ«**: ~~`apps/web/src/contexts/selector-context.tsx`~~ â†’ å‰Šé™¤
- **çµ±åˆå…ˆ**: NavigationContext
- **ç†ç”±**: å˜ä¸€çŠ¶æ…‹ã®ã¿ç®¡ç†ã€ä½¿ç”¨ç®‡æ‰€1ãƒ•ã‚¡ã‚¤ãƒ«ã€UIçŠ¶æ…‹ç®¡ç†ã¨ã—ã¦çµ±åˆãŒé©åˆ‡

##### 9. **ToastContext** - ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ç®¡ç†

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/toast-context.tsx`
- **ãƒ•ãƒƒã‚¯å**: `useToast()`
- **Provideré…ç½®**: app/layout.tsxï¼ˆViewSettingsProviderã®å†…å´ï¼‰

**æä¾›æƒ…å ±**:

- `toasts` - ç¾åœ¨è¡¨ç¤ºä¸­ã®ãƒˆãƒ¼ã‚¹ãƒˆé…åˆ—
- `showToast(message, type, duration?)` - ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºï¼ˆsuccess / error / warning / infoï¼‰
- `removeToast(id)` - ãƒˆãƒ¼ã‚¹ãƒˆå‰Šé™¤

**ä½¿ç”¨ä¾‹**:

```tsx
const { showToast } = useToast();
showToast("ä¿å­˜ã—ã¾ã—ãŸ", "success", 3000);
```

##### 9. **PageVisibilityContext** - ãƒšãƒ¼ã‚¸å¯è¦–æ€§ãƒ»ãƒã‚¦ã‚¹æ¤œçŸ¥

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/src/contexts/PageVisibilityContext.tsx`
- **ãƒ•ãƒƒã‚¯å**: `usePageVisibility()`
- **Provideré…ç½®**: app/layout.tsxï¼ˆQueryProviderã®å†…å´ã€æœ€ã‚‚å¤–å´ã®Contextï¼‰

**æä¾›æƒ…å ±**:

- `isPageVisible` - ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã‹
- `isMouseInWindow` - ãƒã‚¦ã‚¹ãŒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å†…ã«ã‚ã‚‹ã‹

**ä½¿ç”¨ä¾‹**:

```tsx
const { isPageVisible, isMouseInWindow } = usePageVisibility();
// ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰æ™‚ã¯ãƒãƒ¼ãƒªãƒ³ã‚°åœæ­¢ãªã©
```

### ğŸ› ï¸ utils/

#### æ—¥ä»˜ãƒ»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

- **dateUtils.ts** / **formatDate.ts** - æ—¥ä»˜å‡¦ç†

#### UIãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

- **bulkAnimationUtils.ts** / **deleteAnimation.ts**
- **bulkButtonUtils.ts** / **toggleUtils.ts**

#### URLãƒ»ãƒªãƒ³ã‚¯

- **urlUtils.ts** / **url-detector.tsx** / **linkify.tsx**

#### ãã®ä»–

- **taskUtils.ts** / **userUtils.ts** / **notificationUtils.ts**
- **domUtils.ts** / **screenUtils.ts** / **modeUtils.ts**
- **teamTypeConverter.ts** - ãƒãƒ¼ãƒ å‹å¤‰æ›

---

## ğŸ“š .claude/ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½“ç³»

```
.claude/
â”œâ”€â”€ CLAUDE.md                        # é–‹ç™ºä»•æ§˜æ›¸ï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰
â”œâ”€â”€ æ§‹é€ ãƒãƒƒãƒ—.md                     # æœ¬ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ refactor-rules.md                # ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ãƒ«ãƒ¼ãƒ«
â”œâ”€â”€ settings.local.json              # ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®š
â”œâ”€â”€ é–‹ç™ºãƒ¡ãƒ¢/                        # æŠ€è¡“ãƒ¡ãƒ¢ãƒ»å•é¡Œè§£æ±ºè¨˜éŒ²
â”‚   â”œâ”€â”€ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯.md
â”‚   â”œâ”€â”€ ãƒ¡ãƒ¢æ§‹é€ ã«ã¤ã„ã¦.md
â”‚   â”œâ”€â”€ ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­è¨ˆã«ã¤ã„ã¦.md
â”‚   â”œâ”€â”€ petaboo/                     # PETABOOã‚¿ã‚¹ã‚¯é–¢é€£ãƒ¡ãƒ¢
â”‚   â””â”€â”€ ãã®ä»–å¤šæ•°...
â”œâ”€â”€ plans/                           # å®Ÿè£…è¨ˆç”»æ›¸ï¼ˆé€²è¡Œä¸­ï¼‰
â”œâ”€â”€ fixed-plans/                     # å®Œäº†ã—ãŸè¨ˆç”»æ›¸ï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰
â”œâ”€â”€ agents/                          # ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè¨­å®š
â”œâ”€â”€ hooks/                           # Claudeãƒ•ãƒƒã‚¯è¨­å®š
â””â”€â”€ æ¡ä»¶ä»˜ããƒ­ãƒ³ã‚°ãƒãƒ¼ãƒªãƒ³ã‚°è¨­è¨ˆ/     # ç‰¹å®šæ©Ÿèƒ½ã®è¨­è¨ˆæ›¸
```

---

---

## ğŸ”§ APIå†…éƒ¨æ§‹é€  (`apps/api/src/`)

```
src/
â”œâ”€â”€ routes/               # APIãƒ«ãƒ¼ãƒˆï¼ˆå‰è¿°ï¼‰
â”œâ”€â”€ db/
â”‚   â””â”€â”€ schema/          # DBã‚¹ã‚­ãƒ¼ãƒï¼ˆå‰è¿°ï¼‰
â”œâ”€â”€ middleware/          # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”œâ”€â”€ services/
â”‚   â””â”€â”€ email.ts         # ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆResendï¼‰
â”œâ”€â”€ types/               # APIå‹å®šç¾©
â”œâ”€â”€ utils/               # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â””â”€â”€ lib/                 # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¨­å®š
```

---

---

## ğŸ“‹ Contextãƒ»Hookçµ±åˆæ”¹å–„è¨ˆç”»

### âœ… å®Œäº†ã—ãŸæ”¹å–„ï¼ˆ2025-11-08ï¼‰

#### 1. **Contexté…ç½®ã®çµ±ä¸€** âœ…

- `navigation-context.tsx` ã¨ `team-context.tsx` ã‚’ `apps/web/src/contexts/` ã«ç§»å‹•
- 30ãƒ•ã‚¡ã‚¤ãƒ«ã®importãƒ‘ã‚¹ã‚’ä¿®æ­£
- ç©ºãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª `apps/web/contexts/` ã‚’å‰Šé™¤

#### 2. **æœªä½¿ç”¨Contextã®å‰Šé™¤** âœ…

- `MultiSelectionContext` (Contextç‰ˆ) ã‚’å‰Šé™¤ï¼ˆ356è¡Œï¼‰
- ãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤

#### 3. **Phase 1: useScreenStateã‚·ãƒ³ãƒ—ãƒ«åŒ–** âœ… **å®Œäº†**ï¼ˆ2025-11-08ï¼‰

**è¨ˆç”»æ›¸**: `.claude/fixed-plans/context-refactor-01-useScreenState-simplification.md`

**å¤‰æ›´å†…å®¹**:

- âœ… é¸æŠçŠ¶æ…‹ã‚’ `useScreenState` ã‹ã‚‰åˆ†é›¢
- âœ… å…¨ç”»é¢ï¼ˆmemo/task/boardï¼‰ã§ `useMultiSelection` ã«çµ±ä¸€
- âœ… ãƒ­ãƒ¼ã‚«ãƒ«`selectionMode` stateå‰Šé™¤ï¼ˆç´„40è¡Œå‰Šæ¸›ï¼‰
- âœ… `handleSelectionModeChange`ã‚’ä½¿ç”¨ï¼ˆè‡ªå‹•ã§é¸æŠçŠ¶æ…‹ã‚¯ãƒªã‚¢ï¼‰

**æˆæœ**:

- é¸æŠçŠ¶æ…‹ç®¡ç†ãŒ1ç®‡æ‰€ã«çµ±ä¸€
- ãƒã‚°ä¿®æ­£æ™‚ã«1ç®‡æ‰€ä¿®æ­£ã™ã‚Œã°å…¨ç”»é¢ã«åæ˜ 
- å‹ã‚¨ãƒ©ãƒ¼0ä»¶

#### 4. **Phase 2: useScreenStateã®å®Œå…¨ã‚·ãƒ³ãƒ—ãƒ«åŒ–** âœ… **å®Œäº†**ï¼ˆ2025-11-08ï¼‰

**å¤‰æ›´å†…å®¹**:

- âœ… `useScreenState`ã‹ã‚‰`columnCount`/`effectiveColumnCount`ã‚’å®Œå…¨å‰Šé™¤
- âœ… `checkedItems`/`checkedDeletedItems`ã‚’å®Œå…¨å‰Šé™¤
- âœ… **useScreenStateãŒç´„50è¡Œ â†’ ç´„30è¡Œã«å‰Šæ¸›ï¼ˆ40%å‰Šæ¸›ï¼‰**
- âœ… ä¾å­˜é–¢ä¿‚å‰Šæ¸›ï¼ˆ`useColumnCountStorage`ãŒä¸è¦ã«ï¼‰

**æˆæœ**:

- useScreenStateã¯ã€Œç”»é¢ãƒ¢ãƒ¼ãƒ‰ + ã‚¿ãƒ–ã€ã®ã¿ã‚’ç®¡ç†
- å˜ä¸€è²¬ä»»ã®åŸå‰‡ã«æº–æ‹ 
- åˆè¨ˆç´„85è¡Œå‰Šæ¸›

### ğŸ“Š æ”¹å–„å¾Œã®è²¬ä»»åˆ†é›¢ï¼ˆPhase 1+2å®Œäº†ï¼‰

```
âœ… é¸æŠçŠ¶æ…‹ç®¡ç†
â””â”€ useMultiSelectionï¼ˆå…¨ç”»é¢ã§çµ±ä¸€ï¼‰
   â”œâ”€ selectionModeç®¡ç†
   â”œâ”€ ãƒ¡ãƒ¢é¸æŠçŠ¶æ…‹
   â””â”€ ã‚¿ã‚¹ã‚¯é¸æŠçŠ¶æ…‹

âœ… ç”»é¢çŠ¶æ…‹ç®¡ç†
â””â”€ useScreenStateï¼ˆã‚·ãƒ³ãƒ—ãƒ«åŒ–å®Œäº†ï¼‰
   â”œâ”€ screenModeï¼ˆlist/view/createï¼‰
   â””â”€ activeTab

âœ… è¡¨ç¤ºè¨­å®šç®¡ç†
â””â”€ ViewSettingsContext
   â”œâ”€ ã‚«ãƒ©ãƒ æ•°ï¼ˆmemoColumnCount/taskColumnCount/boardColumnCountï¼‰
   â”œâ”€ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆselectedTagIds/selectedBoardIdsï¼‰
   â””â”€ ã‚½ãƒ¼ãƒˆï¼ˆsortOptionsï¼‰

âœ… ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†
â””â”€ NavigationContext
   â”œâ”€ ç”»é¢ãƒ¢ãƒ¼ãƒ‰ï¼ˆå…¨ä½“ï¼‰
   â””â”€ UIçŠ¶æ…‹
```

### ğŸ“ ä»Šå¾Œã®æ”¹å–„è¨ˆç”»ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**Phase 3: ç”»é¢ãƒ¢ãƒ¼ãƒ‰ç®¡ç†ã®æ•´ç†**ï¼ˆå„ªå…ˆåº¦ï¼šä½ãƒ»è¦è­°è«–ï¼‰

- `NavigationContext` ã¨ã®é‡è¤‡è§£æ¶ˆã‚’æ¤œè¨
- å½¹å‰²ã®æ˜ç¢ºåŒ–

**ç¾æ™‚ç‚¹ã§ã¯ Phase 1+2 ã§ååˆ†ãªæˆæœã‚’é”æˆ**

---

## âœ… ãƒãƒ¼ãƒ å´çŠ¶æ…‹ç®¡ç†ã®æ”¹å–„ï¼ˆPETABOO-44å¯¾å¿œãƒ»2025-12-03ï¼‰

### æ”¹å–„å‰ã®å•é¡Œ

- **æœ¬ç•ªã§ã®ã¿ç™ºç”Ÿã™ã‚‹ãƒã‚°**: ãƒœãƒ¼ãƒ‰è©³ç´°â†’ã‚¿ã‚¹ã‚¯ä¸€è¦§ã«æˆ»ã‚Œãªã„
- **çŠ¶æ…‹ã®ä¸‰é‡ç®¡ç†**: URL / Context / ãƒ­ãƒ¼ã‚«ãƒ«state
- **é¸æŠçŠ¶æ…‹ã‚¯ãƒªã‚¢ãŒ3ç®‡æ‰€ã«åˆ†æ•£**
- **CustomEventã«ã‚ˆã‚‹æš—é»™é€šä¿¡**: `team-tab-change`ãªã©
- **URLã‚¹ã‚­ãƒ¼ãƒ ã®æ··åœ¨**: æ—§å½¢å¼ãƒ»æ–°å½¢å¼ãŒè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«é‡è¤‡

### å®Ÿæ–½ã—ãŸæ”¹å–„

#### Phase 1: URLé€†æµé˜²æ­¢

- `pendingTabRef` ã‚’è¿½åŠ ã—ã€URLæ›´æ–°ä¸­ã®å¤ã„URLã«ã‚ˆã‚‹ä¸Šæ›¸ãã‚’ãƒ–ãƒ­ãƒƒã‚¯
- ãƒ–ãƒ©ã‚¦ã‚¶æˆ»ã‚‹/é€²ã‚€ã¯æ­£å¸¸å‹•ä½œ

#### Phase 2: é¸æŠçŠ¶æ…‹ã‚¯ãƒªã‚¢çµ±ä¸€

- `clearSelections({ memo?: boolean, task?: boolean, all?: boolean })` é–¢æ•°ã«çµ±ä¸€
- 3ç®‡æ‰€ã®åˆ†æ•£ã‚’1é–¢æ•°ã«é›†ç´„

#### Phase 3+4: CustomEventå‰Šæ¸›

- `team-tab-change` CustomEventã‚’å®Œå…¨å‰Šé™¤
- NavigationContextã®`teamActiveTab` state ã‚’å‰Šé™¤
- header.tsxã®`optimisticTeamTab` state ã‚’å‰Šé™¤
- ContextçµŒç”±ã§ã®å³æ™‚åæ˜ ã«çµ±ä¸€

#### Phase 5: URLè§£æãƒ­ã‚¸ãƒƒã‚¯çµ±ä¸€

- `apps/web/src/utils/teamUrlUtils.ts` ã‚’æ–°è¦ä½œæˆ
- `getTabFromParams()`, `getBoardSlugFromParams()` ç­‰ã‚’å…±é€šåŒ–
- `team-detail.tsx` ã¨ `navigation-context.tsx` ã‹ã‚‰é‡è¤‡ã‚³ãƒ¼ãƒ‰å‰Šé™¤

### ç¾åœ¨ã®è¨­è¨ˆ

```
URL (searchParams) â† Single Source of Truth
    â†“ æ´¾ç”Ÿï¼ˆå…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã§è§£æï¼‰
team-detail.tsx (activeTab state)
    â†“ åŒæœŸ
TeamDetailContext (ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤ºç”¨)
    â†“ æ¥½è¦³çš„æ›´æ–°
NavigationContext (optimisticMode)
```

### æ®‹å­˜èª²é¡Œ

- `boardIndex` vs `displayId` ã®æ··åœ¨ï¼ˆãƒœãƒ¼ãƒ‰è©³ç´°å†…ï¼‰- åˆ¥ãƒã‚±ãƒƒãƒˆå¯¾å¿œ

---

## ğŸ”„ æ›´æ–°å±¥æ­´

- **2025-12-03**: PETABOO-44å¯¾å¿œå®Œäº†ï¼ˆURLé€†æµé˜²æ­¢ã€é¸æŠçŠ¶æ…‹ã‚¯ãƒªã‚¢çµ±ä¸€ã€CustomEventå‰Šæ¸›ã€URLè§£æå…±é€šåŒ–ï¼‰
- **2025-11-08**: Phase 1+2å®Œäº†ã‚’åæ˜ ï¼ˆuseScreenStateã‚·ãƒ³ãƒ—ãƒ«åŒ–ã€é¸æŠçŠ¶æ…‹ç®¡ç†çµ±ä¸€ï¼‰
- **2025-11-08**: useMultiSelectionã®å…¨ç”»é¢çµ±ä¸€ä½¿ç”¨ã‚’åæ˜ 
- **2025-11-08**: æ”¹å–„å¾Œã®è²¬ä»»åˆ†é›¢å›³ã‚’è¿½åŠ 
- **2025-11-08**: Contextæ§‹é€ ã®å®Ÿæ…‹èª¿æŸ»ã¨æ”¹å–„æ¡ˆã‚’è¿½åŠ 
- **2025-11-08**: å…¨9ç¨®é¡ã®Contextè©³ç´°æƒ…å ±ã‚’è¿½åŠ ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€ãƒ•ãƒƒã‚¯åã€æä¾›æƒ…å ±ã€ä½¿ç”¨ä¾‹ãªã©ï¼‰
- **2025-11-08**: Contextéšå±¤æ§‹é€ ã¨ViewSettingsContextè©³ç´°ã‚’è¿½åŠ 
- **2025-11-06**: åˆç‰ˆä½œæˆï¼ˆæ©Ÿèƒ½åˆ¥è©³ç´°ç‰ˆï¼‰
