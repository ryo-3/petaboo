# ボード設定モーダル実装Plan

> ⚠️ Codexに実装依頼する際は、以下を厳守すること：

- **既存ファイルを丸ごと再生成させないこと**
  → Codexへの依頼は必ず **差分（patch形式）** で行う
- **日本語コメント・文字列を扱う場合はUTF-8前提で依頼すること**
  → 文字化け防止のため明記する
- **Codexに git add / git commit を実行させないこと**
- **完了した場合ファイルを`.claude/fixed-plans` に移動する**

---

## 目的

チームボード設定モーダルを実装し、以下の機能を提供する：

1. ボード名の編集
2. ボードスラッグの編集
3. ボード削除機能（詳細な確認ダイアログ付き）

**期待成果**：

- `?settings=true` パラメータでボード設定モーダルを表示
- ボード削除時に何が削除され、何が残るかを明確に説明
- シンプルで使いやすいUI

---

## 変更範囲

### 新規作成ファイル

1. **ボード設定モーダルコンポーネント** (新規)
   - パス: 未定（実装時に決定）
   - 内容: ボード設定UI、削除確認ダイアログ

### 修正ファイル

1. **チーム詳細ページ** (要確認)
   - `settings` パラメータの処理
   - モーダルの表示制御

2. **use-team-boards.ts**
   - 既に `useDeleteTeamBoard` が実装済み
   - 追加修正不要（確認のみ）

---

## 実装手順

### Step 1: ボード設定モーダルコンポーネント作成

**新規ファイル**: 適切な場所に配置

- コンポーネント名: `BoardSettingsModal` または類似
- Props:
  ```typescript
  {
    isOpen: boolean;
    onClose: () => void;
    boardId: number;
    boardName: string;
    boardSlug: string;
    teamId: number;
  }
  ```

**含める機能**:

1. ボード名編集フォーム
2. スラッグ編集フォーム（バリデーション付き）
3. 削除ボタン（危険領域）

### Step 2: ボード削除確認ダイアログ

**AlertDialog実装** (モーダル内またはuseConfirm利用):

**確認メッセージ**:

```
ボードを削除しますか？

この操作は取り消せません。以下の内容が削除されます：

【削除されるもの】
• ボード本体
• ボードへのコメント
• メモ・タスクとボードの紐づけ

【削除されないもの】
• メモ本体（メモ一覧から引き続きアクセス可能）
• タスク本体（タスク一覧から引き続きアクセス可能）
• メモ・タスクへのコメント
```

**削除フロー**:

1. 削除ボタンクリック
2. 確認ダイアログ表示
3. 確認後、`useDeleteTeamBoard` を実行
4. 成功後、ボード一覧ページへリダイレクト

### Step 3: チーム詳細ページでの統合

**URLパラメータ処理**:

- `settings=true` の時にモーダルを表示
- モーダルクローズ時に `settings` パラメータを削除

**既存実装の確認が必要**:

- チーム詳細ページがどこにあるか
- URLパラメータをどう扱っているか
- 既存のモーダル実装パターン

---

## 影響範囲・懸念点

### 影響範囲

- チーム詳細ページ（ボードタブ）
- ボード削除後のリダイレクト処理

### 懸念点

1. **スラッグの重複チェック**
   - APIで既にバリデーション済み（400エラー返却）
   - フロント側でエラーハンドリングが必要

2. **削除後のナビゲーション**
   - 削除成功後、どこに遷移するか？
   - 候補: `/team/{customUrl}?tab=board`（ボード一覧）

3. **権限チェック**
   - APIでチームメンバーチェック済み
   - フロント側で追加チェック不要

---

## Codex用ToDoリスト

### Phase 1: コンポーネント作成

- [ ] ボード設定モーダルコンポーネントを作成
  - AlertDialog またはDialog使用
  - ボード名編集フォーム
  - スラッグ編集フォーム
  - 削除ボタン（危険領域スタイル）

### Phase 2: 削除確認実装

- [ ] 削除確認ダイアログ実装
  - 上記の詳細メッセージを使用
  - `useDeleteTeamBoard` hookを利用
  - エラーハンドリング

### Phase 3: 統合

- [ ] チーム詳細ページに統合
  - `settings=true` パラメータで表示
  - モーダルクローズでパラメータ削除
  - 削除成功後のリダイレクト

### Phase 4: テスト

- [ ] 動作確認
  - モーダル表示
  - ボード名編集
  - スラッグ編集（重複エラー含む）
  - 削除フロー

---

## 補足情報

### 既存API

- **ボード更新**: `PUT /teams/{teamId}/boards/{id}`
- **ボード削除**: `DELETE /teams/{teamId}/boards/{id}`

### 既存Hook

- `useUpdateTeamBoard(teamId)` - ボード更新用
- `useDeleteTeamBoard(teamId)` - ボード削除用

### 参考実装

- 既存のAlertDialogパターンを確認
- 既存のモーダル実装パターンを踏襲

---

## 実装優先度

1. **High**: 削除確認ダイアログ（ユーザー保護のため）
2. **Medium**: ボード名編集
3. **Medium**: スラッグ編集
