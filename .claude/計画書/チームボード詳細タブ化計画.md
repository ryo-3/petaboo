# ãƒãƒ¼ãƒ ãƒœãƒ¼ãƒ‰è©³ç´°ã‚¿ãƒ–åŒ–å®Ÿè£…è¨ˆç”»æ›¸

**ä½œæˆæ—¥**: 2025-11-03
**ç›®çš„**: ãƒãƒ¼ãƒ ãƒœãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸ã‚’ã‚¿ãƒ–å½¢å¼ã«ç§»è¡Œã—ã€React Queryã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ´»ç”¨ã—ãŸé«˜é€ŸåŒ–ã‚’å®Ÿç¾

---

## ğŸ“Š ç¾çŠ¶ã®å•é¡Œç‚¹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ

```
ãƒœãƒ¼ãƒ‰è©³ç´° â†’ ãƒ¡ãƒ¢ä¸€è¦§ã¸ã®é·ç§»ãŒé…ã„ï¼ˆé‡ã„ï¼‰
â†“
åŸå› : router.push() ã«ã‚ˆã‚‹å®Œå…¨ãƒšãƒ¼ã‚¸é·ç§»
â†“
React Queryã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚¯ãƒªã‚¢ã•ã‚Œã€ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
```

### URLæ§‹é€ ã®é•ã„

| ãƒšãƒ¼ã‚¸         | ç¾åœ¨ã®URL                   | å½¢å¼                   |
| -------------- | --------------------------- | ---------------------- |
| ãƒ¡ãƒ¢ä¸€è¦§       | `/team/moricrew?tab=memos`  | ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿       |
| ã‚¿ã‚¹ã‚¯ä¸€è¦§     | `/team/moricrew?tab=tasks`  | ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿       |
| ãƒœãƒ¼ãƒ‰ä¸€è¦§     | `/team/moricrew?tab=boards` | ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿       |
| **ãƒœãƒ¼ãƒ‰è©³ç´°** | `/team/moricrew/board/fff`  | **ãƒ‘ã‚¹å½¢å¼ï¼ˆç•°ãªã‚‹ï¼‰** |

**å•é¡Œ**: ãƒœãƒ¼ãƒ‰è©³ç´°ã ã‘ç‹¬ç«‹ãƒšãƒ¼ã‚¸æ‰±ã„ â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒåŠ¹ã‹ãªã„

---

## ğŸ¯ è§£æ±ºç­–ï¼šææ¡ˆBï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢å¼ï¼‰

### æ–°ã—ã„URLæ§‹é€ 

```typescript
// ã™ã¹ã¦ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å½¢å¼ã«çµ±ä¸€
/team/moricrew                       // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
/team/moricrew?tab=memos             // ãƒ¡ãƒ¢ä¸€è¦§
/team/moricrew?tab=tasks             // ã‚¿ã‚¹ã‚¯ä¸€è¦§
/team/moricrew?tab=boards            // ãƒœãƒ¼ãƒ‰ä¸€è¦§
/team/moricrew?tab=board&slug=fff    // âœ¨ ãƒœãƒ¼ãƒ‰è©³ç´°ï¼ˆæ–°ï¼‰
/team/moricrew?tab=team-list         // ãƒãƒ¼ãƒ ä¸€è¦§
/team/moricrew?tab=team-settings     // ãƒãƒ¼ãƒ è¨­å®š
/team/moricrew?tab=search            // æ¤œç´¢
```

### ãƒ¡ãƒªãƒƒãƒˆ

1. âœ… **React Queryã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå®Œå…¨ã«åŠ¹ã** - åŒã˜ãƒšãƒ¼ã‚¸å†…ã§çŠ¶æ…‹ç®¡ç†
2. âœ… **ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã¨çµ±ä¸€** - ã™ã¹ã¦ `?tab=xxx` å½¢å¼
3. âœ… **router.replace() ã§é«˜é€Ÿ** - ãƒšãƒ¼ã‚¸å†ãƒã‚¦ãƒ³ãƒˆãªã—
4. âœ… **URLå…±æœ‰ãƒ»ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯å¯¾å¿œ** - ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚‚å¯èƒ½

### ãƒ‡ãƒ¡ãƒªãƒƒãƒˆï¼ˆè¨±å®¹æ¸ˆã¿ï¼‰

1. âŒ **URLå¤‰æ›´ãŒå¿…è¦** â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã€Œæ—¢å­˜URLè€ƒæ…®ä¸è¦ã€ã®è¨±å¯æ¸ˆã¿
2. âŒ **å€‹äººå´ã¨ã®è¨­è¨ˆã®é•ã„** â†’ ä½¿ã„æ–¹ãŒç•°ãªã‚‹ãŸã‚å•é¡Œãªã—

---

## ğŸ”§ å®Ÿè£…è©³ç´°

### Phase 1: team-detail.tsx ã®æ‹¡å¼µ

#### 1-1. å‹å®šç¾©ã®æ‹¡å¼µ

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/components/features/team/team-detail.tsx`

```typescript
// activeTab ã®å‹ã« "board" ã‚’è¿½åŠ 
const [activeTab, setActiveTab] = useState<
  | "overview"
  | "memos"
  | "tasks"
  | "boards"
  | "board" // âœ¨ è¿½åŠ 
  | "team-list"
  | "team-settings"
  | "search"
>(getTabFromURL());
```

#### 1-2. URLå–å¾—å‡¦ç†ã®æ‹¡å¼µ

```typescript
const getTabFromURL = () => {
  const tab = searchParams.get("tab");

  // æ—§URL(?tab=settings)ã‚’æ–°URL(?tab=team-settings)ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
  if (tab === "settings") {
    return "team-settings";
  }

  if (
    tab === "memos" ||
    tab === "tasks" ||
    tab === "boards" ||
    tab === "board" || // âœ¨ è¿½åŠ 
    tab === "team-list" ||
    tab === "team-settings" ||
    tab === "search"
  ) {
    return tab;
  }
  return "overview";
};

// âœ¨ ãƒœãƒ¼ãƒ‰slugã‚’å–å¾—
const boardSlug = searchParams.get("slug");
```

#### 1-3. handleTabChange() ã®æ‹¡å¼µ

```typescript
const handleTabChange = useCallback(
  (
    tab:
      | "overview"
      | "memos"
      | "tasks"
      | "boards"
      | "board" // âœ¨ è¿½åŠ 
      | "team-list"
      | "team-settings"
      | "search",
    options?: { slug?: string }, // âœ¨ è¿½åŠ 
  ) => {
    setActiveTab(tab);
    setActiveTabContext(tab);

    const params = new URLSearchParams(searchParams.toString());
    if (tab === "overview") {
      params.delete("tab");
    } else {
      params.set("tab", tab);
    }

    // âœ¨ ãƒœãƒ¼ãƒ‰è©³ç´°ã®å ´åˆã¯slugã‚’è¨­å®š
    if (tab === "board" && options?.slug) {
      params.set("slug", options.slug);
    } else {
      params.delete("slug");
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ä¸è¦ãªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šé™¤
    if (tab !== "memos") {
      params.delete("memo");
      setSelectedMemo(null);
      setSelectedDeletedMemo(null);
    }
    if (tab !== "tasks") {
      params.delete("task");
      setSelectedTask(null);
      setSelectedDeletedTask(null);
    }

    const newUrl = params.toString() ? `?${params.toString()}` : "";
    router.replace(`/team/${customUrl}${newUrl}`, { scroll: false });
  },
  [router, customUrl, searchParams, setActiveTabContext],
);
```

#### 1-4. ãƒœãƒ¼ãƒ‰é¸æŠã‚¤ãƒ™ãƒ³ãƒˆã®å¤‰æ›´

**å¤‰æ›´å‰**:

```typescript
{activeTab === "boards" && (
  <div className="h-full">
    <BoardScreen
      onBoardSelect={(board) => {
        router.push(`/team/${customUrl}/board/${board.slug}`);  // âŒ ãƒ•ãƒ«ãƒšãƒ¼ã‚¸é·ç§»
      }}
    />
  </div>
)}
```

**å¤‰æ›´å¾Œ**:

```typescript
{activeTab === "boards" && (
  <div className="h-full">
    <BoardScreen
      onBoardSelect={(board) => {
        handleTabChange("board", { slug: board.slug });  // âœ… ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
      }}
    />
  </div>
)}
```

#### 1-5. ãƒœãƒ¼ãƒ‰è©³ç´°ã‚¿ãƒ–ã®è¿½åŠ 

**è¿½åŠ ç®‡æ‰€**: ãƒœãƒ¼ãƒ‰ä¸€è¦§ã‚¿ãƒ–ã®ç›´å¾Œ

```typescript
{/* ãƒœãƒ¼ãƒ‰ä¸€è¦§ã‚¿ãƒ– */}
{activeTab === "boards" && (
  <div className="h-full">
    <BoardScreen
      onBoardSelect={(board) => {
        handleTabChange("board", { slug: board.slug });
      }}
    />
  </div>
)}

{/* âœ¨ ãƒœãƒ¼ãƒ‰è©³ç´°ã‚¿ãƒ–ï¼ˆæ–°è¦è¿½åŠ ï¼‰ */}
{activeTab === "board" && boardSlug && (
  <div className="h-full">
    <BoardDetailScreen
      slug={boardSlug}
      teamId={team?.id}
      teamMembers={team?.members || []}
      onBack={() => handleTabChange("boards")}
      customUrl={customUrl}
    />
  </div>
)}
```

---

### Phase 2: layout.tsx ã®èª¿æ•´

#### 2-1. isTeamBoardDetailPage ã®åˆ¤å®šå¤‰æ›´

**ãƒ•ã‚¡ã‚¤ãƒ«**: `apps/web/app/team/[customUrl]/layout.tsx`

**å¤‰æ›´å‰**:

```typescript
// ãƒ‘ã‚¹ãƒ™ãƒ¼ã‚¹ã®åˆ¤å®š
const isTeamBoardDetailPage =
  pathname.includes("/team/") && pathname.includes("/board/");
```

**å¤‰æ›´å¾Œ**:

```typescript
// âœ¨ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆ¤å®š
const isTeamBoardDetailPage =
  pathname.startsWith("/team/") &&
  searchParams.get("tab") === "board" &&
  searchParams.get("slug") !== null;
```

#### 2-2. lastBoardUrl â†’ lastBoardSlug ã«å¤‰æ›´

**å¤‰æ›´å‰**:

```typescript
const [lastBoardUrl, setLastBoardUrl] = useState<string | undefined>(undefined);
```

**å¤‰æ›´å¾Œ**:

```typescript
const [lastBoardSlug, setLastBoardSlug] = useState<string | undefined>(
  undefined,
);
```

#### 2-3. URLä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´

**å¤‰æ›´å‰**:

```typescript
useEffect(() => {
  // ãƒãƒ¼ãƒ ãƒœãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸ã®å ´åˆã¯URLã‚’è¨˜æ†¶
  if (isTeamBoardDetailPage) {
    setLastBoardUrl(pathname); // "/team/moricrew/board/fff"
  }
  // ...
}, [isTeamBoardDetailPage, pathname, searchParams, setScreenMode]);
```

**å¤‰æ›´å¾Œ**:

```typescript
useEffect(() => {
  // âœ¨ ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰slugã‚’å–å¾—ã—ã¦ä¿å­˜
  const tab = searchParams.get("tab");
  const slug = searchParams.get("slug");

  if (tab === "board" && slug) {
    setLastBoardSlug(slug); // "fff"
  }

  // URLã‹ã‚‰çµ±ä¸€çš„ã«screenModeã‚’è¨­å®š
  const newScreenMode = getModeFromUrl(pathname, searchParams);
  setScreenMode(newScreenMode);

  // ... æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼å‡¦ç†
}, [pathname, searchParams, setScreenMode]);
```

#### 2-4. handleBoardDetail() ã®å¤‰æ›´

**å¤‰æ›´å‰**:

```typescript
const handleBoardDetail = () => {
  if (isTeamBoardDetailPage) {
    return;
  }

  if (lastBoardUrl) {
    router.push(lastBoardUrl); // âŒ ãƒ•ãƒ«ãƒšãƒ¼ã‚¸é·ç§»
  } else {
    // ãƒœãƒ¼ãƒ‰ä¸€è¦§ãƒšãƒ¼ã‚¸ã«ç§»å‹•
    if (isTeamDetailPage) {
      window.dispatchEvent(
        new CustomEvent("team-mode-change", {
          detail: { mode: "board", pathname },
        }),
      );
    }
  }
};
```

**å¤‰æ›´å¾Œ**:

```typescript
const handleBoardDetail = () => {
  // æ—¢ã«ãƒœãƒ¼ãƒ‰è©³ç´°ã‚¿ãƒ–ã«ã„ã‚‹å ´åˆã¯ä½•ã‚‚ã—ãªã„
  const currentTab = searchParams.get("tab");
  if (currentTab === "board") {
    return;
  }

  // æœ€å¾Œã«è¦‹ã¦ã„ãŸãƒœãƒ¼ãƒ‰ã‚¹ãƒ©ãƒƒã‚°ãŒã‚ã‚‹å ´åˆ
  if (lastBoardSlug) {
    const params = new URLSearchParams(searchParams.toString());
    params.set("tab", "board");
    params.set("slug", lastBoardSlug);
    const newUrl = `?${params.toString()}`;
    router.replace(`/team/${customUrl}${newUrl}`, { scroll: false }); // âœ… é«˜é€Ÿåˆ‡ã‚Šæ›¿ãˆ
  } else {
    // ãƒœãƒ¼ãƒ‰ä¸€è¦§ã‚¿ãƒ–ã«ç§»å‹•
    if (isTeamDetailPage) {
      window.dispatchEvent(
        new CustomEvent("team-mode-change", {
          detail: { mode: "board", pathname },
        }),
      );
    }
  }
};
```

#### 2-5. handleBackToBoardList() ã®å¤‰æ›´

**å¤‰æ›´å‰**:

```typescript
const handleBackToBoardList = () => {
  if (isTeamBoardDetailPage) {
    setCurrentBoardName(undefined);
    const teamCustomUrl = pathname.split("/")[2];
    router.push(`/team/${teamCustomUrl}?tab=boards`); // âŒ router.push()
  }
};
```

**å¤‰æ›´å¾Œ**:

```typescript
const handleBackToBoardList = () => {
  if (isTeamBoardDetailPage) {
    setCurrentBoardName(undefined);
    const params = new URLSearchParams(searchParams.toString());
    params.set("tab", "boards");
    params.delete("slug");
    router.replace(`/team/${customUrl}?${params.toString()}`, {
      scroll: false,
    }); // âœ… router.replace()
  }
};
```

#### 2-6. Sidebar ã¸ã® props èª¿æ•´

**å¤‰æ›´ç®‡æ‰€**: 2ç®‡æ‰€ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ»ãƒ¢ãƒã‚¤ãƒ«ï¼‰

**å¤‰æ›´å‰**:

```typescript
<Sidebar
  currentBoardName={
    currentBoardName || (lastBoardUrl ? "æœ€å¾Œã®ãƒœãƒ¼ãƒ‰" : undefined)
  }
  // ...
/>
```

**å¤‰æ›´å¾Œ**:

```typescript
<Sidebar
  currentBoardName={
    currentBoardName || (lastBoardSlug ? "æœ€å¾Œã®ãƒœãƒ¼ãƒ‰" : undefined)
  }
  // ...
/>
```

---

### Phase 3: BoardDetailScreen ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å¯¾å¿œ

#### å¿…è¦ãªèª¿æ•´

æ—¢å­˜ã® `/team/[customUrl]/board/[slug]/page.tsx` ã§ä½¿ã£ã¦ã„ã‚‹ `BoardDetailScreen` ã‚’ã€`team-detail.tsx` ã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹ã‚ˆã†ã«èª¿æ•´ã€‚

**å¿…è¦ãª props**:

```typescript
interface BoardDetailScreenProps {
  slug: string; // ãƒœãƒ¼ãƒ‰ã®ã‚¹ãƒ©ãƒƒã‚°
  teamId?: number; // ãƒãƒ¼ãƒ ID
  teamMembers?: TeamMember[]; // ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
  onBack?: () => void; // æˆ»ã‚‹ãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  customUrl?: string; // ãƒãƒ¼ãƒ ã®ã‚«ã‚¹ã‚¿ãƒ URL
}
```

**ãƒœãƒ¼ãƒ‰åã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ã®ç¶­æŒ**:

ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã€Œæœ€å¾Œã®ãƒœãƒ¼ãƒ‰åã€ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã€ãƒœãƒ¼ãƒ‰è©³ç´°ç”»é¢ã§ãƒœãƒ¼ãƒ‰åå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```typescript
// BoardDetailScreen ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…
useEffect(() => {
  if (boardData) {
    window.dispatchEvent(
      new CustomEvent("team-board-name-change", {
        detail: { boardName: boardData.name },
      }),
    );
  }
}, [boardData]);
```

---

### Phase 4: æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤

#### å‰Šé™¤ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

```
/apps/web/app/team/[customUrl]/board/[slug]/page.tsx
```

**ç†ç”±**: ãƒœãƒ¼ãƒ‰è©³ç´°ãŒ `team-detail.tsx` å†…ã®ã‚¿ãƒ–ã¨ã—ã¦å®Ÿè£…ã•ã‚Œã‚‹ãŸã‚ã€ç‹¬ç«‹ãƒšãƒ¼ã‚¸ã¯ä¸è¦ã€‚

**å‰Šé™¤å‰ã®ç¢ºèªäº‹é …**:

- [ ] `BoardDetailScreen` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ `team-detail.tsx` ã‹ã‚‰æ­£å¸¸ã«å‘¼ã³å‡ºã›ã‚‹
- [ ] ãƒœãƒ¼ãƒ‰åã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹
- [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒœãƒ¼ãƒ‰åè¡¨ç¤ºãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹

---

## ğŸ§ª å‹•ä½œç¢ºèªé …ç›®

### åŸºæœ¬å‹•ä½œ

- [ ] **ãƒœãƒ¼ãƒ‰ä¸€è¦§ã‹ã‚‰ãƒœãƒ¼ãƒ‰è©³ç´°ã¸é·ç§»**
  - URL: `/team/moricrew?tab=boards` â†’ `/team/moricrew?tab=board&slug=fff`
  - æœŸå¾…: é«˜é€Ÿã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼ˆãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ãªã—ï¼‰

- [ ] **ãƒœãƒ¼ãƒ‰è©³ç´°ã‹ã‚‰ãƒ¡ãƒ¢ä¸€è¦§ã¸é·ç§»**
  - URL: `/team/moricrew?tab=board&slug=fff` â†’ `/team/moricrew?tab=memos`
  - æœŸå¾…: çˆ†é€Ÿã§åˆ‡ã‚Šæ›¿ã‚ã‚‹ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¡¨ç¤ºï¼‰

- [ ] **ãƒ¡ãƒ¢ä¸€è¦§ã‹ã‚‰ãƒœãƒ¼ãƒ‰è©³ç´°ã¸æˆ»ã‚‹**
  - ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ã€Œãƒœãƒ¼ãƒ‰è©³ç´°ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  - æœŸå¾…: æœ€å¾Œã«è¦‹ã¦ã„ãŸãƒœãƒ¼ãƒ‰ã«å³åº§ã«æˆ»ã‚‹

### ã‚µã‚¤ãƒ‰ãƒãƒ¼è¡¨ç¤º

- [ ] **ãƒœãƒ¼ãƒ‰åã®è¡¨ç¤º**
  - ãƒœãƒ¼ãƒ‰è©³ç´°ã‚’é–‹ã„ãŸå¾Œã€ãƒ¡ãƒ¢ä¸€è¦§ã«ç§»å‹•
  - æœŸå¾…: ã‚µã‚¤ãƒ‰ãƒãƒ¼ã«ã€Œæœ€å¾Œã®ãƒœãƒ¼ãƒ‰ã€ã¾ãŸã¯å®Ÿéš›ã®ãƒœãƒ¼ãƒ‰åãŒè¡¨ç¤ºã•ã‚Œã‚‹

- [ ] **ãƒœãƒ¼ãƒ‰è©³ç´°ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯**
  - ã‚µã‚¤ãƒ‰ãƒãƒ¼ã®ãƒœãƒ¼ãƒ‰è©³ç´°ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  - æœŸå¾…: ä¿å­˜ã•ã‚ŒãŸãƒœãƒ¼ãƒ‰slugã§ `/team/moricrew?tab=board&slug=fff` ã«é·ç§»

### URLæ©Ÿèƒ½

- [ ] **URLå…±æœ‰**
  - `/team/moricrew?tab=board&slug=fff` ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
  - æœŸå¾…: æ­£å¸¸ã«ãƒœãƒ¼ãƒ‰è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã‚‹

- [ ] **ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯**
  - ãƒœãƒ¼ãƒ‰è©³ç´°ãƒšãƒ¼ã‚¸ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ã¦å†åº¦é–‹ã
  - æœŸå¾…: æ­£å¸¸ã«ãƒœãƒ¼ãƒ‰è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã‚‹

- [ ] **ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹/é€²ã‚€**
  - ãƒœãƒ¼ãƒ‰ä¸€è¦§ â†’ ãƒœãƒ¼ãƒ‰è©³ç´° â†’ ãƒ¡ãƒ¢ä¸€è¦§ã¨ç§»å‹•å¾Œã€ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™
  - æœŸå¾…: æ­£å¸¸ã«å‰ã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- [ ] **React Queryã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ç¢ºèª**
  - ãƒ–ãƒ©ã‚¦ã‚¶ã®DevTools > Networkã‚¿ãƒ–ã‚’é–‹ã
  - ãƒœãƒ¼ãƒ‰è©³ç´° â†’ ãƒ¡ãƒ¢ä¸€è¦§ â†’ ãƒœãƒ¼ãƒ‰è©³ç´°ã¨ç§»å‹•
  - æœŸå¾…: 2å›ç›®ã®ãƒœãƒ¼ãƒ‰è©³ç´°è¡¨ç¤ºæ™‚ã«APIãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç™ºç”Ÿã—ãªã„ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—ï¼‰

- [ ] **ãƒšãƒ¼ã‚¸å†ãƒã‚¦ãƒ³ãƒˆã®ç¢ºèª**
  - React DevTools ã§ component tree ã‚’ç›£è¦–
  - ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ™‚
  - æœŸå¾…: ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå…¨ä½“ãŒå†ãƒã‚¦ãƒ³ãƒˆã•ã‚Œãªã„ï¼ˆçŠ¶æ…‹ãŒç¶­æŒã•ã‚Œã‚‹ï¼‰

---

## ğŸ“ å®Ÿè£…ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### Phase 1: team-detail.tsx

- [ ] `activeTab` ã®å‹ã« `"board"` ã‚’è¿½åŠ 
- [ ] `getTabFromURL()` ã« `"board"` ã‚’è¿½åŠ 
- [ ] `boardSlug = searchParams.get("slug")` ã‚’è¿½åŠ 
- [ ] `handleTabChange()` ã‚’æ‹¡å¼µï¼ˆ`options?: { slug?: string }` è¿½åŠ ï¼‰
- [ ] `handleTabChange()` å†…ã§slugå‡¦ç†ã‚’å®Ÿè£…
- [ ] ãƒœãƒ¼ãƒ‰ä¸€è¦§ã® `onBoardSelect` ã‚’ `handleTabChange()` ã«å¤‰æ›´
- [ ] ãƒœãƒ¼ãƒ‰è©³ç´°ã‚¿ãƒ–ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¿½åŠ 

### Phase 2: layout.tsx

- [ ] `isTeamBoardDetailPage` ã®åˆ¤å®šã‚’ã‚¯ã‚¨ãƒªãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
- [ ] `lastBoardUrl` â†’ `lastBoardSlug` ã«å¤‰æ›´
- [ ] URLä¿å­˜ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰æ›´ï¼ˆ`useEffect` å†…ï¼‰
- [ ] `handleBoardDetail()` ã‚’ `router.replace()` ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
- [ ] `handleBackToBoardList()` ã‚’ `router.replace()` ãƒ™ãƒ¼ã‚¹ã«å¤‰æ›´
- [ ] Sidebar ã¸ã® `currentBoardName` ã‚’èª¿æ•´ï¼ˆ2ç®‡æ‰€ï¼‰

### Phase 3: BoardDetailScreen

- [ ] props ã®ç¢ºèªãƒ»èª¿æ•´
- [ ] ãƒœãƒ¼ãƒ‰åã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡ã®ç¢ºèª
- [ ] `onBack` ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®å‹•ä½œç¢ºèª

### Phase 4: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—

- [ ] `/app/team/[customUrl]/board/[slug]/page.tsx` ã‚’å‰Šé™¤
- [ ] TypeScriptã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª
- [ ] Lintã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

### Phase 5: ãƒ†ã‚¹ãƒˆ

- [ ] åŸºæœ¬å‹•ä½œã®ç¢ºèªï¼ˆä¸Šè¨˜ã®å‹•ä½œç¢ºèªé …ç›®ï¼‰
- [ ] ã‚µã‚¤ãƒ‰ãƒãƒ¼è¡¨ç¤ºã®ç¢ºèª
- [ ] URLæ©Ÿèƒ½ã®ç¢ºèª
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ç¢ºèª

---

## âš ï¸ æ³¨æ„äº‹é …

### å€‹äººå´ã¯å¤‰æ›´ã—ãªã„

```
å€‹äººå´ã®ãƒœãƒ¼ãƒ‰è©³ç´°: /boards/7xl89n  â† ã“ã®ã¾ã¾ç¶­æŒï¼ˆå¤‰æ›´ãªã—ï¼‰
```

å€‹äººå´ã¯ç‹¬ç«‹ãƒšãƒ¼ã‚¸ã¨ã—ã¦æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã‚‹ãŸã‚ã€å¤‰æ›´ä¸è¦ã€‚

### æ—¢å­˜ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒ»å…±æœ‰ãƒªãƒ³ã‚¯

```
æ—§URL: /team/moricrew/board/fff  â†’ å‹•ä½œã—ãªããªã‚‹ï¼ˆ404ï¼‰
```

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¨±å¯æ¸ˆã¿ã€‚ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå®Ÿè£…ã¯è¡Œã‚ãªã„ã€‚

### TypeScriptå‹ã®æ•´åˆæ€§

`activeTab` ã®å‹ã€`handleTabChange()` ã®å¼•æ•°å‹ã€`getTabFromURL()` ã®æˆ»ã‚Šå€¤å‹ã‚’ã™ã¹ã¦çµ±ä¸€ã™ã‚‹ã“ã¨ã€‚

---

## ğŸš€ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„

```
ã€ç¾åœ¨ã€‘
ãƒœãƒ¼ãƒ‰è©³ç´° â†’ ãƒ¡ãƒ¢ä¸€è¦§: 2-3ç§’ï¼ˆãƒ•ãƒ«ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰

ã€å¤‰æ›´å¾Œã€‘
ãƒœãƒ¼ãƒ‰è©³ç´° â†’ ãƒ¡ãƒ¢ä¸€è¦§: 0.1-0.2ç§’ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰è¡¨ç¤ºï¼‰

ç´„10-30å€ã®é«˜é€ŸåŒ– âš¡
```

### è¨­è¨ˆã®ä¸€è²«æ€§

```
ã™ã¹ã¦ã®ãƒãƒ¼ãƒ æ©Ÿèƒ½ãŒçµ±ä¸€ã•ã‚ŒãŸã‚¿ãƒ–å½¢å¼ã«ãªã‚‹
â†’ ã‚³ãƒ¼ãƒ‰ã®ä¿å®ˆæ€§å‘ä¸Š
â†’ æ–°æ©Ÿèƒ½è¿½åŠ æ™‚ã®å®Ÿè£…ãŒå®¹æ˜“
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Š

```
- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãŒé«˜é€Ÿã§ã‚¹ãƒˆãƒ¬ã‚¹ãƒ•ãƒªãƒ¼
- URLå…±æœ‰ãƒ»ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚‚å•é¡Œãªãå‹•ä½œ
- ãƒ–ãƒ©ã‚¦ã‚¶ã®æˆ»ã‚‹/é€²ã‚€ã‚‚æ­£å¸¸å‹•ä½œ
```

---

## ğŸ“š å‚è€ƒè³‡æ–™

### React Query ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š

ç¾åœ¨ã®è¨­å®šï¼ˆ`apps/web/src/lib/query-client.tsx`ï¼‰:

```typescript
queries: {
  staleTime: 30 * 60 * 1000,       // 30åˆ†é–“ã¯æ–°é®®ãªãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦æ‰±ã†
  cacheTime: 30 * 60 * 1000,       // 30åˆ†é–“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä¿æŒ
  refetchOnWindowFocus: false,     // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®å†å–å¾—ã‚’ç„¡åŠ¹åŒ–
  refetchOnMount: false,           // ãƒã‚¦ãƒ³ãƒˆæ™‚ã®å†å–å¾—ã‚’ç„¡åŠ¹åŒ–
  refetchOnReconnect: true,        // å†æ¥ç¶šæ™‚ã®å†å–å¾—
}
```

### Next.js Router

- `router.push()`: æ–°ã—ã„ãƒšãƒ¼ã‚¸ã¸ã®é·ç§»ï¼ˆå±¥æ­´ã«è¿½åŠ ï¼‰
- `router.replace()`: ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã‚’ç½®ãæ›ãˆï¼ˆå±¥æ­´ã«è¿½åŠ ã—ãªã„ï¼‰

ã‚¿ãƒ–å½¢å¼ã§ã¯ `router.replace()` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€åŒã˜ãƒšãƒ¼ã‚¸å†…ã§ã®çŠ¶æ…‹å¤‰æ›´ã¨ã—ã¦æ‰±ã‚ã‚Œã€React Queryã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒç¶­æŒã•ã‚Œã‚‹ã€‚

---

**è¨ˆç”»æ›¸ä½œæˆæ—¥**: 2025-11-03
**ä½œæˆè€…**: Claude
**æ‰¿èªè€…**: ryosuke
