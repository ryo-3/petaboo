# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¾çŠ¶åˆ†æ

## ä½œæˆæ—¥: 2024-12-09

---

## ğŸ“Š æ•°å€¤ã‚µãƒãƒªãƒ¼

| é …ç›®              | ç¾çŠ¶    | ã‚´ãƒ¼ãƒ«   |
| ----------------- | ------- | -------- |
| invalidateQueries | 163ç®‡æ‰€ | 10ä»¥ä¸‹   |
| refetchQueries    | 33ç®‡æ‰€  | 0        |
| setQueryData      | 58ç®‡æ‰€  | å¢—åŠ äºˆå®š |

---

## ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«åˆ¥ invalidateQueries æ•°

| ãƒ•ã‚¡ã‚¤ãƒ«                       | æ•°  | å„ªå…ˆåº¦ |
| ------------------------------ | --- | ------ |
| use-tasks.ts                   | 17  | ğŸ”´ é«˜  |
| use-unified-item-operations.ts | 16  | ğŸ”´ é«˜  |
| use-boards.ts                  | 15  | ğŸ”´ é«˜  |
| use-memos.ts                   | 14  | ğŸ”´ é«˜  |
| use-team-comments.ts           | 9   | ğŸŸ¡ ä¸­  |
| use-unified-restoration.ts     | 8   | ğŸŸ¡ ä¸­  |
| use-team-tasks.ts              | 7   | ğŸŸ¡ ä¸­  |
| use-tags.ts                    | 7   | ğŸŸ¡ ä¸­  |
| use-team-memos.ts              | 6   | ğŸŸ¡ ä¸­  |
| use-simple-memo-save.ts        | 6   | ğŸŸ¡ ä¸­  |
| use-simple-item-save.ts        | 6   | ğŸŸ¡ ä¸­  |
| use-team-tags.ts               | 5   | ğŸŸ¢ ä½  |
| use-team-boards.ts             | 5   | ğŸŸ¢ ä½  |
| use-taggings.ts                | 5   | ğŸŸ¢ ä½  |
| ãã®ä»–                         | 37  | ğŸŸ¢ ä½  |

---

## ğŸ”‘ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼ä¸€è¦§

### ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆå€‹äººï¼‰

| ã‚­ãƒ¼                | ä½¿ç”¨æ•° | ç”¨é€”                              |
| ------------------- | ------ | --------------------------------- |
| `["tasks"]`         | 9      | ã‚¿ã‚¹ã‚¯ä¸€è¦§                        |
| `["memos"]`         | 9      | ãƒ¡ãƒ¢ä¸€è¦§                          |
| `["boards"]`        | 42     | ãƒœãƒ¼ãƒ‰é–¢é€£ï¼ˆä¸€è¦§ã€è©³ç´°ã€itemsç­‰ï¼‰ |
| `["deleted-tasks"]` | 6      | å‰Šé™¤æ¸ˆã¿ã‚¿ã‚¹ã‚¯                    |
| `["deletedMemos"]`  | 6      | å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢                      |

### ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼ˆãƒãƒ¼ãƒ ï¼‰

| ã‚­ãƒ¼                             | ä½¿ç”¨æ•° | ç”¨é€”                 |
| -------------------------------- | ------ | -------------------- |
| `["team-tasks", teamId]`         | 11     | ãƒãƒ¼ãƒ ã‚¿ã‚¹ã‚¯ä¸€è¦§     |
| `["team-memos", teamId]`         | 11     | ãƒãƒ¼ãƒ ãƒ¡ãƒ¢ä¸€è¦§       |
| `["team-boards", teamId, ...]`   | 31     | ãƒãƒ¼ãƒ ãƒœãƒ¼ãƒ‰é–¢é€£     |
| `["team-deleted-tasks", teamId]` | 8      | ãƒãƒ¼ãƒ å‰Šé™¤æ¸ˆã¿ã‚¿ã‚¹ã‚¯ |
| `["team-deleted-memos", teamId]` | 6      | ãƒãƒ¼ãƒ å‰Šé™¤æ¸ˆã¿ãƒ¡ãƒ¢   |

### ã‚¿ã‚°ãƒ»ã‚«ãƒ†ã‚´ãƒª

| ã‚­ãƒ¼                        | ä½¿ç”¨æ•° | ç”¨é€”               |
| --------------------------- | ------ | ------------------ |
| `["tags"]`                  | 4      | å€‹äººã‚¿ã‚°           |
| `["team-tags", teamId]`     | 4      | ãƒãƒ¼ãƒ ã‚¿ã‚°         |
| `["taggings"]`              | 18     | ã‚¿ã‚°ä»˜ã‘æƒ…å ±       |
| `["team-taggings", teamId]` | 14     | ãƒãƒ¼ãƒ ã‚¿ã‚°ä»˜ã‘æƒ…å ± |
| `["categories"]`            | 4      | ã‚«ãƒ†ã‚´ãƒª           |
| `["boardCategories"]`       | 5      | ãƒœãƒ¼ãƒ‰ã‚«ãƒ†ã‚´ãƒª     |

### ãƒœãƒ¼ãƒ‰é–¢é€£

| ã‚­ãƒ¼                                            | ä½¿ç”¨æ•° | ç”¨é€”                           |
| ----------------------------------------------- | ------ | ------------------------------ |
| `["boards", boardId, "items"]`                  | -      | ãƒœãƒ¼ãƒ‰å†…ã‚¢ã‚¤ãƒ†ãƒ                |
| `["board-deleted-items", boardId]`              | 7      | ãƒœãƒ¼ãƒ‰å†…å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ        |
| `["team-board-deleted-items", teamId, boardId]` | 4      | ãƒãƒ¼ãƒ ãƒœãƒ¼ãƒ‰å†…å‰Šé™¤æ¸ˆã¿ã‚¢ã‚¤ãƒ†ãƒ  |
| `["item-boards"]`                               | 7      | ã‚¢ã‚¤ãƒ†ãƒ ãŒå±ã™ã‚‹ãƒœãƒ¼ãƒ‰         |
| `["team-item-boards", teamId]`                  | 2      | ãƒãƒ¼ãƒ ã‚¢ã‚¤ãƒ†ãƒ ãŒå±ã™ã‚‹ãƒœãƒ¼ãƒ‰   |

### ã‚³ãƒ¡ãƒ³ãƒˆ

| ã‚­ãƒ¼                                                     | ä½¿ç”¨æ•° | ç”¨é€”                     |
| -------------------------------------------------------- | ------ | ------------------------ |
| `["team-comments", teamId, targetType, targetDisplayId]` | 3      | ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§             |
| `["board-item-comments", teamId, boardId]`               | 4      | ãƒœãƒ¼ãƒ‰ã‚¢ã‚¤ãƒ†ãƒ ã®ã‚³ãƒ¡ãƒ³ãƒˆ |
| `["team-all-board-comments", teamId]`                    | 4      | å…¨ãƒœãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆ         |

### ãã®ä»–

| ã‚­ãƒ¼                | ä½¿ç”¨æ•° | ç”¨é€”         |
| ------------------- | ------ | ------------ |
| `["notifications"]` | 3      | é€šçŸ¥         |
| `["teams"]`         | 5      | ãƒãƒ¼ãƒ ä¸€è¦§   |
| `["teamStats"]`     | 2      | ãƒãƒ¼ãƒ çµ±è¨ˆ   |
| `["user-info"]`     | 3      | ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± |
| `["attachments"]`   | 2      | æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ« |

---

## ğŸ”„ æ“ä½œã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ã®é–¢ä¿‚

### ã‚¿ã‚¹ã‚¯æ“ä½œ

| æ“ä½œ           | æ›´æ–°ã™ã¹ãã‚­ãƒ£ãƒƒã‚·ãƒ¥                                             |
| -------------- | ---------------------------------------------------------------- |
| ã‚¿ã‚¹ã‚¯ä½œæˆ     | `["tasks"]`, `["boards", boardId, "items"]`(ç´ã¥ã‘æ™‚)            |
| ã‚¿ã‚¹ã‚¯æ›´æ–°     | `["tasks"]`, `["boards", boardId, "items"]`(ç´ã¥ã‘æ™‚)            |
| ã‚¿ã‚¹ã‚¯å‰Šé™¤     | `["tasks"]`, `["deleted-tasks"]`, `["boards", boardId, "items"]` |
| ã‚¿ã‚¹ã‚¯å¾©å…ƒ     | `["deleted-tasks"]`, `["tasks"]`, `["boards", boardId, "items"]` |
| ã‚¿ã‚¹ã‚¯å®Œå…¨å‰Šé™¤ | `["deleted-tasks"]`                                              |

### ãƒ¡ãƒ¢æ“ä½œ

| æ“ä½œ         | æ›´æ–°ã™ã¹ãã‚­ãƒ£ãƒƒã‚·ãƒ¥                                            |
| ------------ | --------------------------------------------------------------- |
| ãƒ¡ãƒ¢ä½œæˆ     | `["memos"]`, `["boards", boardId, "items"]`(ç´ã¥ã‘æ™‚)           |
| ãƒ¡ãƒ¢æ›´æ–°     | `["memos"]`, `["boards", boardId, "items"]`(ç´ã¥ã‘æ™‚)           |
| ãƒ¡ãƒ¢å‰Šé™¤     | `["memos"]`, `["deletedMemos"]`, `["boards", boardId, "items"]` |
| ãƒ¡ãƒ¢å¾©å…ƒ     | `["deletedMemos"]`, `["memos"]`, `["boards", boardId, "items"]` |
| ãƒ¡ãƒ¢å®Œå…¨å‰Šé™¤ | `["deletedMemos"]`                                              |

### ãƒœãƒ¼ãƒ‰æ“ä½œ

| æ“ä½œ         | æ›´æ–°ã™ã¹ãã‚­ãƒ£ãƒƒã‚·ãƒ¥                            |
| ------------ | ----------------------------------------------- |
| ãƒœãƒ¼ãƒ‰ä½œæˆ   | `["boards", "normal"]`                          |
| ãƒœãƒ¼ãƒ‰æ›´æ–°   | `["boards", "normal"]`, `["boards", boardId]`   |
| ãƒœãƒ¼ãƒ‰å‰Šé™¤   | `["boards", "normal"]`, `["boards", "deleted"]` |
| ãƒœãƒ¼ãƒ‰å¾©å…ƒ   | `["boards", "deleted"]`, `["boards", "normal"]` |
| ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ  | `["boards", boardId, "items"]`                  |
| ã‚¢ã‚¤ãƒ†ãƒ å‰Šé™¤ | `["boards", boardId, "items"]`                  |

### ã‚¿ã‚°æ“ä½œ

| æ“ä½œ     | æ›´æ–°ã™ã¹ãã‚­ãƒ£ãƒƒã‚·ãƒ¥               |
| -------- | ---------------------------------- |
| ã‚¿ã‚°ä½œæˆ | `["tags"]`                         |
| ã‚¿ã‚°æ›´æ–° | `["tags"]`                         |
| ã‚¿ã‚°å‰Šé™¤ | `["tags"]`                         |
| ã‚¿ã‚°ä»˜ã‘ | `["taggings"]` or è©²å½“ã‚¢ã‚¤ãƒ†ãƒ ã®ã¿ |

---

## ğŸ¯ å…±é€šåŒ–ã§ãã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ä¸€è¦§ã¸ã®è¿½åŠ 

```typescript
// ä½œæˆæ™‚
setQueryData([ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£], (old) => [...old, newItem]);
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ä¸€è¦§ã®æ›´æ–°

```typescript
// æ›´æ–°æ™‚
setQueryData([ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£], (old) =>
  old.map((item) => (item.id === id ? updatedItem : item)),
);
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ä¸€è¦§ã‹ã‚‰ã®å‰Šé™¤

```typescript
// å‰Šé™¤æ™‚
setQueryData([ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£], (old) => old.filter((item) => item.id !== id));
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³4: ä¸€è¦§é–“ã®ç§»å‹•

```typescript
// å‰Šé™¤ãƒ»å¾©å…ƒæ™‚
setQueryData([å…ƒã®ä¸€è¦§], (old) => old.filter((item) => item.id !== id));
setQueryData([å…ˆã®ä¸€è¦§], (old) => [...old, item]);
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³5: ãƒœãƒ¼ãƒ‰é€£æº

```typescript
// ãƒœãƒ¼ãƒ‰ã«ç´ã¥ã„ã¦ã„ã‚‹å ´åˆ
if (item.boardId) {
  setQueryData(["boards", item.boardId, "items"], ...)
}
```

---

## ğŸ“‹ æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

1. **å€‹äººãƒ¢ãƒ¼ãƒ‰ã®ä¿å­˜å‡¦ç†ã‚’æ´—ã„å‡ºã™**
   - use-tasks.ts, use-memos.ts, use-boards.ts ã® CRUD å‡¦ç†

2. **å…±é€šä¿å­˜ãƒ•ãƒƒã‚¯ã‚’è¨­è¨ˆ**
   - ä¸Šè¨˜ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’çµ±ä¸€çš„ã«å‡¦ç†

3. **Step 1 Planä½œæˆ**
   - å€‹äººãƒ¢ãƒ¼ãƒ‰ã® invalidate/refetch å‰Šé™¤
   - setQueryData ã«çµ±ä¸€
