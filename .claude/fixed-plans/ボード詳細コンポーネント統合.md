# ボード詳細コンポーネント統合Plan

> ⚠️ Codexに実装依頼する際は、以下を厳守すること：
>
> - **既存ファイルを丸ごと再生成させないこと** → Codexへの依頼は必ず **差分（patch形式）** で行う
> - **日本語コメント・文字列を扱う場合はUTF-8前提で依頼すること** → 文字化け防止のため明記する
> - **Codexに git add / git commit を実行させないこと**
> - **完了した場合ファイルを`.claude/fixed-plans` に移動する**

## 目的

個人用とチーム用で分離している2つのボード詳細コンポーネントを1つに統合し、保守性を向上させる。

## 現状の問題点

### コンポーネントの重複

- **個人用**: `apps/web/components/screens/board-detail-screen.tsx`
- **チーム用**: `apps/web/components/screens/board-detail-screen-3panel.tsx`

### 発生している問題

1. **メンテナンスコストの増大**
   - 同じ機能を2箇所に実装する必要がある
   - バグ修正も2箇所で必要
   - 今回のFABボタン追加でも両方に実装が必要だった

2. **コードの不整合リスク**
   - 片方だけ修正して、もう片方を忘れる可能性
   - 機能差異が生まれやすい
   - デバッグが困難

3. **コード量の増加**
   - ほぼ同じロジックが2つ存在
   - 差分管理が複雑

## 統合方針

### アプローチ

`board-detail-screen-3panel.tsx`をベースに、個人・チーム両用のコンポーネントに統合する。

### 理由

- チーム用の方が新しく、機能も豊富
- 3パネルレイアウトは個人でも使える
- モバイル対応も含まれている

## 実装手順

### 1. 差分分析

- [ ] `board-detail-screen.tsx`と`board-detail-screen-3panel.tsx`の差分を詳細に調査
- [ ] 個人用にしかない機能を特定
- [ ] チーム用にしかない機能を特定

### 2. 統合コンポーネント作成

- [ ] `board-detail-screen-3panel.tsx`に個人用の機能を追加
- [ ] `teamMode`フラグで動作を適切に分岐
- [ ] 個人用の特殊な初期化処理を`teamMode === false`時に実行

### 3. 呼び出し元の修正

- [ ] 個人用ボード詳細ページ（`apps/web/app/boards/[slug]/page.tsx`）を修正
- [ ] `board-detail-screen.tsx`の代わりに`board-detail-screen-3panel.tsx`を使用

### 4. テスト

- [ ] 個人のボード詳細でメモ・タスク表示が正常に動作することを確認
- [ ] チームのボード詳細で既存機能が壊れていないことを確認
- [ ] モバイル・PC両方で動作確認
- [ ] FABボタンが正しく動作することを確認

### 5. クリーンアップ

- [ ] `board-detail-screen.tsx`を削除
- [ ] `board-detail-screen-3panel.tsx`を`board-detail-screen.tsx`にリネーム（オプション）
- [ ] 不要なimportや型定義を削除

## 影響範囲

### 修正が必要なファイル

- `apps/web/components/screens/board-detail-screen-3panel.tsx` - 統合先
- `apps/web/components/screens/board-detail-screen.tsx` - 削除対象
- `apps/web/app/boards/[slug]/page.tsx` - 呼び出し元
- その他、board-detail-screenをimportしているファイル

### テスト対象

- 個人のボード詳細（PC・モバイル）
- チームのボード詳細（PC・モバイル）
- メモ・タスクの新規作成
- メモ・タスクの表示・編集
- FABボタンの動作

## 懸念点

### リスク

1. **両方のコンポーネントの動作が微妙に異なる可能性**
   - 詳細な差分分析が必要
   - 予期しない副作用が発生する可能性

2. **大規模な変更**
   - 影響範囲が広い
   - 十分なテストが必要

3. **既存機能への影響**
   - 回帰テストが重要
   - 段階的な移行が望ましい

### 対策

- 詳細な差分分析を実施
- ステージング環境で十分にテスト
- 必要に応じてフィーチャーフラグで段階的移行

## 優先度

**中** - すぐに必要ではないが、保守性向上のために重要

## 備考

- 今回のFABボタン追加で、2つのコンポーネントが存在することの問題が顕在化した
- 将来的な機能追加のためにも、早めの統合が望ましい
- 大きな機能追加の前に実施することを推奨
