# æœªä¿å­˜å¤‰æ›´ãƒ¢ãƒ¼ãƒ€ãƒ«ãƒ­ã‚¸ãƒƒã‚¯å…±é€šåŒ–ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° Plan

> âš ï¸ Codexã«å®Ÿè£…ä¾é ¼ã™ã‚‹éš›ã¯ã€ä»¥ä¸‹ã‚’å³å®ˆã™ã‚‹ã“ã¨ï¼š
>
> - **æ—¢å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¸ã”ã¨å†ç”Ÿæˆã•ã›ãªã„ã“ã¨** â†’ Codexã¸ã®ä¾é ¼ã¯å¿…ãš **å·®åˆ†ï¼ˆpatchå½¢å¼ï¼‰** ã§è¡Œã†
> - **æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆãƒ»æ–‡å­—åˆ—ã‚’æ‰±ã†å ´åˆã¯UTF-8å‰æã§ä¾é ¼ã™ã‚‹ã“ã¨** â†’ æ–‡å­—åŒ–ã‘é˜²æ­¢ã®ãŸã‚æ˜è¨˜ã™ã‚‹
> - **Codexã« git add / git commit ã‚’å®Ÿè¡Œã•ã›ãªã„ã“ã¨**
> - **å®Œäº†ã—ãŸå ´åˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’`.claude/fixed-plans` ã«ç§»å‹•ã™ã‚‹**

---

## ç›®çš„

ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ãƒ»ãƒœãƒ¼ãƒ‰è©³ç´°ã§é‡è¤‡ã—ã¦ã„ã‚‹æœªä¿å­˜å¤‰æ›´ãƒã‚§ãƒƒã‚¯ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ã‚’å…±é€šåŒ–ã—ã€ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ã€‚

---

## ç¾çŠ¶ã®å•é¡Œç‚¹

### 1. ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡

- `memo-screen.tsx`ã€`task-screen.tsx`ã€ãã—ã¦ä»Šå¾Œå®Ÿè£…äºˆå®šã®`board-detail`ã§åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ãŒé‡è¤‡
- `stripHtmlTags`é–¢æ•°ãŒ`memo-editor.tsx`ã€`task-editor.tsx`ã€`use-simple-item-save.ts`ã«é‡è¤‡

### 2. è²¬å‹™ã®åˆ†æ•£

- æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ï¼š`use-simple-item-save`ã®`hasChanges` + editorå´ã®`hasUnsavedChanges`
- ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼šå„screen + editor
- é¸æŠä¿ç•™ï¼šå„screenã®`pendingSelectionRef`
- ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†ï¼šã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ`memo-unsaved-changes-discarded`ç­‰ï¼‰

### 3. è¤‡é›‘ãªrefç®¡ç†

- ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ï¼š`TeamDetailContext`çµŒç”±
- å€‹äººãƒ¢ãƒ¼ãƒ‰ï¼špropsçµŒç”±ã®ref
- å–å¾—æ–¹æ³•ãŒå ´æ‰€ã«ã‚ˆã£ã¦ç•°ãªã‚‹

### 4. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒæ®‹ç•™

- `console.log`ãŒæœ¬ç•ªã‚³ãƒ¼ãƒ‰ã«æ®‹ã£ã¦ã„ã‚‹

---

## ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°è¨­è¨ˆ

### ãƒ•ã‚§ãƒ¼ã‚º1: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®å…±é€šåŒ–

#### 1.1 HTMLã‚¿ã‚°é™¤å»é–¢æ•°ã®çµ±ä¸€

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/src/utils/html.ts`

```typescript
/**
 * HTMLã‚¿ã‚°ã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’é™¤å»ã—ã¦å®Ÿè³ªçš„ãªå†…å®¹ã‚’å–å¾—
 * Tiptapã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ã®<p></p>ãªã©ã®ç©ºã‚¿ã‚°ã‚’è€ƒæ…®ã—ãŸç©ºåˆ¤å®šã«ä½¿ç”¨
 */
export function stripHtmlTags(str: string): string {
  // HTMLã‚¿ã‚°ã‚’é™¤å»
  const withoutTags = str.replace(/<[^>]*>/g, "");
  // HTMLå®Ÿä½“å‚ç…§ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰
  const withoutEntities = withoutTags
    .replace(/&nbsp;/g, " ")
    .replace(/&amp;/g, "&")
    .replace(/&lt;/g, "<")
    .replace(/&gt;/g, ">")
    .replace(/&quot;/g, '"');
  return withoutEntities.trim();
}

/**
 * å†…å®¹ãŒå®Ÿè³ªçš„ã«ç©ºã‹ã©ã†ã‹ã‚’åˆ¤å®š
 */
export function isContentEmpty(str: string): boolean {
  return !stripHtmlTags(str);
}
```

**å½±éŸ¿ç¯„å›²:**

- `apps/web/components/features/memo/memo-editor.tsx` - æ—¢å­˜ã®stripHtmlTagså‰Šé™¤ã€importè¿½åŠ 
- `apps/web/components/features/task/task-editor.tsx` - æ—¢å­˜ã®stripHtmlTagså‰Šé™¤ã€importè¿½åŠ 
- `apps/web/src/hooks/use-simple-item-save.ts` - æ—¢å­˜ã®stripHtmlTagså‰Šé™¤ã€importè¿½åŠ 

---

### ãƒ•ã‚§ãƒ¼ã‚º2: æœªä¿å­˜å¤‰æ›´ã‚¬ãƒ¼ãƒ‰ç”¨ãƒ•ãƒƒã‚¯ã®ä½œæˆ

#### 2.1 å…±é€šãƒ•ãƒƒã‚¯ã®å®Ÿè£…

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/src/hooks/use-unsaved-changes-guard.ts`

```typescript
import { useCallback, useEffect, useRef } from "react";

export type UnsavedChangesGuardOptions<T> = {
  // æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ç”¨ref
  hasUnsavedChangesRef: React.MutableRefObject<boolean>;
  // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºé–¢æ•°ref
  showConfirmModalRef: React.MutableRefObject<(() => void) | null>;
  // ã‚¢ã‚¤ãƒ†ãƒ é¸æŠæ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  onSelectItem: (item: T | null) => void;
  // ç”»é¢ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
  setScreenMode: (mode: "list" | "view" | "create") => void;
  // ç ´æ£„ã‚¤ãƒ™ãƒ³ãƒˆå
  discardEventName:
    | "memo-unsaved-changes-discarded"
    | "task-unsaved-changes-discarded";
  // ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ©ãƒ™ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  debugLabel?: string;
};

/**
 * æœªä¿å­˜å¤‰æ›´ãŒã‚ã‚‹æ™‚ã«é¸æŠã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã€ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹å…±é€šãƒ•ãƒƒã‚¯
 *
 * @example
 * const { handleSelectWithGuard } = useUnsavedChangesGuard({
 *   hasUnsavedChangesRef: personalMemoEditorHasUnsavedChangesRef,
 *   showConfirmModalRef: personalMemoEditorShowConfirmModalRef,
 *   onSelectItem: onSelectMemo,
 *   setScreenMode: setMemoScreenMode,
 *   discardEventName: "memo-unsaved-changes-discarded",
 * });
 */
export function useUnsavedChangesGuard<T>({
  hasUnsavedChangesRef,
  showConfirmModalRef,
  onSelectItem,
  setScreenMode,
  discardEventName,
  debugLabel = "item",
}: UnsavedChangesGuardOptions<T>) {
  // ä¿ç•™ä¸­ã®é¸æŠã‚¢ã‚¤ãƒ†ãƒ 
  const pendingSelectionRef = useRef<T | null>(null);

  /**
   * æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ä»˜ãã®ã‚¢ã‚¤ãƒ†ãƒ é¸æŠãƒãƒ³ãƒ‰ãƒ©ãƒ¼
   */
  const handleSelectWithGuard = useCallback(
    (item: T | null) => {
      // ã‚¢ã‚¤ãƒ†ãƒ ãŒé¸æŠã•ã‚ŒãŸå ´åˆã€æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
      if (item) {
        const hasUnsavedChanges = hasUnsavedChangesRef.current;
        const showModal = showConfirmModalRef.current;

        if (hasUnsavedChanges && showModal) {
          // é¸æŠã‚’ä¿ç•™ã—ã¦ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
          pendingSelectionRef.current = item;
          showModal();
          return;
        }
      }

      // æœªä¿å­˜å¤‰æ›´ãŒãªã„å ´åˆã¯é€šå¸¸é€šã‚Šé¸æŠ
      onSelectItem(item);
      if (item) {
        setScreenMode("view");
      }
    },
    [hasUnsavedChangesRef, showConfirmModalRef, onSelectItem, setScreenMode],
  );

  /**
   * ç ´æ£„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆä¿ç•™ä¸­ã®é¸æŠã‚’å®Ÿè¡Œï¼‰
   */
  useEffect(() => {
    const handleUnsavedChangesDiscarded = () => {
      if (pendingSelectionRef.current) {
        const pendingItem = pendingSelectionRef.current;
        pendingSelectionRef.current = null;
        // ä¿ç•™ä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’é¸æŠï¼ˆæœªä¿å­˜ãƒã‚§ãƒƒã‚¯ã‚’å›é¿ï¼‰
        onSelectItem(pendingItem);
        setScreenMode("view");
      }
    };

    window.addEventListener(discardEventName, handleUnsavedChangesDiscarded);

    return () => {
      window.removeEventListener(
        discardEventName,
        handleUnsavedChangesDiscarded,
      );
    };
  }, [onSelectItem, setScreenMode, discardEventName]);

  return { handleSelectWithGuard };
}
```

#### 2.2 å‹å®šç¾©ã®è¿½åŠ 

**æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/src/types/unsaved-changes.ts`

```typescript
/**
 * æœªä¿å­˜å¤‰æ›´ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®refå‹
 */
export type UnsavedChangesRefs = {
  hasUnsavedChangesRef: React.MutableRefObject<boolean>;
  showConfirmModalRef: React.MutableRefObject<(() => void) | null>;
};

/**
 * ãƒ¢ãƒ¼ãƒ‰ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã‚¿ã‚¤ãƒ—ã”ã¨ã®ç ´æ£„ã‚¤ãƒ™ãƒ³ãƒˆå
 */
export type DiscardEventName =
  | "memo-unsaved-changes-discarded"
  | "task-unsaved-changes-discarded";
```

---

### ãƒ•ã‚§ãƒ¼ã‚º3: æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®é©ç”¨

#### 3.1 å€‹äººå´ãƒ¡ãƒ¢ç”»é¢

**ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/components/screens/memo-screen.tsx`

**å¤‰æ›´å‰:**

```typescript
// ä¿ç•™ä¸­ã®é¸æŠãƒ¡ãƒ¢ï¼ˆæœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºæ™‚ã«ä½¿ç”¨ï¼‰
const pendingMemoSelectionRef = useRef<Memo | null>(null);

// å€‹äººãƒ¢ãƒ¼ãƒ‰ç”¨ã®æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ç”¨ref
const personalMemoEditorHasUnsavedChangesRef = useRef<boolean>(false);
const personalMemoEditorShowConfirmModalRef = useRef<(() => void) | null>(null);

const handleSelectMemo = useCallback(
  (memo: Memo | null) => {
    // ... æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
  },
  [dependencies],
);

// useEffectã§ç ´æ£„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
useEffect(() => {
  // ... ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼å®Ÿè£…
}, [dependencies]);
```

**å¤‰æ›´å¾Œ:**

```typescript
import { useUnsavedChangesGuard } from "@/src/hooks/use-unsaved-changes-guard";

// å€‹äººãƒ¢ãƒ¼ãƒ‰ç”¨ã®æœªä¿å­˜ãƒã‚§ãƒƒã‚¯ç”¨ref
const personalMemoEditorHasUnsavedChangesRef = useRef<boolean>(false);
const personalMemoEditorShowConfirmModalRef = useRef<(() => void) | null>(null);

// å€‹äººãƒ¢ãƒ¼ãƒ‰ç”¨ã®æœªä¿å­˜ã‚¬ãƒ¼ãƒ‰
const { handleSelectWithGuard: handleSelectMemoPersonal } =
  useUnsavedChangesGuard({
    hasUnsavedChangesRef: personalMemoEditorHasUnsavedChangesRef,
    showConfirmModalRef: personalMemoEditorShowConfirmModalRef,
    onSelectItem: onSelectMemo,
    setScreenMode: setMemoScreenMode,
    discardEventName: "memo-unsaved-changes-discarded",
    debugLabel: "memo",
  });

const handleSelectMemo = teamMode
  ? handleSelectMemoTeam // ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã¯æ—¢å­˜ãƒ­ã‚¸ãƒƒã‚¯
  : handleSelectMemoPersonal;
```

#### 3.2 å€‹äººå´ã‚¿ã‚¹ã‚¯ç”»é¢

**ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/components/screens/task-screen.tsx`

ãƒ¡ãƒ¢ã¨åŒæ§˜ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§é©ç”¨ã€‚

#### 3.3 ãƒãƒ¼ãƒ å´ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ç”»é¢

ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ã§ã‚‚åŒã˜ãƒ•ãƒƒã‚¯ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã€`TeamDetailContext`ã‹ã‚‰å–å¾—ã—ãŸrefã‚’æ¸¡ã™ã€‚

#### 3.4 ãƒœãƒ¼ãƒ‰è©³ç´°ç”»é¢ï¼ˆæ–°è¦å®Ÿè£…ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `apps/web/app/(app)/boards/[slug]/page.tsx` ã¾ãŸã¯è©²å½“ã™ã‚‹ãƒœãƒ¼ãƒ‰è©³ç´°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

æ–°è¦å®Ÿè£…æ™‚ã‹ã‚‰å…±é€šãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã€‚

---

### ãƒ•ã‚§ãƒ¼ã‚º4: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®å‰Šé™¤

#### 4.1 å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«

- `apps/web/components/screens/memo-screen.tsx`
- `apps/web/components/screens/task-screen.tsx`
- `apps/web/components/features/memo/memo-editor.tsx`
- `apps/web/components/features/task/task-editor.tsx`
- `apps/web/src/hooks/use-simple-item-save.ts`
- `apps/web/src/hooks/use-selection-handlers.ts`

#### 4.2 å‰Šé™¤å¯¾è±¡

```typescript
console.log(`ğŸ” [use-simple-item-save] ...`);
console.log(`ğŸ“ [memo-editor] ...`);
console.log(`ğŸ¯ [memo-screen] ...`);
console.log(`ğŸš« [task-screen] ...`);
console.log(`ğŸ†• [use-selection-handlers] ...`);
console.log(`âœ… [task-screen] ...`);
```

---

## å®Ÿè£…é †åº

### Step 1: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®å…±é€šåŒ– âœ…æ¨å¥¨é–‹å§‹ç‚¹

1. `apps/web/src/utils/html.ts` ä½œæˆ
2. æ—¢å­˜ã®3ç®‡æ‰€ã‹ã‚‰`stripHtmlTags`ã‚’å‰Šé™¤ã—ã€import ã«ç½®ãæ›ãˆ
3. ãƒ†ã‚¹ãƒˆï¼šæ—¢å­˜æ©Ÿèƒ½ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### Step 2: å…±é€šãƒ•ãƒƒã‚¯ã®ä½œæˆ

1. `apps/web/src/hooks/use-unsaved-changes-guard.ts` ä½œæˆ
2. `apps/web/src/types/unsaved-changes.ts` ä½œæˆ
3. ãƒ†ã‚¹ãƒˆï¼šå‹å®šç¾©ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒãªã„ã“ã¨ã‚’ç¢ºèª

### Step 3: å€‹äººå´ã¸ã®é©ç”¨

1. `memo-screen.tsx` ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
2. ãƒ†ã‚¹ãƒˆï¼šå€‹äººå´ãƒ¡ãƒ¢ã§æœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
3. `task-screen.tsx` ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
4. ãƒ†ã‚¹ãƒˆï¼šå€‹äººå´ã‚¿ã‚¹ã‚¯ã§æœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### Step 4: ãƒãƒ¼ãƒ å´ã¸ã®é©ç”¨

1. `memo-screen.tsx` ã®ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
2. ãƒ†ã‚¹ãƒˆï¼šãƒãƒ¼ãƒ å´ãƒ¡ãƒ¢ã§æœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª
3. `task-screen.tsx` ã®ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
4. ãƒ†ã‚¹ãƒˆï¼šãƒãƒ¼ãƒ å´ã‚¿ã‚¹ã‚¯ã§æœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### Step 5: ãƒœãƒ¼ãƒ‰è©³ç´°ã¸ã®é©ç”¨

1. ãƒœãƒ¼ãƒ‰è©³ç´°ã®ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯é¸æŠå‡¦ç†ã«å…±é€šãƒ•ãƒƒã‚¯ã‚’é©ç”¨
2. ãƒ†ã‚¹ãƒˆï¼šãƒœãƒ¼ãƒ‰è©³ç´°ã§æœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèª

### Step 6: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®å‰Šé™¤

1. å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰`console.log`ã‚’å‰Šé™¤
2. ãƒ†ã‚¹ãƒˆï¼šå…¨ç”»é¢ã§å‹•ä½œç¢ºèª

---

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### ã‚³ãƒ¼ãƒ‰å‰Šæ¸›

- é‡è¤‡ãƒ­ã‚¸ãƒƒã‚¯ã®å‰Šé™¤ï¼šç´„200è¡Œå‰Šæ¸›
- ä¿å®ˆæ€§å‘ä¸Šï¼šå¤‰æ›´ç®‡æ‰€ãŒ1ç®‡æ‰€ã«é›†ç´„

### ãƒ†ã‚¹ã‚¿ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

- ãƒ•ãƒƒã‚¯å˜ä½“ã§ã®ãƒ†ã‚¹ãƒˆãŒå¯èƒ½
- ãƒ¢ãƒƒã‚¯ã‚’ä½¿ã£ãŸãƒ†ã‚¹ãƒˆãŒå®¹æ˜“

### æ‹¡å¼µæ€§å‘ä¸Š

- æ–°ã—ã„ç”»é¢ï¼ˆãƒœãƒ¼ãƒ‰è©³ç´°ç­‰ï¼‰ã¸ã®é©ç”¨ãŒå®¹æ˜“
- å°†æ¥çš„ãªæ©Ÿèƒ½è¿½åŠ ï¼ˆä¿å­˜å‰ã®è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ç­‰ï¼‰ãŒå®¹æ˜“

---

## æ‡¸å¿µç‚¹ã¨å¯¾ç­–

### æ‡¸å¿µç‚¹1: æ—¢å­˜å‹•ä½œã®ç ´å£Š

**å¯¾ç­–:** Stepæ¯ã«ãƒ†ã‚¹ãƒˆã‚’å®Ÿæ–½ã—ã€å‹•ä½œç¢ºèªã‚’å¾¹åº•

### æ‡¸å¿µç‚¹2: ãƒãƒ¼ãƒ /å€‹äººãƒ¢ãƒ¼ãƒ‰ã®é•ã„

**å¯¾ç­–:** ãƒ•ãƒƒã‚¯ã¯ãƒ¢ãƒ¼ãƒ‰ã«ä¾å­˜ã—ãªã„è¨­è¨ˆã€‚å‘¼ã³å‡ºã—å´ã§refã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹

### æ‡¸å¿µç‚¹3: è¤‡é›‘ãªã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†

**å¯¾ç­–:** ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã¯ç¶­æŒã—ã¤ã¤ã€ãƒ•ãƒƒã‚¯å†…ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–

---

## Codexå®Ÿè£…ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

### ã‚¿ã‚¹ã‚¯1: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ä½œæˆ

- [ ] `apps/web/src/utils/html.ts` ã‚’ä½œæˆ
- [ ] `stripHtmlTags`é–¢æ•°ã¨`isContentEmpty`é–¢æ•°ã‚’å®Ÿè£…
- [ ] JSDocã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ 

### ã‚¿ã‚¹ã‚¯2: ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã®é©ç”¨

- [ ] `memo-editor.tsx` ã®æ—¢å­˜`stripHtmlTags`ã‚’å‰Šé™¤ã—ã€importè¿½åŠ 
- [ ] `task-editor.tsx` ã®æ—¢å­˜`stripHtmlTags`ã‚’å‰Šé™¤ã—ã€importè¿½åŠ 
- [ ] `use-simple-item-save.ts` ã®æ—¢å­˜`stripHtmlTags`ã‚’å‰Šé™¤ã—ã€importè¿½åŠ 

### ã‚¿ã‚¹ã‚¯3: å…±é€šãƒ•ãƒƒã‚¯ä½œæˆ

- [ ] `apps/web/src/types/unsaved-changes.ts` ã‚’ä½œæˆ
- [ ] `apps/web/src/hooks/use-unsaved-changes-guard.ts` ã‚’ä½œæˆ
- [ ] å‹å®šç¾©ã¨ãƒ•ãƒƒã‚¯å®Ÿè£…ã€JSDocã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ 

### ã‚¿ã‚¹ã‚¯4: å€‹äººå´ãƒ¡ãƒ¢ã¸ã®é©ç”¨

- [ ] `memo-screen.tsx` ã®å€‹äººãƒ¢ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
- [ ] æ—¢å­˜ã®`pendingMemoSelectionRef`ã¨ç ´æ£„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤

### ã‚¿ã‚¹ã‚¯5: å€‹äººå´ã‚¿ã‚¹ã‚¯ã¸ã®é©ç”¨

- [ ] `task-screen.tsx` ã®å€‹äººãƒ¢ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
- [ ] æ—¢å­˜ã®`pendingTaskSelectionRef`ã¨ç ´æ£„ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å‰Šé™¤

### ã‚¿ã‚¹ã‚¯6: ãƒãƒ¼ãƒ å´ã¸ã®é©ç”¨

- [ ] `memo-screen.tsx` ã®ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ
- [ ] `task-screen.tsx` ã®ãƒãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰éƒ¨åˆ†ã‚’å…±é€šãƒ•ãƒƒã‚¯ã«ç½®ãæ›ãˆ

### ã‚¿ã‚¹ã‚¯7: ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å‰Šé™¤

- [ ] å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æœªä¿å­˜å¤‰æ›´é–¢é€£ã®`console.log`ã‚’å‰Šé™¤

---

## å®Œäº†æ¡ä»¶

- [ ] å…¨ç”»é¢ï¼ˆãƒãƒ¼ãƒ ãƒ»å€‹äºº Ã— ãƒ¡ãƒ¢ãƒ»ã‚¿ã‚¹ã‚¯ Ã— é€šå¸¸ãƒ»ãƒœãƒ¼ãƒ‰è©³ç´°ï¼‰ã§æœªä¿å­˜ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒå‹•ä½œ
- [ ] æ–°è¦ä½œæˆæ™‚ã«ä½•ã‚‚å…¥åŠ›ã—ã¦ã„ãªã„å ´åˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œãªã„
- [ ] ã‚¿ã‚¤ãƒˆãƒ«ã¾ãŸã¯ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’å…¥åŠ›ã—ãŸå ´åˆã€ãƒ¢ãƒ¼ãƒ€ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã€Œç ´æ£„ã€ã‚’é¸æŠã™ã‚‹ã¨ã€ä¿ç•™ä¸­ã®ã‚¢ã‚¤ãƒ†ãƒ ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹
- [ ] ã€Œã‚­ãƒ£ãƒ³ã‚»ãƒ«ã€ã‚’é¸æŠã™ã‚‹ã¨ã€å…ƒã®ç·¨é›†ã‚’ç¶™ç¶š
- [ ] ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒå…¨ã¦å‰Šé™¤ã•ã‚Œã¦ã„ã‚‹
- [ ] TypeScriptã‚¨ãƒ©ãƒ¼ãŒãªã„
- [ ] Lintã‚¨ãƒ©ãƒ¼ãŒãªã„

---

## å‚™è€ƒ

ã“ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¯æ®µéšçš„ã«å®Ÿæ–½å¯èƒ½ã€‚Step 1ã®ã¿å®Ÿæ–½ã—ã¦åŠ¹æœã‚’ç¢ºèªå¾Œã€ç¶šãã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚
